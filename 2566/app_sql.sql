SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for pbs_items
-- ----------------------------
DROP TABLE IF EXISTS `pbs_items`;
CREATE TABLE `pbs_items` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `activity_code` varchar(3) NOT NULL,
  `activity_name` mediumtext NOT NULL,
  `activity_unit` mediumtext NOT NULL,
  `activity_cost` mediumtext NOT NULL,
  `hospital_sub` int(11) DEFAULT NULL,
  `hospital_main` int(11) DEFAULT NULL,
  `etc` mediumtext,
  `activity_note` mediumtext,
  `activity_group` mediumtext NOT NULL,
  `activity_source` mediumtext,
  `sql_desc` mediumtext,
  `sql_code` mediumtext,
  `how_rec` mediumtext,
  `signature` mediumtext,
  `editor` mediumtext,
  `lastupdate` date DEFAULT NULL,
  `active_status` int(11) DEFAULT NULL,
  `limit_per_hospital` mediumint(7) unsigned DEFAULT NULL,
  `limit_spce_day` smallint(4) unsigned DEFAULT NULL,
  `limit_quarter` smallint(4) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `activity_code` (`activity_code`) USING BTREE
) CHARSET=utf8;

-- ----------------------------
-- Records of pbs_items
-- ----------------------------
INSERT INTO `pbs_items` VALUES ('1', '102', 'สร้างแรงจูงใจเพื่อค้นหาหญิงตั้งครรภ์ให้มาฝากครรภ์ภายใน 12 สัปดาห์', '1', '200', '1', '1', 'เบิกจากงบ PPB,PPA,กองทุนท้องถิ่น งบใดงบหนึ่ง', 'กิจกรรม\r\n1. สำรวจ ค้นหาหญิงตั้งครรภ์รายใหม่ในพื้นที่\r\n2. ให้ความรู้เชิญชวน และนำหญิงตั้งครรภ์ มาฝากครรภ์ภานใน 12 สัปดาห์', '01 กลุ่มหญิงตั้งครรภ์', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nset @start_date = date(\'2022-10-01\');\r\nset @stop_date = date(\'2023-03-31\');\r\n- ต้องมีการลงทะเบียนหญิงตั้งครรภ์ เพศหญิงเท่านั้น\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- ต้องมีการลงข้อมูล LMP เพื่อคำนวนช่วงวันที่ การให้บริการที่อยู่ในเงื่อนไข ระหว่าง (7*4) วัน ถึง (7*12) วัน\r\n- ต้องมีการ ระบุประเภท \"ตรวจก่อนคลอด\"\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตั้งครรภ์ Z3*\r\n', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nset @activity_code := \'102\';\r\nset @activity_cost := \'200\';\r\nset @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nselect person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code as char)   as activity_code,\r\n       cast(@activity_cost as char)   as activity_cost,\r\n       date_format(person_anc_service.anc_service_date, \'%Y-%m-%d\')\r\n          as date_serv,\r\n       @h_sub                         as h_sub,\r\n       provis_instype.code            as local_instype_code,\r\n       provis_instype.name            as local_instype_name,\r\n       provis_instype.pttype_std_code as instype_code,\r\n       pttype.`name`                  as instype_name,\r\n       ovst.hospmain                  as instype_main,\r\n       ovst.hospsub                   as instype_hsub,\r\n       ovst.pttypeno                  as instype_id\r\nfrom person_anc_service\r\n     inner join person_anc\r\n        on person_anc.person_anc_id = person_anc_service.person_anc_id\r\n     inner join person on person.person_id = person_anc.person_id\r\n     inner join ovstdiag on person_anc_service.vn = ovstdiag.vn\r\n     left outer join ovst on person_anc_service.vn = ovst.vn\r\n     left outer join pttype on ovst.pttype = pttype.pttype\r\n     left outer join provis_instype\r\n        on pttype.nhso_code = provis_instype.code\r\nwhere     person_anc_service.anc_service_date between @start_date\r\n                                                  and @stop_date\r\n      and datediff(person_anc_service.anc_service_date, person_anc.lmp) between (  7\r\n                                                                                 * 4)\r\n                                                                            and (  7\r\n                                                                                 * 12)\r\n      and datediff(person_anc.anc_register_date, person_anc.lmp) between (  7\r\n                                                                          * 4)\r\n                                                                     and (  7\r\n                                                                          * 12)\r\n      and person.sex = 2\r\n      and person.house_regist_type_id in (1, 3)\r\n      and person_anc_service.anc_service_type_id = 1\r\n      and ovstdiag.icd10 like @icd10set\r\n      and person_anc.anc_register_date is not null\r\n      and ((    provis_instype.pttype_std_code = \"0100\"\r\n            and ovst.hospmain = \"10679\" ))\r\ngroup by person_anc_service.person_anc_id;', null, 'inforeportable ', 'inforeportable', '2023-03-19', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('2', '201', 'DSPM ประเมินพัฒนาการเด็ก 0 - 5 ปี (9,18,30,42,60 เดือน)', '2', '50', '1', '1', 'คู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'ประเมินพัฒนาการเด็ก 0 - 5 ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง\r\n(ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- ในคำสั่ง มีการอำนวนความสะดวก ปรับ วันที่ บันทึก PP Special ให้ตรงกับวันที่รับบริการ ในกรณีที่หน่วยบริการ บันทึกข้อมูลไม่ทัน และย้อนหลังวันที่ เครื่อง ไปบันทึก PP Special สามารถเอาออกได้หากไม่ต้องการปรับปรุง    \r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n    1B200 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลปกติ\r\n    1B201 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B202 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B203 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPMผลปกติ\r\n    1B204 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B205 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B209 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM และ หรือ DAIM ไม่ระบุรายละเอียด\r\n    1B210 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B211 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B212 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B213 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B214 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B215 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B219 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B220 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B221 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B222 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B223 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B224 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B225 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B229 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B230 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B231 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B232 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B233 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B234 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B235 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B239 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B240 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B241 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B242 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลล่าช้าส่งเพื่อประเมิน/รักษาต่อ\r\n    1B243 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B244 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B245 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาด้านการช่วยเหลือตัวเองและสังคม โดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B249 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPMและหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B260 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM ผลปกติ\r\n    1B261 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B262 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งต่อทันที', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'201\';\r\nSET @activity_cost = \'50\';\r\nSET @ppset =\r\n       \'1b200,1b201,1b202,1b203,1b204,1b205,1b209,1b210,1b211,1b212,1b213,1b214,1b215,1b219,1b220,1b221,1b222,1b223,1b224,1b225,1b229,1b230,1b231,1b232,1b233,1b234,1b235,1b239,1b240,1b241,1b242,1b243,1b244,1b245,1b249,1b260,1b261,1b262\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n       local_instype_code,\r\n       local_instype_name,\r\n       instype_code,\r\n       instype_name,\r\n       instype_main,\r\n       instype_hsub,\r\n       instype_id\r\nFROM (                                                             -- startrun\r\n      SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             @activity_code                               AS activity_code,\r\n             @activity_cost                               AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             provis_instype.code\r\n                AS local_instype_code,\r\n             provis_instype.name\r\n                AS local_instype_name,\r\n             provis_instype.pttype_std_code               AS instype_code,\r\n             pttype.`name`                                AS instype_name,\r\n             ovst.hospmain                                AS instype_main,\r\n             ovst.hospsub                                 AS instype_hsub,\r\n             ovst.pttypeno                                AS instype_id,\r\n             if(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_dspm,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_dspm_result,\r\n             timestampdiff(month, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n           LEFT OUTER JOIN provis_instype\r\n              ON pttype.nhso_code = provis_instype.code\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND provis_instype.pttype_std_code = \"0100\"\r\n            AND ovst.hospmain = \"10679\"\r\n            AND person.nationality = 99\r\n            AND person.death <> \'y\'\r\n            AND timestampdiff(month, person.birthdate, ovst.vstdate) IN\r\n                   (9,\r\n                    18,\r\n                    30,\r\n                    42,\r\n                    60)\r\n      GROUP BY person.cid, ovst.vstdate\r\n      HAVING (if(sum(\r\n                    CASE\r\n                       WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                        @ppset)\r\n                       THEN\r\n                          1\r\n                       ELSE\r\n                          0\r\n                    END) >= 1,\r\n                 1,\r\n                 0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS a;', null, 'inforeportable', 'inforeportable', '2023-03-19', '1', '999999', '180', '84');
INSERT INTO `pbs_items` VALUES ('3', '202', 'ชั่งน้ำหนัก ส่วนสูง ประเมินภาวะโภชนาการ ในเด็ก 0 - 5 ปี ไตรมาสละ 1 ครั้ง', '4', '15', '1', '1', '-', 'ช่วงไตรมาส ที่ 1 ตุลาคม - ธันวาคม\r\nช่วงไตรมาส ที่ 2 มกราคม - มีนาคม\r\nช่วงไตรมาส ที่ 3 เมษายน- มิถุนายน\r\nช่วงไตรมาส ที่ 4 กรกฏาคม - กันยายน', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\'); \r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- เด็ก ต้องมีการขึ้นทะเบียน 3 หรือ บัญชี 4 หรือ ผู้มารับบริการ TypeArea 1,3  เท่านั้น เพื่อป้องกันความซ้ำซ้อนระหว่างหน่วยบริการ\r\n- ในช่วงไตรมาสเดียวกัน หากมีการให้บริการมากกว่า 1 รายการ ระบบจะเลือกรายการที่ตรงที่สุดเพียงรายการเดียว รายการอื่นจะไม่ถูกนำมาใช้\r\n    ช่วงไตรมาส ที่ 1 ตุลาคม - ธันวาคม\r\n    ช่วงไตรมาส ที่ 2 มกราคม - มีนาคม\r\n    ช่วงไตรมาส ที่ 3 เมษายน- มิถุนายน\r\n    ช่วงไตรมาส ที่ 4 กรกฏาคม - กันยายน\r\n- ห้ามว่างค่าต่อไปนี้ น้ำหนัก ,ส่วนสูง', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'202\';\r\nSET @activity_cost = \'15\';\r\nSET @curr = NULL;\r\nSET @prev = NULL;\r\nSET @rank = 0;\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n       local_instype_code,\r\n       local_instype_name,\r\n       instype_code,\r\n       instype_name,\r\n       instype_main,\r\n       instype_hsub,\r\n       instype_id\r\nFROM ((SELECT tt_epi.cid,\r\n              tt_epi.pname,\r\n              tt_epi.fname,\r\n              tt_epi.lname,\r\n              tt_epi.activity_code,\r\n              tt_epi.activity_cost,\r\n              tt_epi.date_serv,\r\n              tt_epi.h_sub,\r\n              local_instype_code,\r\n              local_instype_name,\r\n              instype_code,\r\n              instype_name,\r\n              instype_main,\r\n              instype_hsub,\r\n              instype_id,\r\n              tt_epi.current_age,\r\n              tt_epi.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_epi.cid, t_epi.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(\r\n                             person_epi_nutrition.nutrition_date,\r\n                             \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          provis_instype.code\r\n                             AS local_instype_code,\r\n                          provis_instype.name\r\n                             AS local_instype_name,\r\n                          provis_instype.pttype_std_code\r\n                             AS instype_code,\r\n                          pttype.`name`                      AS instype_name,\r\n                          ovst.hospmain                      AS instype_main,\r\n                          ovst.hospsub                       AS instype_hsub,\r\n                          ovst.pttypeno                      AS instype_id,\r\n                          timestampdiff(\r\n                             YEAR,\r\n                             person.birthdate,\r\n                             person_epi_nutrition.nutrition_date)\r\n                             AS current_age,\r\n                          QUARTER(person_epi_nutrition.nutrition_date)\r\n                             AS quarter_year\r\n                   FROM person_epi_nutrition\r\n                        INNER JOIN person_epi\r\n                           ON person_epi_nutrition.person_epi_id =\r\n                                 person_epi.person_epi_id\r\n                        INNER JOIN person\r\n                           ON person_epi.person_id = person.person_id\r\n                        LEFT OUTER JOIN ovst\r\n                           ON person_epi_nutrition.vn = ovst.vn\r\n                        LEFT OUTER JOIN pttype\r\n                           ON ovst.pttype = pttype.pttype\r\n                        LEFT OUTER JOIN provis_instype\r\n                           ON pttype.nhso_code = provis_instype.code\r\n                   WHERE     person_epi_nutrition.nutrition_date BETWEEN @start_date\r\n                                                                     AND @stop_date\r\n                         AND provis_instype.pttype_std_code = \"0100\"\r\n                         AND ovst.hospmain = \"10679\"\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(\r\n                                YEAR,\r\n                                person.birthdate,\r\n                                person_epi_nutrition.nutrition_date) BETWEEN 0\r\n                                                                         AND 5\r\n                         AND person_epi_nutrition.body_weight > 0\r\n                         AND person_epi_nutrition.height > 0\r\n                   GROUP BY person_epi_nutrition.person_epi_nutrition_id\r\n                   ORDER BY person.cid ASC,\r\n                            person_epi_nutrition.nutrition_date)\r\n                  AS t_epi) AS tt_epi\r\n       WHERE tt_epi.rank = 1)\r\n      UNION ALL\r\n      (SELECT tt_wbc.cid,\r\n              tt_wbc.pname,\r\n              tt_wbc.fname,\r\n              tt_wbc.lname,\r\n              tt_wbc.activity_code,\r\n              tt_wbc.activity_cost,\r\n              tt_wbc.date_serv,\r\n              tt_wbc.h_sub,\r\n              local_instype_code,\r\n              local_instype_name,\r\n              instype_code,\r\n              instype_name,\r\n              instype_main,\r\n              instype_hsub,\r\n              instype_id,\r\n              tt_wbc.current_age,\r\n              tt_wbc.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_wbc.cid, t_wbc.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(\r\n                             person_wbc_nutrition.nutrition_date,\r\n                             \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          provis_instype.code\r\n                             AS local_instype_code,\r\n                          provis_instype.name\r\n                             AS local_instype_name,\r\n                          provis_instype.pttype_std_code\r\n                             AS instype_code,\r\n                          pttype.`name`                      AS instype_name,\r\n                          ovst.hospmain                      AS instype_main,\r\n                          ovst.hospsub                       AS instype_hsub,\r\n                          ovst.pttypeno                      AS instype_id,\r\n                          timestampdiff(\r\n                             YEAR,\r\n                             person.birthdate,\r\n                             person_wbc_nutrition.nutrition_date)\r\n                             AS current_age,\r\n                          QUARTER(person_wbc_nutrition.nutrition_date)\r\n                             AS quarter_year\r\n                   FROM person_wbc_nutrition\r\n                        INNER JOIN person_wbc\r\n                           ON person_wbc_nutrition.person_wbc_id =\r\n                                 person_wbc.person_wbc_id\r\n                        INNER JOIN person\r\n                           ON person_wbc.person_id = person.person_id\r\n                        LEFT OUTER JOIN ovst\r\n                           ON person_wbc_nutrition.vn = ovst.vn\r\n                        LEFT OUTER JOIN pttype\r\n                           ON ovst.pttype = pttype.pttype\r\n                        LEFT OUTER JOIN provis_instype\r\n                           ON pttype.nhso_code = provis_instype.code\r\n                   WHERE     person_wbc_nutrition.nutrition_date BETWEEN @start_date\r\n                                                                     AND @stop_date\r\n                         AND provis_instype.pttype_std_code = \"0100\"\r\n                         AND ovst.hospmain = \"10679\"\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(\r\n                                YEAR,\r\n                                person.birthdate,\r\n                                person_wbc_nutrition.nutrition_date) BETWEEN 0\r\n                                                                         AND 5\r\n                         AND person_wbc_nutrition.body_weight > 0\r\n                         AND person_wbc_nutrition.height > 0\r\n                   GROUP BY person_wbc_nutrition.person_wbc_nutrition_id\r\n                   ORDER BY person.cid ASC,\r\n                            person_wbc_nutrition.nutrition_date)\r\n                  AS t_wbc) AS tt_wbc\r\n       WHERE tt_wbc.rank = 1)\r\n      UNION ALL\r\n      (SELECT tt_person.cid,\r\n              tt_person.pname,\r\n              tt_person.fname,\r\n              tt_person.lname,\r\n              tt_person.activity_code,\r\n              tt_person.activity_cost,\r\n              tt_person.date_serv,\r\n              tt_person.h_sub,\r\n              local_instype_code,\r\n              local_instype_name,\r\n              instype_code,\r\n              instype_name,\r\n              instype_main,\r\n              instype_hsub,\r\n              instype_id,\r\n              tt_person.current_age,\r\n              tt_person.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_person.cid, t_person.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(opdscreen.vstdate, \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          provis_instype.code\r\n                             AS local_instype_code,\r\n                          provis_instype.name\r\n                             AS local_instype_name,\r\n                          provis_instype.pttype_std_code\r\n                             AS instype_code,\r\n                          pttype.`name`                      AS instype_name,\r\n                          ovst.hospmain                      AS instype_main,\r\n                          ovst.hospsub                       AS instype_hsub,\r\n                          ovst.pttypeno                      AS instype_id,\r\n                          timestampdiff(YEAR,\r\n                                        person.birthdate,\r\n                                        opdscreen.vstdate)\r\n                             AS current_age,\r\n                          QUARTER(opdscreen.vstdate)         AS quarter_year\r\n                   FROM opdscreen\r\n                        INNER JOIN person\r\n                           ON opdscreen.hn = person.patient_hn\r\n                        LEFT OUTER JOIN ovst\r\n                           ON opdscreen.vn = ovst.vn\r\n                        LEFT OUTER JOIN pttype\r\n                           ON ovst.pttype = pttype.pttype\r\n                        LEFT OUTER JOIN provis_instype\r\n                           ON pttype.nhso_code = provis_instype.code\r\n                   WHERE     opdscreen.vstdate BETWEEN @start_date\r\n                                                   AND @stop_date\r\n                         AND provis_instype.pttype_std_code = \"0100\"\r\n                         AND ovst.hospmain = \"10679\"\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(YEAR,\r\n                                           person.birthdate,\r\n                                           opdscreen.vstdate) BETWEEN 0\r\n                                                                  AND 5\r\n                         AND person.house_regist_type_id IN (1, 3)\r\n                         AND (   opdscreen.height IS NOT NULL\r\n                              OR opdscreen.height <> 0)\r\n                         AND (   opdscreen.bw IS NOT NULL\r\n                              OR opdscreen.height <> 0)\r\n                   GROUP BY person.cid, opdscreen.vstdate\r\n                   ORDER BY person.cid ASC, opdscreen.vstdate ASC)\r\n                  AS t_person) AS tt_person\r\n       WHERE tt_person.rank = 1)) AS a;', null, 'inforeportable', 'inforeportable', '2023-03-19', '1', '999999', '28', '1');
INSERT INTO `pbs_items` VALUES ('4', '210', 'ไม่สามารถเบิกได้ LAB ตรวจการติดเชื้อ HIV เด็กอายุ 12 เดือน', '1', '140', '0', '0', 'ซ้ำซ้อน กับกิจกรรม ที่ สปสช. ชดเชยอยู่แล้ว', 'รหัสวินิจฉัย ICD 10 TM \r\nZ114 Special screening examination for human immunodeficiency virus [HIV]\r\nการตรวจคัดกรองพิเศษสำหรับโรคติดต่อเชื้อไวรัสภูมิคุ้มกันบกพร่อง (เอชไอวี)', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', null, null, null, 'inforeportable', 'inforeportable', '2023-03-19', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('5', '211', 'ไม่สามารถเบิกได้ LAB ตรวจการติดเชื้อ HIV ซ้ำ เด็กอายุ 18 เดือน', '1', '140', '0', '0', 'ซ้ำซ้อน กับกิจกรรม ที่ สปสช. ชดเชยอยู่แล้ว', 'รหัสวินิจฉัย ICD 10 TM \r\nZ114 Special screening examination for human immunodeficiency virus [HIV]\r\nการตรวจคัดกรองพิเศษสำหรับโรคติดต่อเชื้อไวรัสภูมิคุ้มกันบกพร่อง (เอชไอวี)', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', null, null, null, 'inforeportable', 'inforeportable', '2023-03-19', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('6', '212', 'ให้ยาน้ำวิตามินเสริมธาตุเหล็กเด็ก 6 เดือน ถึง 5 ปี', '4', '40', '1', '1', 'เงื่อนไข รหัสยา 24 หลัก นำมาจาก ระบบรายงานของ HDC\r\nร้อยละของเด็กอายุ 6 เดือน ถึง 5 ปี ได้รับยาน้ำเสริมธาตุเหล็ก', 'ระบบรายงาน  HDC\r\nนับเฉพาะเด็กไทยที่มารับบริการในแฟ้ม EPI \r\nรหัสยาน้ำเสริมธาตุเหล็กตามสำนักโภชนาการแจ้งดังนี้ \r\n- EUROFER - IRON(oral liquid)->100497414002040330581606 \r\n- Ferium(oral liquid->100497414000800830582799 \r\n- FERRO - BC(syrup)->202030120087180130581617,202030120087180130581487 \r\n- KIDIRON(oral liquid)->100489000000810330581267 \r\n- PEDIRON(oral drop)->100489000000950130581267 \r\n- FER-IN-SOL (drops)->100489000000950730581109 \r\n- Ferrokid->100488000008634230481506 \r\n- Ferdex->100488000001280130881602 \r\n- Ferrosol (oral drop)->100488000004203121781144,100488000001280130481618', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- ต้องมีการระบุ รหัส ยา 24 หลัก โดย จะต้องมีในรายการที่ระบบรายงาน HDC กำหนด ดังนี้\r\n    - EUROFER - IRON(oral liquid) ->100497414002040330581606 \r\n    - Ferium(oral liquid) ->100497414000800830582799 \r\n    - FERRO - BC(syrup) ->202030120087180130581617, 202030120087180130581487 \r\n    - KIDIRON(oral liquid) ->100489000000810330581267 \r\n    - PEDIRON(oral drop)-> 100489000000950130581267 \r\n    - FER-IN-SOL (drops) ->100489000000950730581109 \r\n    - Ferrokid->100488000008634230481506 \r\n    - Ferdex ->100488000001280130881602 \r\n    - Ferrosol (oral drop) ->100488000004203121781144, 100488000001280130481618\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ วัคซีน ร่วมด้วย อยู่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'212\';\r\nSET @activity_cost := \'40\';\r\nSET @water_iron_set =\r\n       \'100497414002040330581606,100497414000800830582799,202030120087180130581617,202030120087180130581487,100489000000810330581267,100489000000950130581267,100489000000950730581109,100488000008634230481506,100488000001280130881602,100488000004203121781144,100488000001280130481618\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n       local_instype_code,\r\n       local_instype_name,\r\n       instype_code,\r\n       instype_name,\r\n       instype_main,\r\n       instype_hsub,\r\n       instype_id\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                  AS activity_code,\r\n             cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n             date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n             @h_sub                                        AS h_sub,\r\n             provis_instype.code\r\n                AS local_instype_code,\r\n             provis_instype.name\r\n                AS local_instype_name,\r\n             provis_instype.pttype_std_code                AS instype_code,\r\n             pttype.name                                 AS instype_name,\r\n             ovst.hospmain                                 AS instype_main,\r\n             ovst.hospsub                                  AS instype_hsub,\r\n             ovst.pttypeno                                 AS instype_id,\r\n             drugitems.did\r\n      FROM opitemrece\r\n           INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n           LEFT OUTER JOIN village\r\n              ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n           INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n           INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n           LEFT OUTER JOIN ovst ON opitemrece.vn = ovst.vn\r\n           LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n           LEFT OUTER JOIN provis_instype\r\n              ON pttype.nhso_code = provis_instype.code\r\n      WHERE     person.sex IN (1, 2)\r\n            AND person.death <> \'y\'\r\n            AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n            AND provis_instype.pttype_std_code = \"0100\"\r\n            AND ovst.hospmain = \"10679\"\r\n            AND timestampdiff(YEAR, person.birthdate, opitemrece.vstdate) BETWEEN 0\r\n                                                                              AND 5\r\n            AND person.nationality = 99\r\n      GROUP BY person.cid\r\n      HAVING sum(\r\n                CASE\r\n                   WHEN (FIND_IN_SET(LEFT(drugitems.did, 24),\r\n                                     @water_iron_set) >= 1)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END) >= 1\r\n      ORDER BY opitemrece.vstdate) AS temp_212;', null, 'inforeportable', 'inforeportable', '2023-03-19', '1', '999999', '28', '84');
INSERT INTO `pbs_items` VALUES ('7', '213', 'Follow DSPM ประเมินพัฒนาการเด็ก 0 - 5 ปี สงสัยล่าช้า  (9,18,30,42,60 เดือน)', '1', '10', '1', '1', 'คู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'กิจกรรมเดิม (QOF) เพิ่มเพื่อขับเคลื่อนงาน\r\nประเมินพัฒนาการเด็ก 0 - ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง (ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', null, '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n    1B200 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลปกติ\r\n    1B201 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B202 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B203 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPMผลปกติ\r\n    1B204 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B205 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B209 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM และ หรือ DAIM ไม่ระบุรายละเอียด\r\n    1B210 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B211 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B212 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B213 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B214 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B215 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B219 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B220 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B221 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B222 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B223 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B224 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B225 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B229 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B230 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B231 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B232 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B233 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B234 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B235 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B239 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B240 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B241 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B242 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลล่าช้าส่งเพื่อประเมิน/รักษาต่อ\r\n    1B243 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B244 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B245 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาด้านการช่วยเหลือตัวเองและสังคม โดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B249 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPMและหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B260 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM ผลปกติ\r\n    1B261 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B262 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งต่อทันที', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'213\';\r\nSET @activity_cost = \'10\';\r\n\r\nSET @ppset =\r\n       \'1b200|1b201|1b202|1b203|1b204|1b205|1b209|1b210|1b211|1b212|1b213|1b214|1b215|1b219|1b220|1b221|1b222|1b223|1b224|1b225|1b229|1b230|1b231|1b232|1b233|1b234|1b235|1b239|1b240|1b241|1b242|1b243|1b244|1b245|1b249|1b260|1b261|1b262\';\r\nSET @ppset_dis = \'1B201|1B211|1B221|1B231|1B241|1B261\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT\r\n    dspm.cid,\r\n    dspm.pname,\r\n    dspm.fname,\r\n    dspm.lname,\r\n    @activity_code AS activity_code,\r\n    @activity_cost AS activity_cost,\r\n    cast(dspm.vstdate AS CHAR) AS date_serv,cast(@h_sub AS char) AS h_sub,\r\nlocal_instype_code,\r\nlocal_instype_name,\r\ninstype_code,\r\ninstype_name,\r\ninstype_main,\r\ninstype_hsub,\r\ninstype_id\r\n\r\nFROM\r\n    (\r\n        SELECT\r\n            q1.*, TIMESTAMPDIFF(DAY, q1.min_date, q2.vstdate),\r\n            q2.vstdate\r\n        FROM\r\n            (\r\n                SELECT\r\n                    person.cid,\r\n                    person.pname,\r\n                    person.fname,\r\n                    person.lname,\r\n                    ovst.hn,\r\n                    min(date(ovst.vstdate)) AS min_date,\r\n                    GROUP_CONCAT(\r\n                        DISTINCT pp_special_type.pp_special_code\r\n                        ORDER BY\r\n                            pp_special_type.pp_special_code\r\n                    ) AS list_pp,\r\nprovis_instype.code AS local_instype_code,\r\nprovis_instype.name AS local_instype_name,\r\nprovis_instype.pttype_std_code AS instype_code,\r\npttype.name AS instype_name,\r\novst.hospmain AS instype_main,\r\novst.hospsub  AS instype_hsub,\r\novst.pttypeno AS instype_id\r\n                FROM\r\n                    ovst\r\n                INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n                INNER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\n                INNER JOIN person ON ovst.hn = person.patient_hn\r\n                LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n                LEFT OUTER JOIN provis_instype ON pttype.nhso_code = provis_instype.code\r\n                WHERE\r\n                    ovst.vstdate BETWEEN @start_date\r\n                AND @stop_date\r\n                AND provis_instype.pttype_std_code = \"0100\"\r\n                AND ovst.hospmain = \"10679\"\r\n                AND TIMESTAMPDIFF(\r\n                    MONTH,\r\n                    person.birthdate,\r\n                    ovst.vstdate\r\n                ) IN (9, 18, 30, 42, 60)\r\n                AND pp_special_type.pp_special_code REGEXP @ppset_dis\r\n                GROUP BY\r\n                    person.cid\r\n            ) AS q1\r\n        INNER JOIN (\r\n            SELECT\r\n                ovst.hn,\r\n                ovst.vstdate,\r\n                pp_special_type.pp_special_code\r\n            FROM\r\n                pp_special\r\n            INNER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\n            INNER JOIN ovst ON ovst.vn = pp_special.vn\r\n            LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n            LEFT OUTER JOIN provis_instype ON pttype.nhso_code = provis_instype.code\r\n            WHERE\r\n                pp_special_type.pp_special_code REGEXP @ppset\r\n                AND provis_instype.pttype_std_code = \"0100\"\r\n                AND ovst.hospmain = \"10679\"\r\n            GROUP BY\r\n                ovst.hn,\r\n                ovst.vstdate\r\n        ) AS q2 ON q1.hn = q2.hn\r\n\r\n        AND TIMESTAMPDIFF(DAY, q1.min_date, q2.vstdate) BETWEEN 8\r\n        AND 30\r\n    ) AS dspm;', null, 'inforeportable', 'inforeportable', '2023-03-19', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('8', '214', 'TEDA4I ประเมินพัฒนาการเด็ก 0 - 5 ปี สงสัยล่าช้า  (9,18,30,42,60 เดือน)', '1', '200', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ TEDA4I ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตามแนวทางการประเมิน คัดกรอง และ การส่งต่อดูแลต่อเนื่อง\r\nคู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'กิจกรรมเดิม (QOF) เพิ่มเพื่อขับเคลื่อนงาน\r\nประเมินพัฒนาการเด็ก 0 - ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง (ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น   \r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n1B270	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลปกติ\r\n1B271	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลล่าช้า ด้านการเคลื่อนไหว\r\n1B272	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลล่าช้า ด้านกล้ามเนื้อมัดเล็กและสติปัญญา\r\n1B273	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลล่าช้า ด้านความเข้าใจภาษา\r\n1B274	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลล่าช้า ด้านการใช้ภาษา\r\n1B275	การกระตุ้นพัฒนาการเด็กล่าช้าโดยเครื่องมือ TEDA4I หรือเครื่องมือมาตรฐานอื่น ผลล่าช้า ด้านการช่วยเหลือตนเองและสังคม', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'214\';\r\nSET @activity_cost = \'200\';\r\nSET @ppset =\r\n       \'1b270,1b271,1b272,1b273,1b274,1b275\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n        local_instype_code,\r\n        local_instype_name,\r\n        instype_code,\r\n        instype_name,\r\n        instype_main,\r\n        instype_hsub,\r\n       instype_id\r\nFROM (                                                             -- startrun\r\n      SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             @activity_code                               AS activity_code,\r\n             @activity_cost                               AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             provis_instype.code\r\n                AS local_instype_code,\r\n             provis_instype.name\r\n                AS local_instype_name,\r\n             provis_instype.pttype_std_code               AS instype_code,\r\n             pttype.`name`                                AS instype_name,\r\n             ovst.hospmain                                AS instype_main,\r\n             ovst.hospsub                                 AS instype_hsub,\r\n             ovst.pttypeno                                AS instype_id,\r\n             if(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_dspm,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_dspm_result,\r\n             timestampdiff(month, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n           LEFT OUTER JOIN provis_instype\r\n              ON pttype.nhso_code = provis_instype.code\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND provis_instype.pttype_std_code = \"0100\"\r\n            AND ovst.hospmain = \"10679\"\r\n            AND person.nationality = 99\r\n            AND person.death <> \'y\'\r\n            AND timestampdiff(month, person.birthdate, ovst.vstdate) IN\r\n                   (9,\r\n                    18,\r\n                    30,\r\n                    42,\r\n                    60)\r\n      GROUP BY person.cid, ovst.vstdate\r\n      HAVING (if(sum(\r\n                    CASE\r\n                       WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                        @ppset)\r\n                       THEN\r\n                          1\r\n                       ELSE\r\n                          0\r\n                    END) >= 1,\r\n                 1,\r\n                 0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS a;', '', 'inforeportable', 'inforeportable', '2023-03-19', '1', '999999', '180', '84');
INSERT INTO `pbs_items` VALUES ('9', '309', 'LAB คัดกรองโลหิตจาง CBC,HB,HCT อายุ 6-12 เดือน หรือ 3-5 ปี', '1', '70', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ CBC,HB,HCT ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตวจนับเม็ดเลือด CBC,HB,HCT\r\n    ครั้งที่ 1 อายุ 6 - 12 เดือน\r\n    ครั้งที่ 2 อายุ 3 - 6 ปี\r\nดูแลต่อเนื่องในรายที่ผิดปกติ อย่างน้อย 1 ครั้ง ในแต่ละช่วงอายุ', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 6 - 60  เดือนเท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ Community Service ร่วมด้วย อย่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1H301 นักเรียนได้รับการตรวจภาวะโลหิตจาง', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'309\';\r\nSET @activity_cost = \'70\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_name_hct)\r\n      AND find_in_set(lab_order.lab_items_name_ref, @lab_name_hb)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND (   timestampdiff(MONTH, person.birthdate, lab_head.order_date) BETWEEN 6\r\n                                                                              AND 60\r\n           OR timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 0\r\n                                                                             AND 5)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('10', '310', 'LAB คัดกรองโลหิตจาง HCT อายุ 6-12 เดือน หรือ 3-5 ปี', '1', '40', '1', '1', 'รพ.สต. ตรวจ HCT\r\nต้อง มีการบันทึก LAB ด้วยรหัส 7 หลัก และ มีผล ต้องไม่มีค่าว่าง เท่านั้น \r\n0621201 Hematocrit whole blood การตรวจหาค่าฮีมาโตคริตในเลือด', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตวจนับเม็ดเลือด CBC,HB,HCT\r\n    ครั้งที่ 1 อายุ 6 - 12 เดือน\r\n    ครั้งที่ 2 อายุ 3 - 6 ปี\r\nดูแลต่อเนื่องในรายที่ผิดปกติ อย่างน้อย 1 ครั้ง ในแต่ละช่วงอายุ', '03 กลุ่มเด็กเล็ก 0 - 5 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 6 - 60  เดือนเท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HCT\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ Community Service ร่วมด้วย อยู่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1H301 นักเรียนได้รับการตรวจภาวะโลหิตจาง', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'310\';\r\nSET @activity_cost = \'40\';\r\nSET @lab_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @commu_set = \'1H301\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_hct)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND (   timestampdiff(MONTH, person.birthdate, lab_head.order_date) BETWEEN 6\r\n                                                                              AND 60\r\n           OR timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 0\r\n                                                                             AND 5)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('11', '606', 'LAB ตรวจความเข้มข้นของเม็ดเลือด HCT,HB ผู้ที่ BMI น้อยกว่า 18.5 อายุ 35 - 59 ปี', '1', '30', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ CBC,HB,HCT ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- ต้องมี BMI น้อยกว่า 18.5', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'606\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) < 18.5\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hct) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hb) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('12', '607', 'LAB ตรวจวัดระดับโคเลสเตอรอลในเลือด ผู้ที่ BMI มากกว่า 25 อายุ 35 - 59 ปี', '1', '60', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ Total Cholestorol ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 5 ปี/คน/ครั้ง', '-', '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ Cholesterol\r\n- ต้องมีผล ของ Triglyceride\r\n- ต้องมีผล ของ HDL\r\n- ต้องมีผล ของ LDL\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'607\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_cho =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541602\');\r\nSET @lab_name_tri =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0546602\');\r\nSET @lab_name_hdl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541202\');\r\nSET @lab_name_ldl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541402\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_cho) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_tri) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hdl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_ldl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('13', '608', 'LAB ตรวจ Fasting Plasma Glucose ผู้ที่ BMI มากกว่า 25 อายุ 35 - 59 ปี', '1', '40', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ Fasting Plasma Glucose ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง หรือผู้ที่ประวัติญาติสายตรงเป็น DM หรือ ผู้ที่เคยตรวจพบความทนต่อกลูโคสผิดปกติ หรือ เคยตรวจพบระดับกลูโคสพลาสมาผิดปกติ', '-', '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล Glucose\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'608\';\r\nSET @activity_cost = \'40\';\r\nSET @lab_name_fbs =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0531002\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref, @lab_name_fbs) >=\r\n                     1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('14', '616', 'หมันหญิง', '1', '2000', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพิ่มอัตราคุมกำเนิด', '-', '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- เพศหญิงเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z302\r\n    Z302 Sterilization การทำหมัน\r\n', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'616\';\r\nSET @activity_cost = \'2000\';\r\nSET @icd10 = \'Z302\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub,\r\n       provis_instype.code                        AS local_instype_code,\r\n       provis_instype.name                        AS local_instype_name,\r\n       provis_instype.pttype_std_code             AS instype_code,\r\n       pttype.name                                AS instype_name,\r\n       ovst.hospmain                              AS instype_main,\r\n       ovst.hospsub                               AS instype_hsub,\r\n       ovst.pttypeno                              AS instype_id\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND person.sex = 2\r\n      AND person.nationality = 99\r\nGROUP BY person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('15', '617', 'หมันชาย', '1', '1500', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพิ่มอัตราคุมกำเนิด', '-', '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- เพศชายเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z302\r\n    Z302 Sterilization การทำหมัน\r\n', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'617\';\r\nSET @activity_cost = \'1500\';\r\nSET @icd10 = \'Z302\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub,\r\n       provis_instype.code                        AS local_instype_code,\r\n       provis_instype.name                        AS local_instype_name,\r\n       provis_instype.pttype_std_code             AS instype_code,\r\n       pttype.name                                AS instype_name,\r\n       ovst.hospmain                              AS instype_main,\r\n       ovst.hospsub                               AS instype_hsub,\r\n       ovst.pttypeno                              AS instype_id\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND person.sex = 1\r\n      AND person.nationality = 99\r\nGROUP BY person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('16', '618', 'LAB คัดกรองโลหิตจาง CBC,HB,HCT วัยรุ่นที่เริ่มมีประจำเดือน 14 - 24 ปี', '1', '60', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nราชกิจจานุเบกษา ประกาศคณะกรรมการหลักประกันสุขภาพแห่งชาติ เรื่อง \"ประเภทและขอบเขตของบริการสาธารณสุข พ.ศ. ๒๕๖๕\"', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตรวจ นับเม็ดเลือด CBC,HB,HCT วัยรุ่นหญิงที่เริ่มมีประจำเดือน อายุ 13 - 24 ปี', '04 กลุ่มเด็กและวัยรุ่นอายุ 6 - 24 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 13 - 24  ปีเท่านั้น เพื่อให้ตรงกับประกาศฯ วัยรุ่นหญิงที่เริ่มมีประจำเดือน (อายุ 13 - 24 ปี) ความถี่ อย่างน้อย 1 ครั้ง\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'618\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_name_hct)\r\n      AND find_in_set(lab_order.lab_items_name_ref, @lab_name_hb)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND (timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 13\r\n                                                                          AND 24)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('17', '619', 'LAB คัดกรองโลหิตจาง HCT วัยรุ่นที่เริ่มมีประจำเดือน 14 - 24 ปี', '1', '30', '1', '1', 'ราชกิจจานุเบกษา ประกาศคณะกรรมการหลักประกันสุขภาพแห่งชาติ เรื่อง \"ประเภทและขอบเขตของบริการสาธารณสุข พ.ศ. ๒๕๖๕\"', 'กลุ่มเด็กโตและวัยรุ่น 6 - 24 ปี\r\nบริการคัดกรองโลหิตจางจากการขาดธาตุเหล็ก\r\n-ตรวจนับเม็ดเลือดอย่างสมบรูณ์(CBC) หรือ ตรวจวัดระดับความเข็มข้นของเม็ดเลือดแดง(Hb)หรือปริมาตรเม็ดเลือดแดงอัดแน่น(Hct)\r\n-รายที่ผิดปกติ จะได้ดูแลต่อเนื่อง\r\nกลุ่มเป้าหมาย\r\n-เด็กอายุ 6 ปี (ถ้าไมได้ตรวจเมื่อาอยุ 3 - 5 ปี) ความถี่ อย่างน้อย 1 ครั้ง\r\n-วัยรุ่นหญิงที่เริ่มมีประจำเดือน (อายุ 13 - 24 ปี) ความถี่ อย่างน้อย 1 ครั้ง\r\nที่มาจาก ราชกิจจานุเบกษา ประกาศคณะกรรมการหลักประกันสุขภาพแห่งชาติ เรื่อง \"ประเภทและขอบเขตของบริการสาธารณสุข พ.ศ. ๒๕๖๕\"', '04 กลุ่มเด็กและวัยรุ่นอายุ 6 - 24 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 13 - 24  ปีเท่านั้น เพื่อให้ตรงกับประกาศฯ วัยรุ่นหญิงที่เริ่มมีประจำเดือน (อายุ 13 - 24 ปี) ความถี่ อย่างน้อย 1 ครั้ง\r\n- ต้องมีผล ของ HCT\r\n', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'619\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @commu_set = \'1H301\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_hct)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND (timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 13\r\n                                                                          AND 24)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('18', '621', 'Pap Smear นอกกลุ่มเป้าหมาย', '1', '150', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ การตรวจคัดกรองมะเร็งปากมดลูก ที่ รพ.สต. เป็นรูปแบบ HPV DNA TEST\r\nและ ระดับ รพ.สต. ส่งตรวจแลปไปยัง โรงพยาบาลแม่ข่ายในสังกัด \r\nส่วนในระดับ โรงพยาบาล สามารถเบิกได้ใน หญิงทั่วไปนอกกลุ่มเป้าหมาย,หญิงหลังคลอด\r\n', null, '05 กลุ่มผู้ใหญ่ 25 - 59 ปี', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- ต้องเป็น Type Area 1,2,3,4 เท่านั้น\r\n- เพศหญิงเท่านั้น\r\n- อายุ 25 - 59 ปี \r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z124,Z014\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ร่วมด้วยดังนี้\r\n1B30    ผลการตรวจคัดกรองมะเร็งปากมดลูก ผลปกติ\r\n1B40    ผลการตรวจคัดกรองมะเร็งปากมดลูก ผลผิดปกติ\r\n', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'621\';\r\nSET @activity_cost = \'150\';\r\nSET @icd10set = \'z124,z014\';\r\nSET @ppset = \'1b30,1b40\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n       local_instype_code,\r\n       local_instype_name,\r\n       instype_code,\r\n       instype_name,\r\n       instype_main,\r\n       instype_hsub,\r\n       instype_id\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                 AS activity_code,\r\n             cast(@activity_cost AS CHAR)                 AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             provis_instype.code\r\n                AS local_instype_code,\r\n             provis_instype.name\r\n                AS local_instype_name,\r\n             provis_instype.pttype_std_code               AS instype_code,\r\n             pttype.name                                  AS instype_name,\r\n             ovst.hospmain                                AS instype_main,\r\n             ovst.hospsub                                 AS instype_hsub,\r\n             ovst.pttypeno                                AS instype_id,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_brest,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_brest_result,\r\n             timestampdiff(YEAR, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n           LEFT OUTER JOIN provis_instype\r\n              ON pttype.nhso_code = provis_instype.code\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND provis_instype.pttype_std_code = \"0100\"\r\n            AND ovst.hospmain = \"10679\"\r\n            AND person.sex = 2\r\n            AND person.nationality = 99\r\n            AND person.house_regist_type_id IN (1,\r\n                                                2,\r\n                                                3,\r\n                                                4)\r\n            AND person.death <> \'y\'\r\n            AND person.death_date IS NULL\r\n            AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) BETWEEN 25\r\n                                                                        AND 59\r\n      GROUP BY person.cid\r\n      HAVING     (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(\r\n                                   pp_special_type.pp_special_code,\r\n                                   @ppset)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n             AND (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(LEFT(ovstdiag.icd10, 4),\r\n                                            @icd10set)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS temp_621\r\nGROUP BY temp_621.cid\r\nORDER BY temp_621.date_serv;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('19', '701', 'คัดกรองผู้สูงอายุ 60 ปี ขึ้นไป', '1', '100', '1', '1', 'ตามแบบประเมินผู้สูงอายุ คู่มือเล่มสีฟ้า มีการใช้สมุดและมีรายละเอียด ครบ 20 รายการ', 'ประกอบด้วย\r\n    สมุดบันทึกประจำตัว\r\n    ประวัติครอบครัวและโรคพันธุกรรม\r\n    ประวัติการเจ็บป่วย\r\n    การเสี่ยงต่อการบาดเจ็บจากการจราจรและอื่นๆ\r\n    การสูบบุหรี่ การดื่มสุรา การใช้สารเสพติด\r\n    การประเมินพฤติกรรมการบริโภคอาหาร\r\n    การมีเพศสัมพันธ์ความเสี่ยงสูงต่อการเกิดโรคติดต่อทางเพศสัมพันธ์ และ การตั้งครรภ์อันไม่พึงประสงค์\r\n    ประเมินความเสี่ยงต่อสุขภาพจากลักษณะงาน\r\n    อาการเตือนของโรคมะเร็ง\r\n    ประเมินความฉลาดทางอารมณ์ของบุคคล\r\n    กระเมินความเครียด ภาวะซึมเศร้า และความเสี่ยงต่อการฆ่าตัวตาย ประเมินโดยเจ้าหน้าที่\r\n    ชั่งน้ำหนัก วัดส่วนสูง ประเมินดัชนีมวลกาย\r\n    ประเมินอ้วนลงพุงโดยวัดเส้นรอบเอว\r\n    วัดความดันโลหิต\r\n    ตรวจสุขภาพช่องปาก\r\n    ตรวจคัดกรองมะเร็งช่องปาก\r\n    วัดสายตาด้วยแผนภูมิสเนลเลน ผู้ที่อายุ 50 ปี ขึ้นไป หรือ ผุ้ที่ขับขี่ยานพาหนะ หรือ ผู้ทีทำงาน ที่ต้องเพ่งสายตา\r\n    ประเมินภาวะสมองเสื่อม\r\n    ตรวจคลำเต้านม\r\n    อาการที่เกี่ยวเนื่องกับภาวะธัยรอยด์', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,2,3,4 เท่านั้น\r\n- ต้องมีการระบุ ค่าอย่างน้อย 6 หมวด ขึ้นไป ของการประเมิน    \r\n    - ความเครียด ซึมเศร้า\r\n    - หกล้ม อุบัติเหตุ\r\n    - ภาวะสมองเสื่อม\r\n    - ภาวะสายตา\r\n    - ภาวะช่องปาก\r\n    - ข้อเข่า\r\n- แนะนำให้ทำหมวดอื่นด้วย เพื่อความครบถ้วนของรายงาน HDC \r\n    - LTC\r\n    - ADL\r\n    - CVD\r\n    - BLADDER\r\n    - กลั้่นปัสสาวะ\r\n    - คัดกรองบุหรี่\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'701\';\r\nSET @activity_cost = \'100\';\r\nSET @2q = \'1b0280,1b0281\';\r\nSET @9q = \'1b0282,1b0283,1b0284,1b0285\';\r\nSET @st5 = \'1b0286,1b0287\';\r\nSET @8q = \'1b0270,1b0271,1b0272,1b0273\';\r\nSET @accident = \'1b1200,1b1201,1b1202\';\r\nSET @amt = \'1b1220,1b1221,1b1223\';\r\nSET @mmset2002 = \'1b1224,1b1225,1b1226\';\r\nSET @cvd = \'1b1230,1b1231,1b1232,1b1233,1b1234,1b1235\';\r\nSET @eye_min = \'1b1240,1b1241,1b1242\';\r\nSET @eye_max = \'1b1243,1b1244,1b1245\';\r\nSET @eye_mirror = \'1b1250,1b1251,1b1252\';\r\nSET @eye_stone = \'1b1253,1b1254,1b1255\';\r\nSET @eye_retina = \'1b1256,1b1257,1b1258\';\r\nSET @mouth = \'1b1260,1b1261\';\r\nSET @knee = \'1b1270,1b1271,1b1272\';\r\n-- set @ltc                 = \'1b1273,1b1274,1b1275\' ;\r\nSET @adl = \'1b1280,1b1281,1b1282\';\r\n-- set @blader         = \'1b1284,1b1285\' ;\r\nSET @smoke = \'1b501,1b502,1b503,1b504,1b505,1b506,1b51,1b52\';\r\nSET @breast = \'1b0030,1b0031,1b0032,1b0033,1b0034,1b0035,1b0036,1b0037\';\r\nSET @sumscore = 6;\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub,\r\n       local_instype_code,\r\n       local_instype_name,\r\n       instype_code,\r\n       instype_name,\r\n       instype_main,\r\n       instype_hsub,\r\n       instype_id\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS char)      AS activity_code,\r\n             cast(@activity_cost AS char)      AS activity_cost,\r\n             cast(max(ovst.vstdate) AS char)   AS date_serv,\r\n             cast(@h_sub AS char)              AS h_sub,\r\n             provis_instype.code               AS local_instype_code,\r\n             provis_instype.name               AS local_instype_name,\r\n             provis_instype.pttype_std_code    AS instype_code,\r\n             pttype.name                       AS instype_name,\r\n             ovst.hospmain                     AS instype_main,\r\n             ovst.hospsub                      AS instype_hsub,\r\n             ovst.pttypeno                     AS instype_id,\r\n             ovst.hn,\r\n             cast(max(ovst.vn) AS char)        AS vn,\r\n             person.birthdate,\r\n             -- round(datediff(max(ovst.vstdate), person.birthdate) / 365.25)\r\n             TIMESTAMPDIFF(Year, person.birthdate, max(ovst.vstdate))\r\n                AS current_age,\r\n             -- metal group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @2q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 2q,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @9q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 9q,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @st5)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS st5,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @8q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 8q,\r\n             -- acident\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @accident)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS accident,\r\n             -- brain remember\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @amt)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS amt,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @mmset2002)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS mmset2002,\r\n             -- cvd\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @cvd)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS cvd,\r\n             -- eye group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_min)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_min,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_max)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_max,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_mirror)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_mirror,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_stone)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_stone,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_retina)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_retina,\r\n             -- mouth\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @mouth)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS mouth,\r\n             -- knee\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @knee)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS knee,\r\n             -- ltc\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @ltc)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS ltc,\r\n             -- adl\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @adl)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS adl,\r\n             -- blader\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @blader)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS blader,\r\n             -- smoke\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @smoke)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS smoke,\r\n             -- cancer group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @breast)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS breast,\r\n             (                                                -- 1 metal group\r\n              ( CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @2q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @9q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @st5)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @8q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                   -- 2 acident\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @accident)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                            -- 3 brain remember\r\n               (CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @amt)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @mmset2002)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                 -- 4 eye group\r\n               (CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_min)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_max)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_mirror)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_stone)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_retina)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                     -- 5 mouth\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @mouth)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                      -- 6 knee\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @knee)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                       -- 7 ltc\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @ltc)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                    -- 8 blader\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @blader)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END))\r\n                AS sum_score_in_case\r\n      FROM ovst\r\n           LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n           LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n           LEFT OUTER JOIN provis_instype\r\n              ON pttype.nhso_code = provis_instype.code\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND provis_instype.pttype_std_code = \"0100\"\r\n            AND ovst.hospmain = \"10679\"\r\n            AND person.nationality = 99\r\n            AND person.sex IN (1, 2)\r\n            AND (   (person.death <> \'y\' AND person.discharge_date IS NULL)\r\n                 OR (    person.death = \'y\'\r\n                     AND person.discharge_date > ovst.vstdate\r\n                     AND ovst.vstdate BETWEEN @start_date AND @stop_date))\r\n            AND person.house_regist_type_id IN (1,\r\n                                                2,\r\n                                                3,\r\n                                                4)\r\n      GROUP BY person.cid\r\n      HAVING     timestampdiff(year, person.birthdate, max(ovst.vstdate)) >=\r\n                    60\r\n             AND                                            -- start sum value\r\n                (                                             -- 1 metal group\r\n                 ( CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @2q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @9q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @st5)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @8q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                -- 2 acident\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @accident)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                         -- 3 brain remember\r\n                  (CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @amt)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @mmset2002)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                              -- 4 eye group\r\n                  (CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_min)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_max)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_mirror)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_stone)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_retina)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                  -- 5 mouth\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @mouth)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                   -- 6 knee\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @knee)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)                             -- เอาออก เพราะ hdc ไม่เอา\r\n                                                                          -- +\r\n                                                                   -- -- 7 ltc\r\n                                                                 -- (case when\r\n                                                                          -- (\r\n                 -- sum(case when find_in_set(pp_special_type.pp_special_code,@ltc) then 1 else 0 end)\r\n                 -- ) >= 1 then 1 else 0 end)\r\n\r\n                                                    -- เอาออก เพราะ hdc ไม่เอา\r\n                                                                          -- +\r\n                                                                -- -- 8 blader\r\n                                                                 -- (case when\r\n                                                                          -- (\r\n-- sum(case when find_in_set(pp_special_type.pp_special_code,@blader) then 1 else 0 end)\r\n-- ) >= 1 then 1 else 0 end)\r\n                                                                            --\r\n                 ) >= @sumscore\r\n      -- stop sum value\r\n\r\n      ORDER BY ovst.hn, ovst.vn) AS temp_701;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('20', '702', 'ประเมินกิจวัตรประจำวัน ADL ตามคู่มือ 12 รายการ', '1', '20', '1', '1', 'สามารถติดตามรายงานเบื้องต้นได้ที่ ระบบรายงาน HDC \r\nระบบ HDC ประเมินจากผู้สูงอายุไทย อายุตั้งแต่ 60 ปีบริบูรณ์ขึ้นไป ในเขตพื้นที่รับผิดชอบ TypeArea(1,3)\r\n-กลุ่มรายงานมาตรฐาน \r\n-การคัดกรอง\r\n-จำนวนผู้สูงอายุในเขตพื้นที่รับผิดชอบ จำแนกตามความสามารถในการทำกิจวัตรประจำวัน', 'ระบบ HDC ประเมินจากผู้สูงอายุไทย อายุตั้งแต่ 60 ปีบริบูรณ์ขึ้นไป ในเขตพื้นที่รับผิดชอบ\r\n- เป็นทะเบียนแบบสะสม ไม่ว่าจะถูกประเมินปีใดสถานพยาบาลใดก็ตาม จะนำผลครั้งสุดท้ายที่ถูกประเมินมารายงาน (ทะเบียน Register)\r\n- ตัดความซ้ำซ้อนและเชื่อมโยงประวัติด้วยเลขบัตรประชาชน 1 คนจะมีเพียง 1 record ด้วยเลขบัตรประชาชน\r\n\r\nแฟ้มที่ใช้ในการประเมิน SPECIALPP รหัสที่ใช้ในการประเมิน คือ\r\n- รหัส 1B1280 ติดสังคม (ADL 12-20 คะแนน)\r\n- รหัส 1B1281 ติดบ้าน (ADL 5-11 คะแนน)\r\n- รหัส 1B1282 ภาวะติดเตียง (ADL 0-4 คะแนน)', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,2,3,4 เท่านั้น\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรอง ADL\r\n    1B1280 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวันพบว่าช่วยเหลือตัวเองได้ /ติดสังคม (ADL 12-20 คะแนน)\r\n    1B1281 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวันพบว่าช่วยเหลือตัวเองได้บ้าง / บางส่วน /ติดบ้าน (ADL 5-11 คะแนน)\r\n    1B1282 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวัน พบว่าช่วยเหลือตัวเองได้น้อย / ไม่ได้เลย /ภาวะติดเตียง (ADL 0-4 คะแนน)\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'702\';\r\nSET @activity_cost = \'20\';\r\nSET @ppset = \'1b1280,1b1281,1b1282\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub,\r\n       provis_instype.code                        AS local_instype_code,\r\n       provis_instype.name                        AS local_instype_name,\r\n       provis_instype.pttype_std_code             AS instype_code,\r\n       pttype.name                                AS instype_name,\r\n       ovst.hospmain                              AS instype_main,\r\n       ovst.hospsub                               AS instype_hsub,\r\n       ovst.pttypeno                              AS instype_id\r\nFROM person\r\n     LEFT OUTER JOIN ovst ON person.patient_hn = ovst.hn\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n     LEFT OUTER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) >= 60\r\n      AND person.house_regist_type_id IN (1,\r\n                                          2,\r\n                                          3,\r\n                                          4)\r\n      AND person.nationality = 99\r\n      AND (   (person.death <> \'y\' AND person.discharge_date IS NULL)\r\n           OR (person.death = \'y\' AND person.death_date > ovst.vstdate))\r\n      AND person.sex IN (1, 2)\r\n      AND find_in_set(pp_special_type.pp_special_code, @ppset)\r\nGROUP BY person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('21', '703', 'คัดกรองปัจจัยเสี่ยงต่อการเกิดโรคหัวใจและหลอดเลือดสมอง Thai ASCVD Score', '1', '10', '1', '1', 'ระบบรายงาน HDC การคัดกรองผู้สูงอายุ 10 เรื่อง\r\nเป้าหมาย คือ ผู้สูงอายุในเขตรับผิดชอบ จากแฟ้ม PERSON Typearea 1,3\r\nผลงาน แต่เรื่องละประเมินดังนี้\r\n- คัดกรอง CVD จากแฟ้ม CHRONIC , CHRONICFU , LABFU , NCDSCREEN\r\nแต่ในระบบ PBS จะใช้ PP SPECIAL', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,2,3,4 เท่านั้น\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรอง ADL\r\n    1B1230 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่าไม่มีความเสี่ยง\r\n    1B1231 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยง\r\n    1B1232 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยงสูง\r\n    1B1234 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยงสูงมาก ให้คำแนะนำ / รักษา\r\n    1B1235 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุพบว่ามีความเสี่ยงสูงมาก รักษาต่อ\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'703\';\r\nSET @activity_cost = \'10\';\r\nSET @ppset = \'1b1230,1b1231,1b1232,1b1233,1b1234,1b1235\';\r\n\r\n\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub,\r\n       provis_instype.code                        AS local_instype_code,\r\n       provis_instype.name                        AS local_instype_name,\r\n       provis_instype.pttype_std_code             AS instype_code,\r\n       pttype.name                                AS instype_name,\r\n       ovst.hospmain                              AS instype_main,\r\n       ovst.hospsub                               AS instype_hsub,\r\n       ovst.pttypeno                              AS instype_id\r\nFROM person\r\n     LEFT OUTER JOIN ovst ON person.patient_hn = ovst.hn\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n     LEFT OUTER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) >= 60\r\n      AND person.house_regist_type_id IN (1,\r\n                                          2,\r\n                                          3,\r\n                                          4)\r\n      AND person.nationality = 99\r\n      AND (   (person.death <> \'y\' AND person.discharge_date IS NULL)\r\n           OR person.death_date < ovst.vstdate)\r\n      AND person.sex IN (1, 2)\r\n      AND find_in_set(pp_special_type.pp_special_code, @ppset)\r\nGROUP BY person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('22', '704', 'LAB ตรวจความเข้มข้นของเม็ดเลือด HCT,HB ผู้ที่ BMI น้อยกว่า 18.5 อายุ 60 ปีขึ้นไป', '1', '30', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ CBC,HB,HCT ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปี ขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- ต้องมี BMI น้อยกว่า 18.5', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'704\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) >= 60\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) < 18.5\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hct) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hb) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('23', '705', 'LAB ตรวจวัดระดับโคเลสเตอรอลในเลือด ผู้ที่ BMI มากกว่า 25 อายุ 60 ปีขึ้นไป', '1', '60', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ Total Cholestorol ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 5 ปี/คน/ครั้ง', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปีขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ Cholesterol\r\n- ต้องมีผล ของ Triglyceride\r\n- ต้องมีผล ของ HDL\r\n- ต้องมีผล ของ LDL\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'705\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_cho =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541602\');\r\nSET @lab_name_tri =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0546602\');\r\nSET @lab_name_hdl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541202\');\r\nSET @lab_name_ldl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541402\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) >= 60\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_cho) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_tri) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hdl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_ldl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('24', '706', 'LAB ตรวจ Fasting Plasma Glucose ผู้ที่ BMI มากกว่า 25 อายุ 60 ปีขึ้นไป', '1', '40', '0', '1', 'เบิกชดเชยได้เฉพาะ ระดับ โรงพยาบาล เท่านั้น\r\nเพราะข้อจำกัด การให้บริการ Fasting Plasma Glucose ที่ รพ.สต. ยังไม่สามาถให้บริการเองได้\r\nตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง หรือผู้ที่ประวัติญาติสายตรงเป็น DM หรือ ผู้ที่เคยตรวจพบความทนต่อกลูโคสผิดปกติ หรือ เคยตรวจพบระดับกลูโคสพลาสมาผิดปกติ', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปีขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล Glucose\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'706\';\r\nset @activity_cost = \'40\';\r\nSET @lab_name_fbs =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0531002\');\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub,\r\n       provis_instype.code               AS local_instype_code,\r\n       provis_instype.name               AS local_instype_name,\r\n       provis_instype.pttype_std_code    AS instype_code,\r\n       pttype.name                       AS instype_name,\r\n       ovst.hospmain                     AS instype_main,\r\n       ovst.hospsub                      AS instype_hsub,\r\n       ovst.pttypeno                     AS instype_id\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\n     LEFT OUTER JOIN ovst ON lab_head.vn = ovst.vn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) >= 60\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref, @lab_name_fbs) >=\r\n                     1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('25', '806', 'การเยี่ยมบ้าน HOME HEALTH CARE ไม่มีหัตถการ หน่วยบริการ กำหนดเอง', '12', '50', '1', '1', '- ต้อง ไม่ซ้ำซ้อนกับการชดเชย ในกลุ่ม อปท. หรือ ที่มีการจัดให้อยู่แล้ว\r\n- เยี่ยมตามเกณฑ์ FCT มีใบส่งตัวจากโรงพยาบาล', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- ต้อง ให้บริการนอกสถานบริการ\r\n- บันทึกในระบบ One Stop service\r\n- ใส่ รหัส 806 เมื่อเริ่มข้อความในระบบ CC\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1A11 เยี่ยมผู้ป่วยที่มีใบติดตามจากโรงพยาบาล\r\n    1A12 เยี่ยมผู้ป่วยที่ต้องการดูแลอย่างต่อเนื่องจากโรงพยาบาล\r\n    1A14 เยี่ยมผู้ป่วยหลังจากรับ/ส่งต่อ (refer) จากโรงพยาบาล\r\n    1A18 เยี่ยมผู้ป่วยหลังได้รับการรักษาอื่นๆ\r\n - หน่วยบริการ เป็นผู้กำหนด กิจกรรมเอง ว่าเป็นแบบ มีหัตถการ หรือ ไม่มีหัตถการโดยดูกิจกรรมที่ให้บริการ บริบท ต่างๆ ประกอบ', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'806\';\r\nSET @activity_cost = \'50\';\r\nSET @commuset = \'1a11,1a12,1a14,1a18\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS char)   AS activity_code,\r\n       cast(@activity_cost AS char)   AS activity_cost,\r\n       cast(ovst.vstdate AS char)     AS date_serv,\r\n       cast(@h_sub AS char)           AS h_sub,\r\n       provis_instype.code            AS local_instype_code,\r\n       provis_instype.name            AS local_instype_name,\r\n       provis_instype.pttype_std_code AS instype_code,\r\n       pttype.name                    AS instype_name,\r\n       ovst.hospmain                  AS instype_main,\r\n       ovst.hospsub                   AS instype_hsub,\r\n       ovst.pttypeno                  AS instype_id\r\n-- ,\r\n--     opdscreen.cc,\r\n--     group_concat(distinct er_oper_code. name) as proced,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_code\r\n--     ) as commu_code,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_name\r\n--     ) as commu_name\r\nFROM ovst\r\n     LEFT OUTER JOIN ovst_community_service\r\n        ON ovst.vn = ovst_community_service.vn\r\n     LEFT OUTER JOIN ovst_community_service_type\r\n        ON ovst_community_service.ovst_community_service_type_id =\r\n              ovst_community_service_type.ovst_community_service_type_id\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN doctor_operation ON ovst.vn = doctor_operation.vn\r\n     LEFT OUTER JOIN er_oper_code\r\n        ON doctor_operation.er_oper_code = er_oper_code.er_oper_code\r\n     LEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND LEFT(Trim(opdscreen.cc), 3) = @activity_code\r\n      AND ovst.at_hospital = \'N\'\r\nGROUP BY ovst.hn, ovst.vstdate\r\nHAVING sum(\r\n          CASE\r\n             WHEN find_in_set(\r\n                     ovst_community_service_type.ovst_community_service_type_code,\r\n                     @commuset) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY ovst.hn, ovst.vstdate;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('26', '807', 'การเยี่ยมบ้าน HOME HEALTH CARE มีหัตถการ  หน่วยบริการ กำหนดเอง', '240', '100', '1', '1', '- ต้อง ไม่ซ้ำซ้อนกับการชดเชย ในกลุ่ม อปท. หรือ ที่มีการจัดให้อยู่แล้ว\r\n- เยี่ยมตามเกณฑ์ FCT มีใบส่งตัวจากโรงพยาบาล', '-', '09 กลุ่มผู้สูงอายุ 60 ปีขึ้น', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\nSET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\n- เฉพาะกลุ่ม UCS/WEL ในเครือข่ายเท่านั้น\r\n- บันทึกในระบบ One Stop service\r\n- ใส่ รหัส 807 เมื่อเริ่มข้อความในระบบ CC\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1A11 เยี่ยมผู้ป่วยที่มีใบติดตามจากโรงพยาบาล\r\n    1A12 เยี่ยมผู้ป่วยที่ต้องการดูแลอย่างต่อเนื่องจากโรงพยาบาล\r\n    1A14 เยี่ยมผู้ป่วยหลังจากรับ/ส่งต่อ (refer) จากโรงพยาบาล\r\n    1A18 เยี่ยมผู้ป่วยหลังได้รับการรักษาอื่นๆ\r\n - หน่วยบริการ เป็นผู้กำหนด กิจกรรมเอง ว่าเป็นแบบ มีหัตถการ หรือ ไม่มีหัตถการโดยดูกิจกรรมที่ให้บริการ บริบท ต่างๆ ประกอบ', 'SET @start_date = date(\'2022-10-01\');\r\nSET @stop_date = date(\'2023-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'807\';\r\nSET @activity_cost = \'50\';\r\nSET @commuset = \'1a11,1a12,1a14,1a18\';\r\n\r\n-- <process> insert ignore into pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub,local_instype_code,local_instype_name,instype_code,instype_name,instype_main,instype_hsub,instype_id)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS char)   AS activity_code,\r\n       cast(@activity_cost AS char)   AS activity_cost,\r\n       cast(ovst.vstdate AS char)     AS date_serv,\r\n       cast(@h_sub AS char)           AS h_sub,\r\n       provis_instype.code            AS local_instype_code,\r\n       provis_instype.name            AS local_instype_name,\r\n       provis_instype.pttype_std_code AS instype_code,\r\n       pttype.name                    AS instype_name,\r\n       ovst.hospmain                  AS instype_main,\r\n       ovst.hospsub                   AS instype_hsub,\r\n       ovst.pttypeno                  AS instype_id\r\n-- ,\r\n--     opdscreen.cc,\r\n--     group_concat(distinct er_oper_code. name) as proced,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_code\r\n--     ) as commu_code,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_name\r\n--     ) as commu_name\r\nFROM ovst\r\n     LEFT OUTER JOIN ovst_community_service\r\n        ON ovst.vn = ovst_community_service.vn\r\n     LEFT OUTER JOIN ovst_community_service_type\r\n        ON ovst_community_service.ovst_community_service_type_id =\r\n              ovst_community_service_type.ovst_community_service_type_id\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN doctor_operation ON ovst.vn = doctor_operation.vn\r\n     LEFT OUTER JOIN er_oper_code\r\n        ON doctor_operation.er_oper_code = er_oper_code.er_oper_code\r\n     LEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\n     LEFT OUTER JOIN pttype ON ovst.pttype = pttype.pttype\r\n     LEFT OUTER JOIN provis_instype\r\n        ON pttype.nhso_code = provis_instype.code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND provis_instype.pttype_std_code = \"0100\"\r\n      AND ovst.hospmain = \"10679\"\r\n      AND LEFT(Trim(opdscreen.cc), 3) = @activity_code\r\n      AND ovst.at_hospital = \'N\'\r\nGROUP BY ovst.hn, ovst.vstdate\r\nHAVING sum(\r\n          CASE\r\n             WHEN find_in_set(\r\n                     ovst_community_service_type.ovst_community_service_type_code,\r\n                     @commuset) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY ovst.hn, ovst.vstdate;', null, 'inforeportable', 'inforeportable', '2023-03-20', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('27', '808', 'ไม่สามารถเบิกได้ ปี 2565 กิจกรรมการค้นหาผู้ป่วยวัณโรคโดยใช้ Verbal Screening', '1', '10', '0', '0', 'เงิ่อนไขซ้ำซ้อนกับการบันทึกข้อมูลเบิกเงิน จาก สปสช. และ ยังไม่มีการชีแจงรายละเอียดกิจกรรม ในระบบการบันทึกข้อมูล HIS', 'เบิก จากแม่ข่าย\r\nเฉพาะในกรณีที่ไม่ใด้\r\nเบิกจาก สปสช.\r\n(ทั้งนี้ ยังต้องคีย์ข้อมูล\r\nเข้า โปรแกรม TB\r\nDATA Hub\r\nตามปกติ\r\n\r\n\r\n', '10 ไม่ระบุ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', null, null, null, 'inforeportable', 'inforeportable', '2023-03-20', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('28', '106', 'ไม่สามารถเบิกได้ ตรวจครรภ์ทึ่ไม่อยู่ในกลุ่มที่กำหนด', '1', '60', '0', '0', 'เงิ่อนไขซ้ำซ้อนกับการบันทึกข้อมูลเบิกเงิน จาก สปสช. และ ยังไม่มีการชีแจงรายละเอียดกิจกรรม ในระบบการบันทึกข้อมูล HIS', null, '01 กลุ่มหญิงตั้งครรภ์', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณ สร้างเสริมสุขภาพและป้องกันโรคของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2566 (Cost P&P)					\r\n\"กิจกรรม PP 66\" สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nLink https://drive.google.com/drive/folders/1qXaeW-dZSo54UlIAYz7ngJYK3Lk_WvdD', null, null, null, 'inforeportable', 'inforeportable', '2023-03-20', '0', null, null, null);
