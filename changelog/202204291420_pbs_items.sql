-- 2022-04-29 14:20:31


SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for pbs_items
-- ----------------------------
DROP TABLE IF EXISTS `pbs_items`;
CREATE TABLE `pbs_items` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `activity_code` varchar(3) NOT NULL,
  `activity_name` mediumtext NOT NULL,
  `activity_unit` mediumtext NOT NULL,
  `activity_cost` mediumtext NOT NULL,
  `hospital_sub` int(11) DEFAULT NULL,
  `hospital_main` int(11) DEFAULT NULL,
  `etc` mediumtext,
  `activity_note` mediumtext,
  `activity_group` mediumtext NOT NULL,
  `activity_source` mediumtext,
  `sql_desc` mediumtext,
  `sql_code` mediumtext,
  `how_rec` mediumtext,
  `signature` mediumtext,
  `editor` mediumtext,
  `lastupdate` date DEFAULT NULL,
  `active_status` int(11) DEFAULT NULL,
  `limit_per_hospital` mediumint(7) unsigned DEFAULT NULL,
  `limit_spce_day` smallint(4) unsigned DEFAULT NULL,
  `limit_quarter` smallint(4) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `activity_code` (`activity_code`) USING BTREE
) ;

-- ----------------------------
-- Records of pbs_items
-- ----------------------------
INSERT INTO `pbs_items` VALUES ('1', '101', 'ตรวจการตั้งครรภ์(Pregnancy Test)', '1', '60', '1', '1', 'เบิกจากงบ PPB,PPA,กองทุนท้องถิ่น งบใดงบหนึ่ง', '-', '01 หญิงมีครรภ์', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    set @start_date  = date(\'2021-10-01\') ;\r\n    set @stop_date  = date(\'2022-03-31\') ;\r\n- ต้องมีการจ่ายยา ค่าบริการ หรือ อุปกรณ์ สำหรับตรวจการตั้งครรภ์ โดยสามารถเปลี่ยนชื่อได้ที่\r\n    set @preg_name = concat(\'%\',\'preg\',\'%\');\r\n- ต้องมีการระบุผลการตรวจโดยรหัสวินิจฉัยร่วมด้วยดังนี้\r\n    z320 negative\r\n    z321 positive\r\n- คำสั่ง SQL จะไปค้นหาทั้งหมดใน รายการยา หรือ ค่าบริการ อย่างใดอย่างหนึ่ง\r\n- เพศหญิงเท่านั้น\r\n- สัญชาติไทยเท่านั้น', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'101\';\r\nSET @activity_cost := \'60\';\r\nSET @preg_name = concat(\'%\', \'preg\' \'%\');\r\nSET @icd10set = \'z320,z321\';\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\nSELECT cid,\r\npname,\r\nfname,\r\nlname,\r\nactivity_code,\r\nactivity_cost,\r\ndate_serv,\r\nh_sub\r\nFROM ((SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                  AS activity_code,\r\n        cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n        date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n        @h_sub                                        AS h_sub\r\n        FROM opitemrece\r\n        INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n        LEFT OUTER JOIN village\r\n        ON person.village_id = village.village_id\r\n        LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n        LEFT OUTER JOIN nondrugitems\r\n        ON opitemrece.icode = nondrugitems.icode\r\n        LEFT OUTER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n        WHERE     person.sex = 2\r\n        AND person.death <> \'y\'\r\n        AND (   nondrugitems.NAME LIKE @preg_name\r\n        AND find_in_set(ovstdiag.icd10, @icd10set))\r\n        AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n        AND person.nationality = 99\r\n        GROUP BY person.cid\r\n    ORDER BY opitemrece.vstdate)\r\n    UNION ALL\r\n    (SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                  AS activity_code,\r\n        cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n        date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n        @h_sub                                        AS h_sub\r\n        FROM opitemrece\r\n        INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n        LEFT OUTER JOIN village\r\n        ON person.village_id = village.village_id\r\n        LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n        LEFT OUTER JOIN drugitems\r\n        ON opitemrece.icode = drugitems.icode\r\n        LEFT OUTER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n        WHERE     person.sex = 2\r\n        AND person.death <> \'y\'\r\n        AND (   drugitems.NAME LIKE @preg_name\r\n        AND find_in_set(ovstdiag.icd10, @icd10set))\r\n        AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n        AND person.nationality = 99\r\n        GROUP BY person.cid\r\nORDER BY opitemrece.vstdate)) AS temp_101\r\nGROUP BY cid, activity_code, date_serv;', null, 'Fix Stable 2022-04-23 PBS 101', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('77', '213', 'Follow DSPM ประเมินพัฒนาการเด็ก 0 - 5 ปี สงสัยล่าช้า  (9,18,30,42,60 เดือน)', '1', '10', '1', '1', 'คู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'กิจกรรมเดิม (QOF) เพิ่มเพื่อขับเคลื่อนงาน\r\nประเมินพัฒนาการเด็ก 0 - ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง (ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ในคำสั่ง มีการอำนวนความสะดวก ปรับ วันที่ บันทึก PP Special ให้ตรงกับวันที่รับบริการ ในกรณีที่หน่วยบริการ บันทึกข้อมูลไม่ทัน และย้อนหลังวันที่ เครื่อง ไปบันทึก PP Special สามารถเอาออกได้หากไม่ต้องการปรับปรุง    \r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n    1B200 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลปกติ\r\n    1B201 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B202 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B203 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPMผลปกติ\r\n    1B204 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B205 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B209 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM และ หรือ DAIM ไม่ระบุรายละเอียด\r\n    1B210 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B211 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B212 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B213 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B214 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B215 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B219 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B220 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B221 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B222 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B223 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B224 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B225 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B229 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B230 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B231 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B232 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B233 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B234 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B235 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B239 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B240 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B241 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B242 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลล่าช้าส่งเพื่อประเมิน/รักษาต่อ\r\n    1B243 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B244 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B245 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาด้านการช่วยเหลือตัวเองและสังคม โดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B249 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPMและหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B260 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM ผลปกติ\r\n    1B261 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B262 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งต่อทันที', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'213\';\r\nSET @activity_cost = \'10\';\r\n\r\nSET @ppset =\r\n\'1b200|1b201|1b202|1b203|1b204|1b205|1b209|1b210|1b211|1b212|1b213|1b214|1b215|1b219|1b220|1b221|1b222|1b223|1b224|1b225|1b229|1b230|1b231|1b232|1b233|1b234|1b235|1b239|1b240|1b241|1b242|1b243|1b244|1b245|1b249|1b260|1b261|1b262\';\r\nSET @ppset_dis =\r\n\'1B201|1B211|1B221|1B231|1B241|1B261\' ;\r\nUPDATE pp_special\r\nSET pp_special.entry_datetime =\r\n       concat((concat(\'25\', LEFT(pp_special.vn, 2)) - 543),\r\n              \'-\',\r\n              mid(pp_special.vn, 3, 2),\r\n              \'-\',\r\n              mid(pp_special.vn, 5, 2),\r\n              \' \',\r\n              time(pp_special.entry_datetime))\r\nWHERE concat(\'25\', LEFT(pp_special.vn, 2)) <>\r\n         (LEFT(pp_special.entry_datetime, 4) + 543);\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT\r\n    dspm.cid,\r\n    dspm.pname,\r\n    dspm.fname,\r\n    dspm.lname,\r\n    @activity_code AS activity_code,\r\n    @activity_cost AS activity_cost,\r\n    cast(dspm.vstdate AS CHAR) AS date_serv,cast(@h_sub as char) as h_sub\r\nFROM\r\n    (\r\n        SELECT\r\n            q1.*, TIMESTAMPDIFF(DAY, q1.min_date, q2.vstdate),\r\n            q2.vstdate\r\n        FROM\r\n            (\r\n                SELECT\r\n                    person.cid,\r\n                    person.pname,\r\n                    person.fname,\r\n                    person.lname,\r\n                    ovst.hn,\r\n                    min(date(ovst.vstdate)) AS min_date,\r\n                    GROUP_CONCAT(\r\n                        DISTINCT pp_special_type.pp_special_code\r\n                        ORDER BY\r\n                            pp_special_type.pp_special_code\r\n                    ) AS list_pp\r\n                FROM\r\n                    ovst\r\n                INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n                INNER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\n                INNER JOIN person ON ovst.hn = person.patient_hn\r\n                WHERE\r\n                    ovst.vstdate BETWEEN @start_date\r\n                AND @stop_date\r\n                AND TIMESTAMPDIFF(\r\n                    MONTH,\r\n                    person.birthdate,\r\n                    ovst.vstdate\r\n                ) IN (9, 18, 30, 42, 60)\r\n                AND pp_special_type.pp_special_code REGEXP @ppset_dis\r\n                GROUP BY\r\n                    person.cid\r\n            ) AS q1\r\n        INNER JOIN (\r\n            SELECT\r\n                ovst.hn,\r\n                ovst.vstdate,\r\n                pp_special_type.pp_special_code\r\n            FROM\r\n                pp_special\r\n            INNER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\n            INNER JOIN ovst ON ovst.vn = pp_special.vn\r\n            WHERE\r\n                pp_special_type.pp_special_code REGEXP @ppset\r\n            GROUP BY\r\n                ovst.hn,\r\n                ovst.vstdate\r\n        ) AS q2 ON q1.hn = q2.hn\r\n        AND TIMESTAMPDIFF(DAY, q1.min_date, q2.vstdate) BETWEEN 8\r\n        AND 30\r\n    ) AS dspm;', null, 'Fix Stable 2022-04-23 PBS 213', 'InforReportable', '2022-04-24', '1', null, null, null);
INSERT INTO `pbs_items` VALUES ('2', '102', 'สร้างแรงจูงใจเพื่อค้นหาหญิงตั้งครรภ์ให้มาฝากครรภ์ภายใน 12 สัปดาห์', '1', '200', '1', '1', 'เบิกจากงบ PPB,PPA,กองทุนท้องถิ่น งบใดงบหนึ่ง', 'กิจกรรม\r\n    สำรวจ ค้นหาหญิงตั้งครรภ์รายใหม่ในพื้นที่\r\n    ให้ความรู้เชิญชวน และนำหญิงตั้งครรภ์ มาฝากครรภ์ภานใน 12 สัปดาห์', '01 หญิงมีครรภ์', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องมีการลงทะเบียนหญิงตั้งครรภ์ เพศหญิงเท่านั้น\r\n- ต้องมีการลงข้อมูล LMP เพื่อคำนวนช่วงวันที่ การให้บริการที่อยู่ในเงื่อนไข ระหว่าง (7*4) วัน ถึง (7*12) วัน\r\n- ต้องมีการ ระบุประเภท \"ตรวจก่อนคลอด\"\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตั้งครรภ์ Z3*\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'102\';\r\nSET @activity_cost := \'200\';\r\nSET @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(person_anc_service.anc_service_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM person_anc_service\r\n     INNER JOIN person_anc\r\n        ON person_anc.person_anc_id = person_anc_service.person_anc_id\r\n     INNER JOIN person ON person.person_id = person_anc.person_id\r\n     INNER JOIN ovstdiag ON person_anc_service.vn = ovstdiag.vn\r\nWHERE     person_anc_service.anc_service_date BETWEEN @start_date\r\n                                                  AND @stop_date\r\n      AND datediff(person_anc_service.anc_service_date, person_anc.lmp) BETWEEN (  7\r\n                                                                                 * 4)\r\n                                                                            AND (  7\r\n                                                                                 * 12)\r\n      AND datediff(person_anc.anc_register_date, person_anc.lmp) BETWEEN (  7\r\n                                                                          * 4)\r\n                                                                     AND (  7\r\n                                                                          * 12)\r\n      AND person.sex = 2\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND person_anc_service.anc_service_type_id = 1\r\n      AND ovstdiag.icd10 LIKE @icd10set\r\n      AND person_anc.anc_register_date IS NOT NULL\r\nGROUP BY person_anc_service.person_anc_id;', null, 'Fix Stable 2022-04-23 PBS 102', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('10', '110', 'ตรวจหลังคลอด', '1', '150', '1', '1', '-', 'กิจกรรม 1 - 5\r\n    ตรวจเต้านม หัวนม ตามการเลี้ยงดูด้วยนมแม่ ตรวจภายใน\r\n    ประเมินความซึมเศร้าด้วยแบบประเมินตนเอง\r\n    กิจกรรมปรับปเปลี่ยนพฤติกรรม การให้การปรึกษาแนะนำ และการให้ความรู้\r\n    จ่ายยา Triferdine หรือ GPO 150\r\n    Pap Smear(กิจกรรม 111)', '02 หญิงหลังคลอด', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องมีการลงทะเบียนหญิงตั้งครรภ์ เพศหญิงเท่านั้น\r\n- ต้องมีข้อมูลการคลอด วันที่คลอด\r\n- ต้องมีผลการตรวจรางกายทั่วไป เช่น  BP หัวนม การให้นมแม่\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z014*\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ร่วมด้วยดังนี้\r\n    1B140 การตรวจคัดกรองโรคซึมเศร้าในหญิงตั้งครรภ์/หลังคลอดด้วยแบบคัดกรอง 2Q พบว่าผลปกติ\r\n    1B141 การตรวจคัดกรองโรคซึมเศร้าในหญิงตั้งครรภ์/หลังคลอดด้วยแบบคัดกรอง 2Q พบว่าผลผิดปกติ\r\n    1B142 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่าผลปกติ (0 - 4 คะแนน) \r\n    1B143 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่ามีปัญหาความเครียด  (5 - 7 คะแนน)\r\n    1B144 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่ามีความเครียดสูง (8 คะแนนขึ้นไป) \r\n    1B149 การตรวจคัดกรองโรคซึมเศร้า/ประเมินความเครียดในหญิงตั้งครรภ์/หลังคลอด ไม่ระบุรายละเอียด', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'110\';\r\nSET @activity_cost = \'150\';\r\nSET @icd10set = concat(\'z014\', \'%\');\r\nSET @ppset = \'1b14,1b140,1b141,1b142,1b143,1b144,1b149\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)                            AS activity_code,\r\n       cast(@activity_cost AS CHAR)                            AS activity_cost,\r\n       date_format(person_anc_preg_care.care_date, \'%Y-%m-%d\') AS date_serv,\r\n       @h_sub                                                  AS h_sub\r\nFROM person_anc_preg_care\r\n     INNER JOIN person_anc\r\n        ON person_anc_preg_care.person_anc_id = person_anc.person_anc_id\r\n     INNER JOIN person ON person_anc.person_id = person.person_id\r\n     LEFT OUTER JOIN ovstdiag ON person_anc_preg_care.vn = ovstdiag.vn\r\n     LEFT OUTER JOIN pp_special ON person_anc_preg_care.vn = pp_special.vn\r\n     LEFT OUTER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\nWHERE     person_anc_preg_care.care_date BETWEEN @start_date AND @stop_date\r\n      AND person_anc.labor_date < person_anc_preg_care.care_date\r\n      AND person_anc_preg_care.real_preg_care = \'y\'\r\n      AND person_anc_preg_care.bps IS NOT NULL\r\n      AND person_anc_preg_care.bpd IS NOT NULL\r\n      AND person_anc_preg_care.nipple_normal IS NOT NULL\r\n      AND person.sex = 2\r\n      AND person.nationality = 99\r\nGROUP BY person.cid\r\nHAVING     (IF(\r\n               sum(\r\n                  CASE WHEN ovstdiag.icd10 LIKE @icd10set THEN 1 ELSE 0 END) >=\r\n                  1,\r\n               1,\r\n               0)) >= 1\r\n       AND (IF(sum(\r\n                  CASE\r\n                     WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                      @ppset)\r\n                     THEN\r\n                        1\r\n                     ELSE\r\n                        0\r\n                  END) >= 1,\r\n               1,\r\n               0)) >= 1;', null, 'Fix Stable 2022-04-23 PBS 110', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('12', '112', 'การเยี่ยมบ้านหลังคลอด 6 สัปดาห์', '3', '70', '1', '1', '-', 'กิจกรรม 1 - 3\r\n    ตรวจสุขภาพเต้านม ตรวจหัวนม ติมตามการเลี้ยงลูกด้วยนมแม่\r\n    ตรวจสุขภาทารก การเลี้ยงลูกด้วยนมแม่ การขับถ่าย    \r\n    ประเมินความซึมเศร้าด้วยแบบประเมินตนเอง\r\n    แนะนำเกี่ยวกับการคุมกำเนิดต่อเนื่อง', '02 หญิงหลังคลอด', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องมีการลงทะเบียนหญิงตั้งครรภ์ เพศหญิงเท่านั้น\r\n- ต้องมีข้อมูลการคลอด\r\n- เป็นการให้บริการ จริง ของหน่วยบริการ\r\n- ต้องมีผลการตรวจ BP หัวนม\r\n- วันที่เยี่ยมหลังคลอดจะเริ่มต้น หลังจากวันที่คลอด 1 วัน ดังนี้(หากเด็กกำเนิด ตอน 00.00 น. ของวันที่ 1 มกราคม คำสั่งจะเริ่มนับ เมื่อ วันที่ 2 มกราคม เป็นต้นไป ตามเงื่อนไขของคำสั่ง HDC)\r\n- วันที่ 01 ถึง 07 ครั้ง ที่ 1\r\n- วันที่ 08 ถึง 15 ครั้ง ที่ 2\r\n- วันที่ 16 ถึง 42 ครั้ง ที่ 3\r\n- โดยหากมีการเยี่ยมมากกว่า 1 ครั้ง ในช่วงระยะเวลาดังกล่างว มากกว่า 1 ครั้ง หรือ ไม่ตรง กับช่วงเวลาที่กำหนด คำสั่ง จะตัดข้อมูลออกไม่นำมาคิด ระบบจะนำเฉาะข้อมูลที่ตรงที่สุดของแต่ละช่วงเวลาที่กำหนดมาให้\r\n- แนะนำหน่วยบริการ ให้สามารถบันทึกข้อมูล PP Special หรือ Community Service ร่วมด้วย ระบบส่วนกลางเช่น HDC จะสามารถนำไปใช้เป็นระบบรายงานอื่นๆได้\r\n- รหัส PP Special มีดังนี้\r\n    1B140 การตรวจคัดกรองโรคซึมเศร้าในหญิงตั้งครรภ์/หลังคลอดด้วยแบบคัดกรอง 2Q พบว่าผลปกติ\r\n    1B141 การตรวจคัดกรองโรคซึมเศร้าในหญิงตั้งครรภ์/หลังคลอดด้วยแบบคัดกรอง 2Q พบว่าผลผิดปกติ\r\n    1B142 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่าผลปกติ (0 ถึง 4 คะแนน) \r\n    1B143 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่ามีปัญหาความเครียด  (5 ถึง 7 คะแนน)\r\n    1B144 การประเมินความเครียดด้วยแบบคัดกรอง ST5 ในหญิงตั้งครรภ์/หลังคลอดพบว่ามีความเครียดสูง (8 คะแนนขึ้นไป) \r\n    1B149 การตรวจคัดกรองโรคซึมเศร้า/ประเมินความเครียดในหญิงตั้งครรภ์/หลังคลอด ไม่ระบุรายละเอียด\r\n- รหัส Community Service มีดังนี้    \r\n    1A210 เยี่ยมหญิงหลังคลอด ครั้งที่ 1 (1-2 สัปดาห์)  ที่ไม่มีภาวะผิดปกติ\r\n    1A211 เยี่ยมหญิงหลังคลอด ครั้งที่ 1 (1-2 สัปดาห์)  ที่มีภาวะผิดปกติ\r\n    1A212 เยี่ยมหญิงหลังคลอด ครั้งที่ 1 (1-2 สัปดาห์)  ไม่ระบุรายละเอียด \r\n    1A213 เยี่ยมหญิงหลังคลอด ครั้งที่ 2 (4-6 สัปดาห์) ที่ไม่มีภาวะผิดปกติ\r\n    1A214 เยี่ยมหญิงหลังคลอด ครั้งที่ 2 (4-6 สัปดาห์)  ที่มีภาวะผิดปกติ\r\n    1A215 เยี่ยมหญิงหลังคลอด ครั้งที่ 2 (4-6 สัปดาห์)  ไม่ระบุรายละเอียด \r\n    1A216 เยี่ยมหญิงหลังคลอด ครั้งอื่น  ที่ไม่มีภาวะผิดปกติ\r\n    1A217 เยี่ยมหญิงหลังคลอด ครั้งอื่น  ที่มีภาวะผิดปกติ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'112\';\r\nSET @activity_cost = \'70\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT cid,\r\n             pname,\r\n             fname,\r\n             lname,\r\n             activity_code,\r\n             activity_cost,\r\n             date_serv,\r\n             h_sub,\r\n             preg_care_group,\r\n             @prev := @curr                             AS p,\r\n             @curr := concat(cid, preg_care_group)      AS c,\r\n             @rank := IF(@curr = @prev, @rank + 1, 1)   AS r\r\n      FROM (SELECT cast(person.cid AS CHAR)         AS cid,\r\n                   person.pname,\r\n                   person.fname,\r\n                   person.lname,\r\n                   cast(@activity_code AS CHAR)     AS activity_code,\r\n                   cast(@activity_cost AS CHAR)     AS activity_cost,\r\n                   date_format(person_anc_preg_care.care_date,\r\n                               \'%Y-%m-%d\')\r\n                      AS date_serv,\r\n                   @h_sub                           AS h_sub,\r\n                   person_anc.labor_date,\r\n                   CASE\r\n                      WHEN timestampdiff(DAY,\r\n                                         person_anc.labor_date,\r\n                                         person_anc_preg_care.care_date) BETWEEN 1\r\n                                                                             AND 7\r\n                      THEN\r\n                         \'1\'\r\n                      WHEN timestampdiff(DAY,\r\n                                         person_anc.labor_date,\r\n                                         person_anc_preg_care.care_date) BETWEEN 8\r\n                                                                             AND 15\r\n                      THEN\r\n                         \'2\'\r\n                      WHEN timestampdiff(DAY,\r\n                                         person_anc.labor_date,\r\n                                         person_anc_preg_care.care_date) BETWEEN 16\r\n                                                                             AND 42\r\n                      THEN\r\n                         \'3\'\r\n                      ELSE\r\n                         NULL\r\n                   END\r\n                      preg_care_group\r\n            FROM ovst\r\n                 INNER JOIN person_anc_preg_care\r\n                    ON ovst.vn = person_anc_preg_care.vn\r\n                 INNER JOIN person_anc\r\n                    ON person_anc_preg_care.person_anc_id =\r\n                          person_anc.person_anc_id\r\n                 INNER JOIN person ON ovst.hn = person.patient_hn\r\n            WHERE     person.sex = 2\r\n                  AND person.nationality = 99\r\n                  AND person_anc.labor_date <\r\n                         person_anc_preg_care.care_date\r\n                  AND person_anc_preg_care.care_date BETWEEN @start_date\r\n                                                         AND @stop_date\r\n                  AND person_anc_preg_care.real_preg_care = \'y\'\r\n                  AND person_anc_preg_care.nipple_normal IS NOT NULL \r\n-- AND person_anc_preg_care.uterus_level_normal IS NOT NULL\r\n-- AND person_anc_preg_care.lochia_normal IS NOT NULL\r\n                  AND person_anc_preg_care.bps IS NOT NULL\r\n                  AND person_anc_preg_care.bpd IS NOT NULL \r\n-- AND person_anc_preg_care.albumin_level IS NOT NULL\r\n-- AND person_anc_preg_care.sugar_level IS NOT NULL\r\n            GROUP BY person.cid, person_anc_preg_care.care_date\r\n            ORDER BY person.cid, person_anc_preg_care.care_date) AS a,\r\n           (SELECT @curr = 0, @prev = 0, @rank = 1) AS vr\r\n      WHERE a.preg_care_group IS NOT NULL) AS b\r\nWHERE b.r = 1;', null, 'Fix Stable 2022-04-23 PBS 112', 'InforReportable', '2022-04-24', '1', '999999', '7', '84');
INSERT INTO `pbs_items` VALUES ('13', '201', 'DSPM ประเมินพัฒนาการเด็ก 0 - 5 ปี (9,18,30,42,60 เดือน)', '2', '50', '1', '1', 'คู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'ประเมินพัฒนาการเด็ก 0 - ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง (ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ในคำสั่ง มีการอำนวนความสะดวก ปรับ วันที่ บันทึก PP Special ให้ตรงกับวันที่รับบริการ ในกรณีที่หน่วยบริการ บันทึกข้อมูลไม่ทัน และย้อนหลังวันที่ เครื่อง ไปบันทึก PP Special สามารถเอาออกได้หากไม่ต้องการปรับปรุง    \r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n    1B200 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลปกติ\r\n    1B201 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B202 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B203 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPMผลปกติ\r\n    1B204 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B205 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B209 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM และ หรือ DAIM ไม่ระบุรายละเอียด\r\n    1B210 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B211 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B212 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B213 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B214 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B215 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B219 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B220 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B221 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B222 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B223 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B224 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B225 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B229 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B230 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B231 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B232 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B233 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B234 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B235 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B239 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B240 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B241 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B242 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลล่าช้าส่งเพื่อประเมิน/รักษาต่อ\r\n    1B243 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B244 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B245 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาด้านการช่วยเหลือตัวเองและสังคม โดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B249 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPMและหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B260 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM ผลปกติ\r\n    1B261 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B262 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งต่อทันที', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'201\';\r\nSET @activity_cost = \'50\';\r\nSET @ppset =\r\n       \'1b200,1b201,1b202,1b203,1b204,1b205,1b209,1b210,1b211,1b212,1b213,1b214,1b215,1b219,1b220,1b221,1b222,1b223,1b224,1b225,1b229,1b230,1b231,1b232,1b233,1b234,1b235,1b239,1b240,1b241,1b242,1b243,1b244,1b245,1b249,1b260,1b261,1b262\';\r\n\r\nUPDATE pp_special\r\nSET pp_special.entry_datetime =\r\n       concat((concat(\'25\', LEFT(pp_special.vn, 2)) - 543),\r\n              \'-\',\r\n              mid(pp_special.vn, 3, 2),\r\n              \'-\',\r\n              mid(pp_special.vn, 5, 2),\r\n              \' \',\r\n              time(pp_special.entry_datetime))\r\nWHERE concat(\'25\', LEFT(pp_special.vn, 2)) <>\r\n         (LEFT(pp_special.entry_datetime, 4) + 543);\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (-- startrun\r\n      SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             @activity_code                               AS activity_code,\r\n             @activity_cost                               AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_dspm,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_dspm_result,\r\n             timestampdiff(MONTH, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.nationality = 99\r\n            AND person.death <> \'y\'\r\n            AND timestampdiff(MONTH, person.birthdate, ovst.vstdate) IN\r\n                   (9,\r\n                    18,\r\n                    30,\r\n                    42,\r\n                    60)\r\n      GROUP BY person.cid, ovst.vstdate\r\n      HAVING (IF(sum(\r\n                    CASE\r\n                       WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                        @ppset)\r\n                       THEN\r\n                          1\r\n                       ELSE\r\n                          0\r\n                    END) >= 1,\r\n                 1,\r\n                 0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS a;', null, 'Fix Stable 2022-04-23 PBS 201', 'InforReportable', '2022-04-24', '1', '999999', '180', '84');
INSERT INTO `pbs_items` VALUES ('14', '202', 'ชั่งน้ำหนัก ส่วนสูง ประเมินภาวะโภชนาการ ในเด็ก 0 - 5 ปี ไตรมาสละ 1 ครั้ง', '4', '15', '1', '1', '-', 'ช่วงไตรมาส ที่ 1 ตุลาคม - ธันวาคม\r\nช่วงไตรมาส ที่ 2 มกราคม - มีนาคม\r\nช่วงไตรมาส ที่ 3 เมษายน- มิถุนายน\r\nช่วงไตรมาส ที่ 4 กรกฏาคม - กันยายน', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');   \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3 หรือ บัญชี 4 หรือ ผู้มารับบริการ TypeArea 1,3  เท่านั้น เพื่อป้องกันความซ้ำซ้อนระหว่างหน่วยบริการ\r\n- ในช่วงไตรมาสเดียวกัน หากมีการให้บริการมากกว่า 1 รายการ ระบบจะเลือกรายการที่ตรงที่สุดเพียงรายการเดียว รายการอื่นจะไม่ถูกนำมาใช้\r\n    ช่วงไตรมาส ที่ 1 ตุลาคม - ธันวาคม\r\n    ช่วงไตรมาส ที่ 2 มกราคม - มีนาคม\r\n    ช่วงไตรมาส ที่ 3 เมษายน- มิถุนายน\r\n    ช่วงไตรมาส ที่ 4 กรกฏาคม - กันยายน\r\n- ห้ามว่างค่าต่อไปนี้ น้ำหนัก ,ส่วนสูง', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'202\';\r\nSET @activity_cost = \'15\';\r\nSET @curr = NULL;\r\nSET @prev = NULL;\r\nSET @rank = 0;\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT tt_epi.cid,\r\n              tt_epi.pname,\r\n              tt_epi.fname,\r\n              tt_epi.lname,\r\n              tt_epi.activity_code,\r\n              tt_epi.activity_cost,\r\n              tt_epi.date_serv,\r\n              tt_epi.h_sub,\r\n              tt_epi.current_age,\r\n              tt_epi.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_epi.cid, t_epi.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(\r\n                             person_epi_nutrition.nutrition_date,\r\n                             \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          timestampdiff(\r\n                             YEAR,\r\n                             person.birthdate,\r\n                             person_epi_nutrition.nutrition_date)\r\n                             AS current_age,\r\n                          QUARTER(person_epi_nutrition.nutrition_date)\r\n                             AS quarter_year\r\n                   FROM person_epi_nutrition\r\n                        INNER JOIN person_epi\r\n                           ON person_epi_nutrition.person_epi_id =\r\n                                 person_epi.person_epi_id\r\n                        INNER JOIN person\r\n                           ON person_epi.person_id = person.person_id\r\n                   WHERE     person_epi_nutrition.nutrition_date BETWEEN @start_date\r\n                                                                     AND @stop_date\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(\r\n                                YEAR,\r\n                                person.birthdate,\r\n                                person_epi_nutrition.nutrition_date) BETWEEN 0\r\n                                                                         AND 5\r\n                         AND person_epi_nutrition.body_weight > 0\r\n                         AND person_epi_nutrition.height > 0\r\n                   GROUP BY person_epi_nutrition.person_epi_nutrition_id\r\n                   ORDER BY person.cid ASC,\r\n                            person_epi_nutrition.nutrition_date)\r\n                  AS t_epi) AS tt_epi\r\n       WHERE tt_epi.rank = 1)\r\n      UNION ALL\r\n      (SELECT tt_wbc.cid,\r\n              tt_wbc.pname,\r\n              tt_wbc.fname,\r\n              tt_wbc.lname,\r\n              tt_wbc.activity_code,\r\n              tt_wbc.activity_cost,\r\n              tt_wbc.date_serv,\r\n              tt_wbc.h_sub,\r\n              tt_wbc.current_age,\r\n              tt_wbc.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_wbc.cid, t_wbc.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(\r\n                             person_wbc_nutrition.nutrition_date,\r\n                             \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          timestampdiff(\r\n                             YEAR,\r\n                             person.birthdate,\r\n                             person_wbc_nutrition.nutrition_date)\r\n                             AS current_age,\r\n                          QUARTER(person_wbc_nutrition.nutrition_date)\r\n                             AS quarter_year\r\n                   FROM person_wbc_nutrition\r\n                        INNER JOIN person_wbc\r\n                           ON person_wbc_nutrition.person_wbc_id =\r\n                                 person_wbc.person_wbc_id\r\n                        INNER JOIN person\r\n                           ON person_wbc.person_id = person.person_id\r\n                   WHERE     person_wbc_nutrition.nutrition_date BETWEEN @start_date\r\n                                                                     AND @stop_date\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(\r\n                                YEAR,\r\n                                person.birthdate,\r\n                                person_wbc_nutrition.nutrition_date) BETWEEN 0\r\n                                                                         AND 5\r\n                         AND person_wbc_nutrition.body_weight > 0\r\n                         AND person_wbc_nutrition.height > 0\r\n                   GROUP BY person_wbc_nutrition.person_wbc_nutrition_id\r\n                   ORDER BY person.cid ASC,\r\n                            person_wbc_nutrition.nutrition_date)\r\n                  AS t_wbc) AS tt_wbc\r\n       WHERE tt_wbc.rank = 1)\r\n      UNION ALL\r\n      (SELECT tt_person.cid,\r\n              tt_person.pname,\r\n              tt_person.fname,\r\n              tt_person.lname,\r\n              tt_person.activity_code,\r\n              tt_person.activity_cost,\r\n              tt_person.date_serv,\r\n              tt_person.h_sub,\r\n              tt_person.current_age,\r\n              tt_person.quarter_year\r\n       FROM (SELECT *,\r\n                    @prev := @curr                               AS prev,\r\n                    @curr := concat(t_person.cid, t_person.quarter_year)\r\n                       AS curr,\r\n                    @rank := IF(@prev = @curr, @rank + 1, 1)     AS rank\r\n             FROM (SELECT person.cid,\r\n                          person.pname,\r\n                          person.fname,\r\n                          person.lname,\r\n                          cast(@activity_code AS CHAR)       AS activity_code,\r\n                          cast(@activity_cost AS CHAR)       AS activity_cost,\r\n                          date_format(opdscreen.vstdate, \'%Y-%m-%d\')\r\n                             AS date_serv,\r\n                          @h_sub                             AS h_sub,\r\n                          timestampdiff(YEAR,\r\n                                        person.birthdate,\r\n                                        opdscreen.vstdate)\r\n                             AS current_age,\r\n                          QUARTER(opdscreen.vstdate)         AS quarter_year\r\n                   FROM opdscreen\r\n                        INNER JOIN person\r\n                           ON opdscreen.hn = person.patient_hn\r\n                   WHERE     opdscreen.vstdate BETWEEN @start_date\r\n                                                   AND @stop_date\r\n                         AND person.nationality = 99\r\n                         AND person.death <> \'y\'\r\n                         AND timestampdiff(YEAR,\r\n                                           person.birthdate,\r\n                                           opdscreen.vstdate) BETWEEN 0\r\n                                                                  AND 5\r\n                         AND person.house_regist_type_id IN (1, 3)\r\n                         AND (   opdscreen.height IS NOT NULL\r\n                              OR opdscreen.height <> 0)\r\n                         AND (   opdscreen.bw IS NOT NULL\r\n                              OR opdscreen.height <> 0)\r\n                   GROUP BY person.cid, opdscreen.vstdate\r\n                   ORDER BY person.cid ASC, opdscreen.vstdate ASC)\r\n                  AS t_person) AS tt_person\r\n       WHERE tt_person.rank = 1)) AS a;', null, 'Fix Stable 2022-04-23 PBS 202', 'InforReportable', '2022-04-24', '1', '999999', '28', '1');
INSERT INTO `pbs_items` VALUES ('15', '203', 'ฉีดวัคซีน BCG', '1', '15', '0', '1', 'กำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');   \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    010 BCG    บีซีจี กลุ่มเป้าหมาย เด็กอายุ 0 เดือน\r\n- รหัส ICD-10-TM\r\n    Z232 Need for immunization against tuberculosis [BCG]', 'set @start_date  = date(\'2021-10-10\') ;\r\nset @stop_date  = date(\'2022-03-31\') ;\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'203\';\r\nset @activity_cost = \'15\';\r\nset @export_vaccine = \'010\' ;\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\nSELECT\r\n    person.cid,\r\n    person.pname,\r\n    person.fname,\r\n    person.lname,\r\n    cast(@activity_code AS CHAR) AS activity_code,\r\n    cast(@activity_cost AS CHAR) AS activity_cost,\r\n    date_format(\r\n        person_wbc_service.service_date,\r\n        \'%Y-%m-%d\'\r\n    ) AS date_serv,\r\n    @h_sub AS h_sub\r\nFROM\r\n    person_wbc_vaccine_detail\r\nLEFT OUTER JOIN wbc_vaccine ON person_wbc_vaccine_detail.wbc_vaccine_id = wbc_vaccine.wbc_vaccine_id\r\nLEFT OUTER JOIN person_wbc_service ON person_wbc_vaccine_detail.person_wbc_service_id = person_wbc_service.person_wbc_service_id\r\nLEFT OUTER JOIN person_wbc ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\nLEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\nWHERE\r\n    wbc_vaccine.export_vaccine_code = @export_vaccine\r\nAND person_wbc_service.service_date BETWEEN @start_date\r\nAND @stop_date\r\nAND person.nationality = 99\r\nAND person.sex IN (1, 2)\r\nGROUP BY\r\n    person.cid,\r\n    person_wbc_service.service_date\r\nORDER BY\r\n    person_wbc_service.service_date,\r\n    person.cid;', null, 'Fix Stable 2022-04-23 PBS 203', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('16', '204', 'ฉีดวัคซีน IPV', '1', '15', '1', '1', 'กำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');     \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    401 IPV-P  ไอพีวี-พี กลุ่มเป้าหมาย เด็กอายุ 4 เดือน\r\n- รหัส ICD-10-TM\r\n    Z240 Need for immunization against poliomyelitis', 'SET @start_date = date(\'2020-04-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'204\';\r\nSET @activity_cost := \'15\';\r\nSET @export_vaccine := \'401\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)                             AS activity_code,\r\n       cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n       date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n       @h_sub                                                   AS h_sub\r\nFROM person_wbc_vaccine_detail\r\n     LEFT OUTER JOIN wbc_vaccine\r\n        ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n              wbc_vaccine.wbc_vaccine_id\r\n     LEFT OUTER JOIN person_wbc_service\r\n        ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n              person_wbc_service.person_wbc_service_id\r\n     LEFT OUTER JOIN person_wbc\r\n        ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n     LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\nWHERE     wbc_vaccine.export_vaccine_code = @export_vaccine\r\n      AND person_wbc_service.service_date BETWEEN @start_date AND @stop_date\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid, person_wbc_service.service_date\r\nORDER BY person_wbc_service.service_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 204', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('17', '205', 'ฉีดวัคซีน HBV', '2', '15', '0', '1', 'แรกเกิด 1 เดือน และ พาหะ\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');    \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    041    HBV1    ตับอักเสบบี 1 กลุ่มเป้าหมาย 0 เดือน\r\n    042    HBV2    ตับอักเสบบี 2 กลุ่มเป้าหมาย 2 เดือน  (เฉพาะรายที่คลอดจากมารดาที่เป็นพาหะของไวรัสตับอักเสบบี)\r\n- รหัส ICD-10-TM\r\n    Z246 Need for immunization against viral hepatitis', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'205\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'041,042\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)                             AS activity_code,\r\n       cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n       date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n       @h_sub                                                   AS h_sub\r\nFROM person_wbc_vaccine_detail\r\n     LEFT OUTER JOIN wbc_vaccine\r\n        ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n              wbc_vaccine.wbc_vaccine_id\r\n     LEFT OUTER JOIN person_wbc_service\r\n        ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n              person_wbc_service.person_wbc_service_id\r\n     LEFT OUTER JOIN person_wbc\r\n        ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n     LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\nWHERE     FIND_IN_SET(wbc_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person_wbc_service.service_date BETWEEN @start_date AND @stop_date\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid, person_wbc_service.service_date\r\nORDER BY person_wbc_service.service_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 205', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('18', '206', 'ฉีดวัคซีน DTPHB,DTPHBHib', '3', '15', '1', '1', 'DTPHB กลุ่มอายุ 2,4,6 เดือน รวมถึง DTPHBHib ที่เริ่มเพิ่มเข้ามาในระบบ ตั้งแต่ กรกฎาคม 2562\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');     \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    091    DTPHB 1 ดีทีพีตับอักเสบบี 1 กลุ่มเป้าหมาย  อายุ 2 เดือน\r\n    092    DTPHB 2 ดีทีพีตับอักเสบบี 2 กลุ่มเป้าหมาย  อายุ 4 เดือน\r\n    093    DTPHB 3 ดีทีพีตับอักเสบบี 3 กลุ่มเป้าหมาย  อายุ 6 เดือน\r\n    D21    DTP-HB+Hib  1 ดีทีพีตับอักเสบบีฮิบ1 กลุ่มเป้าหมาย  อายุ 2 เดือน\r\n    D22    DTP-HB+Hib  2 ดีทีพีตับอักเสบบีฮิบ2 กลุ่มเป้าหมาย  อายุ 4 เดือน\r\n    D23    DTP-HB+Hib  3 ดีทีพีตับอักเสบบีฮิบ3 กลุ่มเป้าหมาย  อายุ 6 เดือน\r\n- รหัส ICD-10-TM\r\n    Z271 Need for immunization against diphtheria-tetanus pertussis, combined [DTP]\r\n    Z246 Need for immunization against viral hepatitis\r\n    Z241 Need for immunization against arthropod-borne viral encephalitis', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'206\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'091,092,093,D21,D22,D23\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)                             AS activity_code,\r\n       cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n       date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n       @h_sub                                                   AS h_sub\r\nFROM person_wbc_vaccine_detail\r\n     LEFT OUTER JOIN wbc_vaccine\r\n        ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n              wbc_vaccine.wbc_vaccine_id\r\n     LEFT OUTER JOIN person_wbc_service\r\n        ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n              person_wbc_service.person_wbc_service_id\r\n     LEFT OUTER JOIN person_wbc\r\n        ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n     LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\nWHERE     find_in_set(wbc_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person_wbc_service.service_date BETWEEN @start_date AND @stop_date\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid, wbc_vaccine.export_vaccine_code\r\nORDER BY person_wbc_service.service_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 206', 'InforReportable', '2022-04-24', '1', '999999', '56', '84');
INSERT INTO `pbs_items` VALUES ('19', '207', 'ฉีดวัคซีน MMR', '1', '15', '1', '1', 'กลุ่มอายุ 9,30 เดือน\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');   \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3 และ บัญชี 4\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    061 MMR1 หัด คางทูม หัดเยอรมัน กลุ่มเป้าหมาย อายุ 9 เดือน\r\n    073 MMR2 หัด คางทูม หัดเยอรมัน กลุ่มเป้าหมาย อายุ 2 ปี 6 เดือน\r\n- รหัส ICD-10-TM\r\n    Z274 Need for immunization against measles-mumps-rubella [MMR]', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'207\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'061,073\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_wbc_vaccine_detail\r\n      LEFT OUTER JOIN wbc_vaccine\r\n         ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n               wbc_vaccine.wbc_vaccine_id\r\n      LEFT OUTER JOIN person_wbc_service\r\n         ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n               person_wbc_service.person_wbc_service_id\r\n      LEFT OUTER JOIN person_wbc\r\n         ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n      LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\n WHERE     find_in_set(wbc_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_wbc_service.service_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_wbc_service.service_date\r\n ORDER BY person_wbc_service.service_date, person.cid)\r\nUNION ALL\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_epi_vaccine.vaccine_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_epi_vaccine_list\r\n      LEFT OUTER JOIN epi_vaccine\r\n         ON person_epi_vaccine_list.epi_vaccine_id =\r\n               epi_vaccine.epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi_vaccine\r\n         ON person_epi_vaccine_list.person_epi_vaccine_id =\r\n               person_epi_vaccine.person_epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi\r\n         ON person_epi_vaccine.person_epi_id = person_epi.person_epi_id\r\n      LEFT OUTER JOIN person ON person_epi.person_id = person.person_id\r\n WHERE     find_in_set(epi_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_epi_vaccine.vaccine_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_epi_vaccine.vaccine_date\r\n ORDER BY person_epi_vaccine.vaccine_date, person.cid);', null, 'Fix Stable 2022-04-23 PBS 207', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('20', '208', 'ฉีดวัคซีน DTP กระตุ้น', '1', '15', '1', '1', 'กลุ่มอายุ ขวบครึ่ง,4 ปี\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    set @start_date  = date(\'2020-04-01\') ;\r\n    SET @stop_date = date(\'2022-03-31\');    \r\n- เด็ก ต้องมีการขึ้นทะเบียน 3 และ บัญชี 4\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    034    กลุ่มเป้าหมาย อายุ 18 เดือน\r\n    035    กลุ่มเป้าหมาย อายุ 48 เดือน\r\n- รหัส ICD-10-TM\r\n    Z271 Need for immunization against diphtheria-tetanus pertussis, combined [DTP]\r\n\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'208\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'034,035\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_wbc_vaccine_detail\r\n      LEFT OUTER JOIN wbc_vaccine\r\n         ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n               wbc_vaccine.wbc_vaccine_id\r\n      LEFT OUTER JOIN person_wbc_service\r\n         ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n               person_wbc_service.person_wbc_service_id\r\n      LEFT OUTER JOIN person_wbc\r\n         ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n      LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\n WHERE     find_in_set(wbc_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_wbc_service.service_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_wbc_service.service_date\r\n ORDER BY person_wbc_service.service_date, person.cid)\r\nUNION ALL\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_epi_vaccine.vaccine_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_epi_vaccine_list\r\n      LEFT OUTER JOIN epi_vaccine\r\n         ON person_epi_vaccine_list.epi_vaccine_id =\r\n               epi_vaccine.epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi_vaccine\r\n         ON person_epi_vaccine_list.person_epi_vaccine_id =\r\n               person_epi_vaccine.person_epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi\r\n         ON person_epi_vaccine.person_epi_id = person_epi.person_epi_id\r\n      LEFT OUTER JOIN person ON person_epi.person_id = person.person_id\r\n WHERE     find_in_set(epi_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_epi_vaccine.vaccine_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_epi_vaccine.vaccine_date\r\n ORDER BY person_epi_vaccine.vaccine_date, person.cid);', null, 'Fix Stable 2022-04-23 PBS 208', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('21', '209', 'ฉีดวัคซีน JE,LAJE', '2', '15', '1', '1', 'กำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');    \r\n- เด็ก ต้องมีการขึ้นทะเบียนบัญชี 4\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    051 JE1 ไข้สมองอักเสบเจอี 1 กลุ่มเป้าหมาย อายุ 18 เดือน\r\n    052 JE2 ไข้สมองอักเสบเจอี 2 กลุ่มเป้าหมาย อายุ 19 เดือน\r\n    053 JE3 ไข้สมองอักเสบเจอี 3 กลุ่มเป้าหมาย อายุ 30 เดือน\r\n    J11 LAJE1 เจอีเชื้อเป็น 1 กลุ่มเป้าหมาย อายุ 1 ปี\r\n    J12 LAJE2 เจอีเชื้อเป็น 2 กลุ่มเป้าหมาย อายุ 2 ปี 6 เดือน\r\n- รหัส ICD-10-TM\r\n    Z241 Need for immunization against arthropod-borne viral encephalitis', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'209\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'051,052,053,054,055,j11,j12\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_wbc_service.service_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_wbc_vaccine_detail\r\n      LEFT OUTER JOIN wbc_vaccine\r\n         ON person_wbc_vaccine_detail.wbc_vaccine_id =\r\n               wbc_vaccine.wbc_vaccine_id\r\n      LEFT OUTER JOIN person_wbc_service\r\n         ON person_wbc_vaccine_detail.person_wbc_service_id =\r\n               person_wbc_service.person_wbc_service_id\r\n      LEFT OUTER JOIN person_wbc\r\n         ON person_wbc_service.person_wbc_id = person_wbc.person_wbc_id\r\n      LEFT OUTER JOIN person ON person_wbc.person_id = person.person_id\r\n WHERE     find_in_set(wbc_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_wbc_service.service_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_wbc_service.service_date\r\n ORDER BY person_wbc_service.service_date, person.cid)\r\nUNION ALL\r\n(SELECT person.cid,\r\n        person.pname,\r\n        person.fname,\r\n        person.lname,\r\n        cast(@activity_code AS CHAR)                             AS activity_code,\r\n        cast(@activity_cost AS CHAR)                             AS activity_cost,\r\n        date_format(person_epi_vaccine.vaccine_date, \'%Y-%m-%d\') AS date_serv,\r\n        @h_sub                                                   AS h_sub\r\n FROM person_epi_vaccine_list\r\n      LEFT OUTER JOIN epi_vaccine\r\n         ON person_epi_vaccine_list.epi_vaccine_id =\r\n               epi_vaccine.epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi_vaccine\r\n         ON person_epi_vaccine_list.person_epi_vaccine_id =\r\n               person_epi_vaccine.person_epi_vaccine_id\r\n      LEFT OUTER JOIN person_epi\r\n         ON person_epi_vaccine.person_epi_id = person_epi.person_epi_id\r\n      LEFT OUTER JOIN person ON person_epi.person_id = person.person_id\r\n WHERE     find_in_set(epi_vaccine.export_vaccine_code, @export_vaccine)\r\n       AND person_epi_vaccine.vaccine_date BETWEEN @start_date\r\n                                               AND @stop_date\r\n       AND person.nationality = 99\r\n       AND person.sex IN (1, 2)\r\n GROUP BY person.cid, person_epi_vaccine.vaccine_date\r\n ORDER BY person_epi_vaccine.vaccine_date, person.cid);', null, 'Fix Stable 2022-04-23 PBS 209', 'InforReportable', '2022-04-24', '1', '999999', '280', '84');
INSERT INTO `pbs_items` VALUES ('22', '210', 'LAB ตรวจการติดเชื้อ HIV เด็กอายุ 12 เดือน', '1', '140', '0', '1', '-', 'รหัสวินิจฉัย ICD 10 TM \r\nZ114 Special screening examination for human immunodeficiency virus [HIV]\r\nการตรวจคัดกรองพิเศษสำหรับโรคติดต่อเชื้อไวรัสภูมิคุ้มกันบกพร่อง (เอชไอวี)', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- รหัส ICD-10-TM\r\n    Z114 Special screening examination for human immunodeficiency virus [HIV]\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 9 - 15  เดือนเท่านั้น', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'210\';\r\nSET @activity_cost = \'140\';\r\nSET @icd10 = \'Z114\';\r\nSET @provis_labcode_set = \'\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\n     INNER JOIN lab_head ON ovst.vn = lab_head.vn\r\n     INNER JOIN lab_order\r\n        ON lab_head.lab_order_number = lab_order.lab_order_number\r\n     INNER JOIN lab_items\r\n        ON lab_order.lab_items_code = lab_items.lab_items_code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND TIMESTAMPDIFF(MONTH, person.birthdate, ovst.vstdate) BETWEEN 9\r\n                                                                   AND 15\r\n      AND FIND_IN_SET(lab_items.provis_labcode, @provis_labcode_set) >= 1\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 210', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('23', '211', 'LAB ตรวจการติดเชื้อ HIV ซ้ำ เด็กอายุ 18 เดือน', '1', '140', '0', '1', 'กรณี ที่เสี่ยงต่อการติดเชื้อ', 'รหัสวินิจฉัย ICD 10 TM \r\nZ114 Special screening examination for human immunodeficiency virus [HIV]\r\nการตรวจคัดกรองพิเศษสำหรับโรคติดต่อเชื้อไวรัสภูมิคุ้มกันบกพร่อง (เอชไอวี)', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- รหัส ICD-10-TM\r\n    Z114 Special screening examination for human immunodeficiency virus [HIV]\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 16 - 21  เดือนเท่านั้น', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'211\';\r\nSET @activity_cost = \'140\';\r\nSET @icd10 = \'Z114\';\r\nSET @provis_labcode_set = \'\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\n     INNER JOIN lab_head ON ovst.vn = lab_head.vn\r\n     INNER JOIN lab_order\r\n        ON lab_head.lab_order_number = lab_order.lab_order_number\r\n     INNER JOIN lab_items\r\n        ON lab_order.lab_items_code = lab_items.lab_items_code\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND TIMESTAMPDIFF(MONTH, person.birthdate, ovst.vstdate) BETWEEN 16\r\n                                                                   AND 21\r\n      AND FIND_IN_SET(lab_items.provis_labcode, @provis_labcode_set) >= 1\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 211', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('24', '212', 'ให้ยาน้ำวิตามินเสริมธาตุเหล็กเด็ก 6 เดือน ถึง 5 ปี', '4', '40', '1', '1', 'เงื่อนไข รหัสยา 24 หลัก นำมาจาก ระบบรายงานของ HDC ร้อยละของเด็กอายุ 6 เดือน ถึง 5 ปี ได้รับยาน้ำเสริมธาตุเหล็ก', 'ระบบรายงาน  HDC\r\nนับเฉพาะเด็กไทยที่มารับบริการในแฟ้ม EPI \r\nรหัสยาน้ำเสริมธาตุเหล็กตามสำนักโภชนาการแจ้งดังนี้ \r\n- EUROFER - IRON(oral liquid)->100497414002040330581606 \r\n- Ferium(oral liquid->100497414000800830582799 \r\n- FERRO - BC(syrup)->202030120087180130581617,202030120087180130581487 \r\n- KIDIRON(oral liquid)->100489000000810330581267 \r\n- PEDIRON(oral drop)->100489000000950130581267 \r\n- FER-IN-SOL (drops)->100489000000950730581109 \r\n- Ferrokid->100488000008634230481506 \r\n- Ferdex->100488000001280130881602 \r\n- Ferrosol (oral drop)->100488000004203121781144,100488000001280130481618', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องมีการระบุ รหัส ยา 24 หลัก โดย จะต้องมีในรายการที่ระบบรายงาน HDC กำหนด ดังนี้\r\n    - EUROFER - IRON(oral liquid) ->100497414002040330581606 \r\n    - Ferium(oral liquid) ->100497414000800830582799 \r\n    - FERRO - BC(syrup) ->202030120087180130581617, 202030120087180130581487 \r\n    - KIDIRON(oral liquid) ->100489000000810330581267 \r\n    - PEDIRON(oral drop)-> 100489000000950130581267 \r\n    - FER-IN-SOL (drops) ->100489000000950730581109 \r\n    - Ferrokid->100488000008634230481506 \r\n    - Ferdex ->100488000001280130881602 \r\n    - Ferrosol (oral drop) ->100488000004203121781144, 100488000001280130481618\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ วัคซีน ร่วมด้วย อยู่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'212\';\r\nSET @activity_cost := \'40\';\r\nSET @water_iron_set =\r\n       \'100497414002040330581606,100497414000800830582799,202030120087180130581617,202030120087180130581487,100489000000810330581267,100489000000950130581267,100489000000950730581109,100488000008634230481506,100488000001280130881602,100488000004203121781144,100488000001280130481618\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                  AS activity_code,\r\n             cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n             date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n             @h_sub                                        AS h_sub,\r\n             drugitems.did\r\n      FROM opitemrece\r\n           INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n           LEFT OUTER JOIN village\r\n              ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n           INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n           INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n      WHERE     person.sex IN (1, 2)\r\n            AND person.death <> \'y\'\r\n            AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n            AND timestampdiff(YEAR, person.birthdate, opitemrece.vstdate) BETWEEN 0\r\n                                                                              AND 5\r\n            AND person.nationality = 99\r\n      GROUP BY person.cid\r\n      HAVING sum(\r\n                CASE\r\n                   WHEN (FIND_IN_SET(LEFT(drugitems.did, 24),\r\n                                     @water_iron_set) >= 1)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END) >= 1\r\n      ORDER BY opitemrece.vstdate) AS temp_212;', null, 'Fix Stable 2022-04-23 PBS 212', 'InforReportable', '2022-04-24', '1', '999999', '28', '84');
INSERT INTO `pbs_items` VALUES ('25', '301', 'การตรวจสุขภาพเด็กนักเรียนประถม/มัธยม', '1', '70', '1', '1', 'อายุ ระหว่าง 6 -13 ปี และ จะเริ่มเบิกได้ เมื่อ เมษายน - กันยายน ของปีงบประมาณ\r\nปีงบประมาณ 2565 กรณีพิเศษ ช่วงโควิด ทดลองจ่ายชดเชย ในช่วง ตุลาคม - มีนาคม\r\nเพราะปี 2564 ไม่มีการเบิกจ่ายในรหัสดังกล่าวด้วยสถานะการณ์โรคติดต่อ', 'กิจกรรม\r\n    ตรวจสุขภาพทั่วไป และฟังเสียงหัวใจ\r\n    ติดตามการเจริญเติบโต\r\n    ประเมินความฉลาดทางอารมณ์(เฉพาะ ป.1)\r\n    วัดสายตาด้วยแผนภูมิสเนลเลน\r\n    ตรวจการได้ยิน', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    set @stop_date   = date(\'2021-09-30\') ;\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- เบิกได้ปี ละ 1 ครั้ง 1 เมษายน ถึง 30 กันยายน  ไตรมาสที่ 3 - 4 ของปีงบประมาณ เท่านั้น เพราะปีการศึกษา ตรงกับปีงบประมาณ\r\n- ห้ามว่างค่าต่อไปนี้ น้ำหนัก ,ส่วนสูง ,หู,สายตา\r\n- อายุ 6 ถึง 13 ปี\r\n- ปีงบประมาณ 2565 กรณีพิเศษ ช่วงโควิด ทดลองจ่ายชดเชย ในช่วง ไตรมาสที่ 1 - 2', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code := \'301\';\r\nSET @activity_cost := \'70\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(village_student_screen.screen_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM village_student_screen\r\n     INNER JOIN village_student\r\n        ON village_student_screen.village_student_id =\r\n              village_student.village_student_id\r\n     INNER JOIN village_school_class\r\n        ON village_student.village_school_class_id =\r\n              village_school_class.village_school_class_id\r\n     INNER JOIN person ON village_student.person_id = person.person_id\r\nWHERE     village_student_screen.screen_date BETWEEN @start_date\r\n                                                 AND @stop_date\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND QUARTER(village_student_screen.screen_date) IN (4,1)\r\n      AND TIMESTAMPDIFF(YEAR,\r\n                        person.birthdate,\r\n                        village_student_screen.screen_date) BETWEEN 6\r\n                                                                AND 13\r\n      AND village_student_screen.body_weight IS NOT NULL\r\n      AND village_student_screen.height IS NOT NULL\r\n      AND village_student_screen.ear_check_normal IS NOT NULL\r\n      AND village_student_screen.eye_check_normal IS NOT NULL\r\nGROUP BY village_student.person_id;', null, 'Fix Stable 2022-04-23 PBS 301', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('26', '302', 'LAB เจาะ HCT เด็ก ป.1,ม.1', '1', '30', '1', '1', 'ต้อง มีการบันทึก LAB ด้วยรหัส 7 หลัก และ มีผล ไม่มีค่าว่าง เท่านั้น \r\n0621201 Hematocrit whole blood การตรวจหาค่าฮีมาโตคริตในเลือด', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5 ระดับชั้น ป.1 และ ม.1 เท่านั้น\r\n- ต้อง มีการบันทึก LAB ด้วยรหัส 7 หลัก เท่านั้น\r\n    0621201 Hematocrit whole blood การตรวจหาค่าฮีมาโตคริตในเลือด\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ Community Service ร่วมด้วย อย่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1H301 นักเรียนได้รับการตรวจภาวะโลหิตจาง\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'302\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @commu_set = \'1H301\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT t.cid,\r\n       t.pname,\r\n       t.fname,\r\n       t.lname,\r\n       t.activity_code,\r\n       t.activity_cost,\r\n       min(t.date_serv) AS date_serv,\r\n       t.h_sub\r\nFROM (--         (\r\n      --             SELECT\r\n      --                 person.cid,\r\n      --                 person.pname,\r\n      --                 person.fname,\r\n      --                 person.lname,\r\n      --                 cast(@activity_code AS CHAR) AS activity_code,\r\n      --                 cast(@activity_cost AS CHAR) AS activity_cost,\r\n      --                 date_format(\r\n      --                     village_student_screen.screen_date,\r\n      --                     \'%Y-%m-%d\'\r\n      --                 ) AS date_serv,\r\n      --                 @h_sub AS h_sub\r\n      --             FROM\r\n      --                 village_student_screen\r\n      --             INNER JOIN village_student ON village_student_screen.village_student_id = village_student.village_student_id\r\n      --             INNER JOIN village_school_class ON village_student.village_school_class_id = village_school_class.village_school_class_id\r\n      --             INNER JOIN person ON village_student.person_id = person.person_id\r\n      --             WHERE\r\n      --                 village_student_screen.screen_date BETWEEN @start_date\r\n      --             AND @stop_date\r\n      --             AND person.sex IN (1, 2)\r\n      --             AND person.nationality = 99\r\n      --             AND village_student_screen.student_hct_result_id IS NOT NULL\r\n      --             AND village_student_screen.student_hct_result_value IS NOT NULL\r\n      --             AND QUARTER (\r\n      --                 village_student_screen.screen_date\r\n      --             ) BETWEEN 1\r\n      --             AND 34\r\n      --             AND (\r\n      --                 (\r\n      --                     village_school_class.village_school_class_name LIKE \'%1%\'\r\n      --                     AND village_school_class.village_school_class_name LIKE \'%ประถม%\'\r\n      --                 )\r\n      --                 OR (\r\n      --                     village_school_class.village_school_class_name LIKE \'%1%\'\r\n      --                     AND village_school_class.village_school_class_name LIKE \'%มัธยม%\'\r\n      --                 )\r\n      --             )\r\n      --             GROUP BY\r\n      --                 village_student.person_id\r\n      --         )\r\n      --         UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)            AS activity_code,\r\n              cast(@activity_cost AS CHAR)            AS activity_cost,\r\n              date_format(ovst.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                  AS h_sub\r\n       FROM ovst\r\n            INNER JOIN person ON ovst.hn = person.patient_hn\r\n            INNER JOIN village_student\r\n               ON person.person_id = village_student.person_id\r\n            INNER JOIN village_school_class\r\n               ON village_student.village_school_class_id =\r\n                     village_school_class.village_school_class_id\r\n            -- LEFT OUTER JOIN ovst_community_service on ovst.vn = ovst_community_service.vn\r\n            -- LEFT OUTER JOIN ovst_community_service_type on ovst_community_service.ovst_community_service_type_id = ovst_community_service_type.ovst_community_service_type_id\r\n            INNER JOIN lab_head ON ovst.vn = lab_head.vn\r\n            INNER JOIN lab_order\r\n               ON lab_head.lab_order_number = lab_order.lab_order_number\r\n       WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n             AND person.sex IN (1, 2)\r\n             AND person.nationality = 99\r\n             AND QUARTER(ovst.vstdate) BETWEEN 1 AND 4\r\n             AND (   (    village_school_class.village_school_class_name LIKE\r\n                             \'%1%\'\r\n                      AND village_school_class.village_school_class_name LIKE\r\n                             \'%ประถม%\')\r\n                  OR (    village_school_class.village_school_class_name LIKE\r\n                             \'%1%\'\r\n                      AND village_school_class.village_school_class_name LIKE\r\n                             \'%มัธยม%\'))\r\n             AND (    lab_order.lab_items_name_ref = @lab_hct\r\n                  AND lab_order.lab_order_result > 0.00)\r\n       -- AND ovst_community_service_type.ovst_community_service_type_code = @commu_set\r\n       GROUP BY person.person_id)) AS t\r\nGROUP BY t.cid;', null, 'Fix Stable 2022-04-23 PBS 302', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('27', '303', 'จ่ายเฟอร์รัสซัลเฟต แก่นักเรียน', '1', '15', '1', '1', 'เงื่อนไข รหัสยา 24 หลัก นำมาจาก ระบบรายงานของ HDC ร้อยละเด็กอายุ 6 - 12 ปี ได้รับยาเม็ดเสริมธาตุเหล็ก', 'ระบบรายงาน HDC\r\nนับเฉพาะเด็กไทยที่มารับบริการในแฟ้ม NUTRITION \r\nรหัสยาเม็ดเสริมธาตุเหล็กตามสำนักโภชนาการแจ้งดังนี้ \r\n- EUROFER ->202030120137819920381422 \r\n- FEMARATE ->100488000004203120381169 \r\n- FERROTABS ,BEFERMED ->100489000004320121881267 ,100489000004320121881267 \r\n- F-TAB ->100488000004203121781674, 100488000004203120381442 \r\n- FERROUS FUMARATE ->100488000004203120381013,100488000004203121781144 \r\n- FERMIRON ->100488000004203120381053 \r\n- I - RON ->100488000004203120381144 \r\n- FERRA ->100488000004203120381271 \r\n- FERMATE ->100488000004203120381341 \r\n- FEROUS FAMARATE TABLET ->100488000004203120381626, 100488000004203121881626 \r\n- I-RON-F ->100488000004203121781144 \r\n- FER - TAB->100488000004203121881442 \r\n- FERMASIAN S/C->100488000004203121881553 \r\n- FERROUS SULFATE -> 100489000004192121881506, 100489000004320120381122, 100489000004320120381506, 100489000004203120381555 \r\n- FERROUS SULFATE FILM COATED ->100489000004203120381084 \r\n- FERROUS SULPHATE -> 100489000004203120381144, 100489000004203120381619, 100489000004203120381477, 100489000004203120381544, 100489000004203120381546  ', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องมีการระบุ รหัส ยา 24 หลัก โดย จะต้องมีในรายการที่ระบบรายงาน HDC กำหนด ดังนี้\r\n    - EUROFER ->202030120137819920381422 \r\n    - FEMARATE ->100488000004203120381169 \r\n    - FERROTABS ,BEFERMED ->100489000004320121881267 ,100489000004320121881267 \r\n    - F-TAB ->100488000004203121781674, 100488000004203120381442 \r\n    - FERROUS FUMARATE ->100488000004203120381013,100488000004203121781144 \r\n    - FERMIRON ->100488000004203120381053 \r\n    - I - RON ->100488000004203120381144 \r\n    - FERRA ->100488000004203120381271 \r\n    - FERMATE ->100488000004203120381341 \r\n    - FEROUS FAMARATE TABLET ->100488000004203120381626, 100488000004203121881626 \r\n    - I-RON-F ->100488000004203121781144 \r\n    - FER - TAB->100488000004203121881442 \r\n    - FERMASIAN S/C->100488000004203121881553 \r\n    - FERROUS SULFATE -> 100489000004192121881506, 100489000004320120381122, 100489000004320120381506, 100489000004203120381555 \r\n    - FERROUS SULFATE FILM COATED ->100489000004203120381084 \r\n    - FERROUS SULPHATE -> 100489000004203120381144, 100489000004203120381619, 100489000004203120381477, 100489000004203120381544, 100489000004203120381546 \r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ ภาวะโภชนาการ ร่วมด้วย อยู่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'303\';\r\nSET @activity_cost = \'15\';\r\nSET @ferrous =\r\n       \'202030120137819920381422,100488000004203120381169,100489000004320121881267,100489000004320121881267,100488000004203121781674,100488000004203120381442,100488000004203120381013,100488000004203121781144,100488000004203120381053,100488000004203120381144,100488000004203120381271,100488000004203120381341,100488000004203120381626,100488000004203121881626,100488000004203121781144,100488000004203121881442,100488000004203121881553,100489000004192121881506,100489000004320120381122,100489000004320120381506,100489000004203120381555,100489000004203120381084,100489000004203120381144,100489000004203120381619,100489000004203120381477,100489000004203120381544,100489000004203120381546\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                  AS activity_code,\r\n             cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n             date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n             @h_sub                                        AS h_sub,\r\n             drugitems.did\r\n      FROM opitemrece\r\n           INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n           LEFT OUTER JOIN village\r\n              ON person.village_id = village.village_id\r\n           LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n           INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n           INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n      WHERE     person.sex IN (1, 2)\r\n            AND person.death <> \'y\'\r\n            AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n            AND timestampdiff(YEAR, person.birthdate, opitemrece.vstdate) BETWEEN 6\r\n                                                                              AND 13\r\n            AND person.nationality = 99\r\n      GROUP BY person.cid\r\n      HAVING sum(\r\n                CASE\r\n                   WHEN (FIND_IN_SET(LEFT(drugitems.did, 24), @ferrous) >=\r\n                            1)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END) >= 1\r\n      ORDER BY opitemrece.vstdate) AS temp_303;', null, 'Fix Stable 2022-04-23 PBS 303', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('28', '304', 'กำจัดหิดเหาในนักเรียน', '1', '50', '1', '1', 'เฉพาะรายที่มีเหา', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    SET @hidhua = concat(\'%\',\'ชื่อยาหรือรายการหิดเหา\',\'%\');', 'set @start_date  = date(\'2021-10-10\') ;\r\nset @stop_date  = date(\'2022-03-31\') ;\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'304\';\r\nset @activity_cost = \'50\';\r\nset @hidhua = concat(\'%\',\'ชื่อยาหรือรายการหิดเหา\',\'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT *\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub\r\n       FROM opitemrece\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            INNER JOIN village_student\r\n               ON person.person_id = village_student.person_id\r\n            INNER JOIN village_student_screen\r\n               ON     village_student.village_student_id =\r\n                         village_student_screen.village_student_id\r\n                  AND village_student_screen.screen_date BETWEEN @start_date\r\n                                                             AND @stop_date\r\n       WHERE     opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND drugitems.`name` LIKE @hidhua\r\n       GROUP BY person.cid)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub\r\n       FROM opitemrece\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            INNER JOIN village_student\r\n               ON person.person_id = village_student.person_id\r\n            INNER JOIN village_student_screen\r\n               ON     village_student.village_student_id =\r\n                         village_student_screen.village_student_id\r\n                  AND village_student_screen.screen_date BETWEEN @start_date\r\n                                                             AND @stop_date\r\n       WHERE     opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND nondrugitems.`name` LIKE @hidhua\r\n       GROUP BY person.cid)) AS temp_304\r\nGROUP BY temp_304.cid;', null, 'Fix Stable 2022-04-23 PBS 304', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('29', '305', 'ฉีดวัคซีน dT นักเรียน ป.1', '1', '15', '1', '1', 'เฉพาะราย\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข\r\n', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    021 dTs1 ดีทีเอส 1 ป.1\r\n    022 dTs2 ดีทีเอส 2 ป.1\r\n    106 dT ดีที สร้างภูมิคุ้มกันคอตีบ-บาดทะยักตั้งแต่อายุ 7 ปีขึ้นไป\r\n- รหัส ICD-10-TM\r\n    Z235 Need for immunization against tetanus alone\r\n    Z236 Need for immunization against diphteria alone', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'305\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'021,022,106\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(village_student_vaccine.vaccine_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM village_student_vaccine\r\n     INNER JOIN village_student_vaccine_list\r\n        ON village_student_vaccine.village_student_vaccine_id =\r\n              village_student_vaccine_list.village_student_vaccine_id\r\n     INNER JOIN student_vaccine\r\n        ON village_student_vaccine_list.student_vaccine_id =\r\n              student_vaccine.student_vaccine_id\r\n     INNER JOIN village_student\r\n        ON village_student_vaccine.village_student_id =\r\n              village_student.village_student_id\r\n     INNER JOIN person ON village_student.person_id = person.person_id\r\nWHERE     village_student_vaccine.vaccine_date BETWEEN @start_date\r\n                                                   AND @stop_date\r\n      AND QUARTER(village_student_vaccine.vaccine_date) BETWEEN 1 AND 4\r\n      AND find_in_set(student_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2);', null, 'Fix Stable 2022-04-23 PBS 305', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('30', '306', 'ฉีดวัคซีน MMR นักเรียน ป.1', '1', '15', '1', '1', 'ทุกคน\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    072 MMRs หัด คางทูม หัดเยอรมัน เอส ป.1\r\n    073 MMR2 หัด คางทูม หัดเยอรมัน 2 ปี 6 เดือน\r\n    061 MMR1 หัด คางทูม หัดเยอรมัน 9 เดือน\r\n- รหัส ICD-10-TM\r\n    Z274 Need for immunization against measles-mumps-rubella [MMR]', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'306\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'072,073,061\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(village_student_vaccine.vaccine_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM village_student_vaccine\r\n     INNER JOIN village_student_vaccine_list\r\n        ON village_student_vaccine.village_student_vaccine_id =\r\n              village_student_vaccine_list.village_student_vaccine_id\r\n     INNER JOIN student_vaccine\r\n        ON village_student_vaccine_list.student_vaccine_id =\r\n              student_vaccine.student_vaccine_id\r\n     INNER JOIN village_student\r\n        ON village_student_vaccine.village_student_id =\r\n              village_student.village_student_id\r\n     INNER JOIN person ON village_student.person_id = person.person_id\r\nWHERE     village_student_vaccine.vaccine_date BETWEEN @start_date\r\n                                                   AND @stop_date\r\n      AND QUARTER(village_student_vaccine.vaccine_date) BETWEEN 1 AND 4\r\n      AND find_in_set(student_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 306', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('31', '307', 'ฉีดวัคซีน BCG นักเรียน ป.1', '1', '15', '1', '1', 'เฉพาะราย\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    011 BCGs บีซีจีเอส ป.1\r\n- รหัส ICD-10-TM\r\n    Z232 Need for immunization against tuberculosis [BCG]', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'307\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'011\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(village_student_vaccine.vaccine_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM village_student_vaccine\r\n     INNER JOIN village_student_vaccine_list\r\n        ON village_student_vaccine.village_student_vaccine_id =\r\n              village_student_vaccine_list.village_student_vaccine_id\r\n     INNER JOIN student_vaccine\r\n        ON village_student_vaccine_list.student_vaccine_id =\r\n              student_vaccine.student_vaccine_id\r\n     INNER JOIN village_student\r\n        ON village_student_vaccine.village_student_id =\r\n              village_student.village_student_id\r\n     INNER JOIN person ON village_student.person_id = person.person_id\r\nWHERE     village_student_vaccine.vaccine_date BETWEEN @start_date\r\n                                                   AND @stop_date\r\n      AND QUARTER(village_student_vaccine.vaccine_date) BETWEEN 1 AND 4\r\n      AND find_in_set(student_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 307', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('32', '308', 'ฉีดวัคซีน dT นักเรียน ป.6', '1', '15', '1', '1', 'ทุกคน\r\nกำหนดการให้วัคซีนตามแผนงานสร้างเสริมภูมิคุ้มกันโรค ของกระทรวงสาธารณสุข ปี 2564\r\n: แผนงานสร้างเสริมภูมิคุ้มกันโรค กองโรคป้องกันด้วยวัคซีน กรมควบคุมโรค กระทรวงสาธารณสุข', '-', '04 เด็กประถมศึกษา(อายุ 6 - 13 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- มีการขึ้นทะเบียนบัญชี 5\r\n- รหัสที่ใช้บันทึก (มาตรฐาน  สนย.)\r\n    024 dTs4 ดีทีเอส 4 ป.6\r\n    106 dT ดีที สร้างภูมิคุ้มกันคอตีบ-บาดทะยักตั้งแต่อายุ 7 ปีขึ้นไป\r\n- รหัส ICD-10-TM\r\n    Z235 Need for immunization against tetanus alone\r\n    Z236 Need for immunization against diphteria alone', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'308\';\r\nSET @activity_cost = \'15\';\r\nSET @export_vaccine = \'024,106\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(village_student_vaccine.vaccine_date, \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM village_student_vaccine\r\n     INNER JOIN village_student_vaccine_list\r\n        ON village_student_vaccine.village_student_vaccine_id =\r\n              village_student_vaccine_list.village_student_vaccine_id\r\n     INNER JOIN student_vaccine\r\n        ON village_student_vaccine_list.student_vaccine_id =\r\n              student_vaccine.student_vaccine_id\r\n     INNER JOIN village_student\r\n        ON village_student_vaccine.village_student_id =\r\n              village_student.village_student_id\r\n     INNER JOIN person ON village_student.person_id = person.person_id\r\nWHERE     village_student_vaccine.vaccine_date BETWEEN @start_date\r\n                                                   AND @stop_date\r\n      AND QUARTER(village_student_vaccine.vaccine_date) BETWEEN 1 AND 4\r\n      AND find_in_set(student_vaccine.export_vaccine_code, @export_vaccine)\r\n      AND person.nationality = 99\r\n      AND person.sex IN (1, 2)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 308', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('33', '309', 'LAB คัดกรองโลหิตจาง CBC,HB,HCT อายุ 6-12 เดือน หรือ 3-5 ปี', '1', '70', '0', '1', '-', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตวจนับเม็ดเลือด CBC,HB,HCT\r\n    ครั้งที่ 1 อายุ 6 - 12 เดือน\r\n    ครั้งที่ 2 อายุ 3 - 6 ปี\r\nดูแลต่อเนื่องในรายที่ผิดปกติ อย่างน้อย 1 ครั้ง ในแต่ละช่วงอายุ', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 6 - 60  เดือนเท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องทีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ Community Service ร่วมด้วย อย่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1H301 นักเรียนได้รับการตรวจภาวะโลหิตจาง', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'309\';\r\nSET @activity_cost = \'70\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_name_hct)\r\n      AND find_in_set(lab_order.lab_items_name_ref, @lab_name_hb)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND (   timestampdiff(MONTH, person.birthdate, lab_head.order_date) BETWEEN 6\r\n                                                                              AND 60\r\n           OR timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 0\r\n                                                                             AND 5)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 309', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('34', '310', 'LAB คัดกรองโลหิตจาง HCT อายุ 6-12 เดือน หรือ 3-5 ปี', '1', '40', '1', '1', 'รพ.สต. ตรวจ HCT\r\nต้อง มีการบันทึก LAB ด้วยรหัส 7 หลัก และ มีผล ไม่มีค่าว่าง เท่านั้น \r\n0621201 Hematocrit whole blood การตรวจหาค่าฮีมาโตคริตในเลือด', '-', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 6 - 60  เดือนเท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HCT\r\n- คำสั่งยังไม่ได้มีการตรวจสอบกับแฟ้มการรับบริการ Community Service ร่วมด้วย อยู่ระหว่างการศึกษาร่วมกับหน่วยบริการในเครือข่าย\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1H301 นักเรียนได้รับการตรวจภาวะโลหิตจาง', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'310\';\r\nSET @activity_cost = \'40\';\r\nSET @lab_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @commu_set = \'1H301\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\nWHERE     find_in_set(lab_order.lab_items_name_ref, @lab_hct)\r\n      AND lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND (   timestampdiff(MONTH, person.birthdate, lab_head.order_date) BETWEEN 6\r\n                                                                              AND 60\r\n           OR timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 0\r\n                                                                             AND 5)\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 310', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('37', '502', 'LAB ตรวจความเข้มข้นของเม็ดเลือด HCT,HB ผู้ที่ BMI น้อยกว่า 18.5 อายุ 25 - 34 ปี', '1', '30', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '06 ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 25 - 34 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- ต้องมี BMI น้อยกว่า 18.5', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'502\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 25\r\n                                                                         AND 34\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) < 18.5\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hct) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hb) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 502', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('38', '503', 'LAB ตรวจวัดระดับโคเลสเตอรอลในเลือด ผู้ที่ BMI มากกว่า 25 อายุ 25 - 34 ปี', '1', '60', '0', '1', 'ตรวจสอบย้อนหลัง 5 ปี/คน/ครั้ง หรือผู้ทีมีประวัติญาติสายตรงเป็นโรคหลอดเลือดหัวใจ โรคหลอดเลือดสมอง หรือ โรคหลอดเลือดตีบตันอื่นๆ', '-', '06 ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 25 - 34 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ Cholesterol\r\n- ต้องมีผล ของ Triglyceride\r\n- ต้องมีผล ของ HDL\r\n- ต้องมีผล ของ LDL\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'503\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_cho =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541602\');\r\nSET @lab_name_tri =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0546602\');\r\nSET @lab_name_hdl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541202\');\r\nSET @lab_name_ldl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541402\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 25\r\n                                                                         AND 34\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_cho) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_tri) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hdl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_ldl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 503', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('39', '504', 'LAB ตรวจ Fasting Plasma Glucose ผู้ที่ BMI มากกว่า 25 อายุ 25 - 34 ปี', '1', '40', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง หรือผู้ที่ประวัติญาติสายตรงเป็น DM หรือ ผู้ที่เคยตรวจพบความทนต่อกลูโคสผิดปกติ หรือ เคยตรวจพบระดับกลูโคสพลาสมาผิดปกติ', '-', '06 ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 25 - 34 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล Glucose\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'504\';\r\nSET @activity_cost = \'40\';\r\nSET @lab_name_fbs =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0531002\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 25\r\n                                                                         AND 34\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref, @lab_name_fbs) >=\r\n                     1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 504', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('40', '505', 'ตรวจอุจจาระ', '1', '50', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '06 ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- สามารถเปลี่ยนชื่อ LAB อุจจาระได้ที่ set @lab_name_stool := \'lab_stool_name\';\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 25 - 34 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล การตรวจอุจจาระ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'505\';\r\nset @activity_cost = \'50\';\r\nset @lab_name_stool = \'lab_stool_name\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\nSELECT\r\n    person.cid,\r\n    person.pname,\r\n    person.fname,\r\n    person.lname,\r\n    cast(@activity_code AS CHAR) AS activity_code,\r\n    cast(@activity_cost AS CHAR) AS activity_cost,\r\n    cast(lab_head.order_date AS CHAR) AS date_serv,\r\n    cast(@h_sub AS CHAR) AS h_sub\r\nFROM\r\n    lab_order\r\nINNER JOIN lab_head ON lab_order.lab_order_number = lab_head.lab_order_number\r\nINNER JOIN person ON lab_head.hn = person.patient_hn\r\nINNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE\r\n    lab_head.order_date BETWEEN @start_date\r\nAND @stop_date\r\nAND timestampdiff(\r\n    YEAR,\r\n    person.birthdate,\r\n    lab_head.order_date\r\n) BETWEEN 25\r\nAND 34\r\nAND lab_order.lab_order_result IS NOT NULL\r\nAND person.sex IN (1, 2)\r\nAND person.nationality = 99\r\nAND person.discharge_date IS NULL\r\nAND person.death <> \'y\'\r\nGROUP BY\r\n    person.cid\r\nHAVING\r\n    SUM(\r\n        CASE\r\n        WHEN find_in_set(\r\n            lab_order.lab_items_name_ref ,@lab_name_stool\r\n        ) >= 1 THEN\r\n            1\r\n        ELSE\r\n            0\r\n        END\r\n    ) >= 1\r\nORDER BY\r\n    lab_head.order_date,\r\n    person.cid;', null, 'Fix Stable 2022-04-23 PBS 505', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('41', '506', 'ไม่สามารถเบิกได้ ปี 2565 ฉีดวัคซีน dT ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', '0', '0', '0', '0', 'เงื่อนไขซ้ำซ้อนการเบิกค่ารักษาพยาบาล ที่สามารถเบิกได้คืนทางเครือข่ายได้อยู่แล้ว', '-', '06 ผู้ใหญ่วัยทำงานตอนต้น(อายุ 25 - 34 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 506', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('42', '601', 'Verbal Screening ซักประวัติ ประเมินพฤติกรรมสุขภาพ และการตรวจร่างกาย อายุ 35 -59 ปี', '1', '10', '1', '1', 'คัดกรองโรคเบาหวาน ความดันโลหิตสูง Verbal Screen', 'ประกอบด้วย\r\n    สมุดบันทึกประจำตัว(แม่สนับสนุนตามความเหมาะสม)\r\n    ประวัติครอบครัวและโรคพันธุกรรม\r\n    ประวัติการเจ็บป่วย\r\n    การเสี่ยงต่อการบาดเจ็บจากการจราจรและอื่นๆ\r\n    การสูบบุหรี่ การดื่มสุรา การใช้สารเสพติด\r\n    การประเมินพฤติกรรมการบริโภคอาหาร\r\n    การมีเพศสัมพันธ์ความเสี่ยงสูงต่อการเกิดโรคติดต่อทางเพศสัมพันธ์ และ การตั้งครรภ์อันไม่พึงประสงค์\r\n    ประเมินความเสี่ยงต่อสุขภาพจากลักษณะงาน\r\n    อาการเตือนของโรคมะเร็ง\r\n    ประเมินความฉลาดทางอารมณ์ของบุคคล\r\n    กระเมินความเครียด ภาวะซึมเศร้า และความเสี่ยงต่อการฆ่าตัวตาย ประเมินโดยเจ้าหน้าที่\r\n    ชั่งน้ำหนัก วัดส่วนสูง ประเมินดัชนีมวลกาย\r\n    ประเมินอ้วนลงพุงโดยวัดเส้นรอบเอว\r\n    วัดความดันโลหิต\r\n    ตรวจสุขภาพช่องปาก\r\n    ตรวจคัดกรองมะเร็งช่องปาก\r\n    วัดสายตาด้วยแผนภูมิสเนลเลน ผู้ที่อายุ 50 ปี ขึ้นไป หรือ ผุ้ที่ขับขี่ยานพาหนะ หรือ ผู้ทีทำงาน ที่ต้องเพ่งสายตา', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,3 เท่านั้น เพื่อตรงกลุ่มเป้าหมายที่รับผิดชอบ และ ไม่เกิดความซ้ำซ้อนระหว่างหน่วยบริการอื่นๆ\r\n- ต้องไม่เป็นผู้ป่วยโรคเบาหวาน และ ความดันโลหิตสูงมาแล้ว โดยตรวจสอบจาก บัญชี1,คลินิกพิเศษโรคเรื้อรัง,รหัสการวินิจฉัยของการให้บริการ\r\n- อายุตามเงื่อนไข 35 - 59 ปี เท่านั้น\r\n- เพิ่ม Index ตาราง person_chronic เพิ่มความเร็วในการประมวลผล', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'601\';\r\nSET @activity_cost = \'10\';\r\nSET @bdg_year = \'2565\';\r\n\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR) AS activity_code,\r\n       cast(@activity_cost AS CHAR) AS activity_cost,\r\n       date_format(\r\n          min(date(person_dmht_screen_summary.last_screen_datetime)),\r\n          \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM person_dmht_risk_screen_head\r\n     INNER JOIN person_dmht_nhso_screen\r\n        ON person_dmht_risk_screen_head.person_dmht_screen_summary_id =\r\n              person_dmht_nhso_screen.person_dmht_screen_summary_id\r\n     INNER JOIN person_dmht_screen_summary\r\n        ON person_dmht_risk_screen_head.person_dmht_screen_summary_id =\r\n              person_dmht_screen_summary.person_dmht_screen_summary_id\r\n     INNER JOIN person\r\n        ON person_dmht_screen_summary.person_id = person.person_id\r\nWHERE     person_dmht_screen_summary.last_screen_datetime BETWEEN @start_date\r\n                                                              AND @stop_date\r\n      AND person_dmht_nhso_screen.present_drinking_alcohol IS NOT NULL\r\n      AND person_dmht_nhso_screen.present_smoking IS NOT NULL\r\n      AND person_dmht_risk_screen_head.body_height IS NOT NULL\r\n      AND person_dmht_risk_screen_head.body_weight IS NOT NULL\r\n      AND person_dmht_risk_screen_head.waist IS NOT NULL\r\n      AND person_dmht_risk_screen_head.last_bps IS NOT NULL\r\n      AND person_dmht_risk_screen_head.last_bpd IS NOT NULL\r\n      AND timestampdiff(YEAR,\r\n                        person.birthdate,\r\n                        person_dmht_screen_summary.last_screen_datetime) BETWEEN 35\r\n                                                                             AND 59\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND person.sex IN (1, 2)\r\n      AND person.death <> \'y\'\r\n      AND person.death_date IS NULL\r\n      AND person.nationality = 99\r\n      AND person_dmht_screen_summary.bdg_year = @bdg_year\r\n      AND person.cid NOT IN\r\n             (SELECT cid\r\n              FROM (-- person_chronic\r\n                    SELECT cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN LEFT(person_chronic.icd10, 3) BETWEEN \'e10\'\r\n                                                                        AND \'e14\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN LEFT(person_chronic.icd10, 3) BETWEEN \'i10\'\r\n                                                                        AND \'i15\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN person_chronic\r\n                            ON person.person_id =\r\n                                  person_chronic.person_id\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN LEFT(person_chronic.icd10, 3) BETWEEN \'e10\'\r\n                                                                            AND \'e14\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN LEFT(person_chronic.icd10, 3) BETWEEN \'i10\'\r\n                                                                            AND \'i15\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(cid) = 13\r\n                    UNION ALL\r\n                    -- clinicmember\r\n                    SELECT person.cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN clinicmember.clinic = \'001\' THEN 1\r\n                                 ELSE 0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN clinicmember.clinic = \'002\' THEN 1\r\n                                 ELSE 0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN clinicmember\r\n                            ON person.patient_hn = clinicmember.hn\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN clinicmember.clinic = \'001\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN clinicmember.clinic = \'002\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(cid) = 13\r\n                    UNION ALL\r\n                    -- ovstdiag\r\n                    SELECT person.cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN LEFT(ovstdiag.icd10, 3) BETWEEN \'e10\'\r\n                                                                  AND \'e14\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN LEFT(ovstdiag.icd10, 3) BETWEEN \'i10\'\r\n                                                                  AND \'i15\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN ovstdiag\r\n                            ON person.patient_hn = ovstdiag.hn\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN LEFT(ovstdiag.icd10, 3) BETWEEN \'e10\'\r\n                                                                      AND \'e14\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN LEFT(ovstdiag.icd10, 3) BETWEEN \'i10\'\r\n                                                                      AND \'i15\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(cid) = 13) AS all_chronic\r\n              GROUP BY all_chronic.cid)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 601', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('43', '602', 'ตรวจมะเร็งเต้านม สอนการตรวจเต้านม อายุ 30 - 70 ปี', '1', '15', '1', '1', '-', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,3 เท่านั้น เพื่อตรงกลุ่มเป้าหมายที่รับผิดชอบ และ ไม่เกิดความซ้ำซ้อนระหว่างหน่วยบริการอื่นๆ\r\n- เพศหญิงเท่านั้น\r\n- อายุ 30 - 70 ปี \r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z123\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ร่วมด้วยดังนี้\r\n    1B0030 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลปกติ ผู้รับบริการเคยตรวจด้วยตนเองได้ผลปกติ\r\n    1B0031 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลปกติ ผู้รับบริการเคยตรวจด้วยตนเองได้ผลผิดปกติ\r\n    1B0032 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลปกติ ผู้รับบริการไม่เคยตรวจด้วยตนเอง\r\n    1B0033 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลปกติ ไม่ระบุว่าผู้รับบริการเคยตรวจด้วยตนเองหรือไม่\r\n    1B0034 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลผิดปกติ ผู้รับบริการเคยตรวจด้วยตนเองได้ผลปกติ\r\n    1B0035 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลผิดปกติ ผู้รับบริการเคยตรวจด้วยตนเองได้ผลผิดปกติ\r\n    1B0036 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลผิดปกติ ผู้รับบริการไม่เคยตรวจด้วยตนเอง\r\n    1B0037 ตรวจคัดกรองความเสี่ยง/โรคมะเร็งเต้านมได้ผลผิดปกติ ไม่ระบุว่าผู้รับบริการเคยตรวจด้วยตนเองหรือไม่', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'602\';\r\nSET @activity_cost = \'10\';\r\nSET @icd10set = (\'z123\');\r\nSET @ppset = \'1b0030,1b0031,1b0032,1b0033,1b0034,1b0035,1b0036,1b0037\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                 AS activity_code,\r\n             cast(@activity_cost AS CHAR)                 AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_brest,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_brest_result,\r\n             timestampdiff(YEAR, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.sex = 2\r\n            AND person.nationality = 99\r\n            AND person.house_regist_type_id IN (1, 3)\r\n            AND person.death <> \'y\'\r\n            AND person.death_date IS NULL\r\n            AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) BETWEEN 30\r\n                                                                        AND 70\r\n      GROUP BY person.cid\r\n      HAVING     (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(\r\n                                   pp_special_type.pp_special_code,\r\n                                   @ppset)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n             AND (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(LEFT(ovstdiag.icd10, 4),\r\n                                            @icd10set)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS temp_602\r\nGROUP BY temp_602.cid\r\nORDER BY temp_602.date_serv;', null, 'Fix Stable 2022-04-23 PBS 602', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('44', '603', 'คัดกรองความเสี่ยงจากการสูบบุหรี่ 35 - 59 ปี  ใช้แบบ FRAGER STORM', '1', '10', '1', '1', 'อ้างอิงให้สอดคล้องกับระบบ HDC NCDSCREEN,SPECIALPP', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  \r\ntimestampdiff(year,person.birthdate,person_dmht_screen_summary.last_screen_datetime)\r\ntimestampdiff(year,person.birthdate,ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 ปีเท่านั้น    \r\n- ต้องมีการระบุรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรองบุหรี่\r\n1B501 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่ 1-10 มวนต่อวัน\r\n1B502 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่ 11-19 มวนต่อวัน\r\n1B503 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่ 20 มวนขึ้นไปต่อวัน\r\n1B504 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่มวนแรกหลังตื่นนอน น้อยกว่า 30 นาที\r\n1B505 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่มวนแรกหลังตื่นนอน มากกว่า 30 นาที แต่น้อยกว่า 1 ชั่วโมง\r\n1B506 ผู้มารับบริการมีพฤติกรรมสูบบุหรี่มวนแรกหลังตื่นนอน 1 ชั่วโมง หรือมากกว่า\r\n1B530    การให้คำแนะนำผู้ติดบุหรี่แบบสั้น (Brief Advice)\r\n1B531    การให้คำปรึกษาเพื่อการเลิกบุหรี่ (Counseling Advice)\r\n1B532    การให้คำปรึกษาและให้ยาเพื่อเลิกบุหรี่ (Counseling Advice + Medicine)', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'603\';\r\nSET @activity_cost = \'10\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT\r\nsmoking.cid,\r\nsmoking.pname,\r\nsmoking.fname,\r\nsmoking.lname,\r\nsmoking.activity_code,\r\nsmoking.activity_cost,\r\nsmoking.date_serv,\r\nsmoking.h_sub\r\nFROM\r\n(\r\nSELECT\r\n    person.cid,\r\n    person.pname,\r\n    person.fname,\r\n    person.lname,\r\n    @activity_code AS activity_code,\r\n    @activity_cost AS activity_cost,\r\n    cast( min(date(ovst.vstdate)) as char) AS date_serv,\r\n    @h_sub AS h_sub,\r\ngroup_concat(DISTINCT pp_special_type.pp_special_code) as list_pp,\r\nmax(CASE WHEN pp_special_type.pp_special_code BETWEEN \'1B501\' AND \'1B503\' THEN 1 ELSE 0 END ) AS ch1,\r\nmax(CASE WHEN pp_special_type.pp_special_code BETWEEN \'1B504\' AND \'1B506\' THEN 1 ELSE 0 END ) AS ch2,\r\nmax(CASE WHEN pp_special_type.pp_special_code BETWEEN \'1B530\' AND \'1B532\' THEN 1 ELSE 0 END ) AS ch3\r\nFROM\r\n    ovst\r\nLEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\nLEFT OUTER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\nLEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE\r\n    ovst.vstdate BETWEEN @start_date\r\nAND @stop_date\r\nAND timestampdiff(\r\n    YEAR,\r\n    person.birthdate,\r\n    ovst.vstdate\r\n) BETWEEN 35\r\nAND 59\r\nAND person.house_regist_type_id IN (1, 3)\r\nAND pp_special_type.pp_special_code LIKE \'1b5%\'\r\nAND person.sex IN (1, 2)\r\nAND person.death <> \'y\'\r\nAND person.death_date IS NULL\r\nAND person.nationality = 99\r\nGROUP BY\r\nperson.cid\r\n) AS smoking\r\nWHERE \r\nch1 = 1\r\nAND\r\nch2 = 1\r\nAND\r\nch3 = 1 ;', null, 'Fix Stable 2022-04-23 PBS 603', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('79', '621', 'Pap Smear นอกกลุ่มเป้าหมาย', '1', '150', '1', '1', 'หญิงทั่วไปนอกกลุ่มเป้าหมาย,หญิงหลังคลอด\r\nทดลองจ่ายชดเชย 6 เดือนแรก', null, '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,2,3,4 เท่านั้น\r\n- เพศหญิงเท่านั้น\r\n- อายุ 30 - 70 ปี \r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z124,Z014\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ร่วมด้วยดังนี้\r\n1B30    ผลการตรวจคัดกรองมะเร็งปากมดลูก ผลปกติ\r\n1B40    ผลการตรวจคัดกรองมะเร็งปากมดลูก ผลผิดปกติ\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'621\';\r\nSET @activity_cost = \'150\';\r\nSET @icd10set = \'z124,z014\';\r\nSET @ppset = \'1b30,1b40\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                 AS activity_code,\r\n             cast(@activity_cost AS CHAR)                 AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_brest,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_brest_result,\r\n             timestampdiff(YEAR, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.sex = 2\r\n            AND person.nationality = 99\r\n            AND person.house_regist_type_id IN (1,2,3,4)\r\n            AND person.death <> \'y\'\r\n            AND person.death_date IS NULL\r\n            AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) BETWEEN 30\r\n                                                                        AND 70\r\n      GROUP BY person.cid\r\n      HAVING     (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(\r\n                                   pp_special_type.pp_special_code,\r\n                                   @ppset)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n             AND (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(LEFT(ovstdiag.icd10, 4),\r\n                                            @icd10set)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS temp_621\r\nGROUP BY temp_621.cid\r\nORDER BY temp_621.date_serv;', null, 'Fix Stable 2022-04-23 PBS 621', 'InforReportable', '2022-04-24', '1', null, null, null);
INSERT INTO `pbs_items` VALUES ('45', '604', 'คัดกรองความเสี่ยงจากการดื่มสุรา 35 - 59 ปี  ใช้แบบ ASSIT', '1', '10', '1', '1', 'อ้างอิงให้สอดคล้องกับระบบ HDC NCDSCREEN,SPECIALPP', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  \r\ntimestampdiff(year,person.birthdate,person_dmht_screen_summary.last_screen_datetime)\r\ntimestampdiff(year,person.birthdate,ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 ปีเท่านั้น    \r\n- ต้องมีการระบุรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรองบุหรี่\r\n1B602    ผู้มารับบริการดื่มเครื่องดื่มแอลกอฮอล์ในระดับเสี่ยงต่ำ (คะแนน 0-10)\r\n1B603    ผู้มารับบริการดื่มเครื่องดื่มแอลกอฮอล์ในระดับเสี่ยงปานกลาง (คะแนน 11-26)\r\n1B604    ผู้มารับบริการดื่มเครื่องดื่มแอลกอฮอล์ในระดับเสี่ยงสูง (คะแนนตั้งแต่ 27 ขึ้นไป)\r\n1B610    การให้คำแนะนำ (brief advice)\r\n1B611    การให้คำปรึกษาแบบสั้น (brief counseling)\r\n1B612    การส่งต่อเพื่อรับการประเมินและการบำบัดโดยผู้เชี่ยวชาญ (refer)\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'604\';\r\nSET @activity_cost = \'10\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT\r\ndrink.cid,\r\ndrink.pname,\r\ndrink.fname,\r\ndrink.lname,\r\ndrink.activity_code,\r\ndrink.activity_cost,\r\ndrink.date_serv,\r\ndrink.h_sub\r\nFROM\r\n(\r\nSELECT\r\n    person.cid,\r\n    person.pname,\r\n    person.fname,\r\n    person.lname,\r\n    @activity_code AS activity_code,\r\n    @activity_cost AS activity_cost,\r\n    cast(min(date(ovst.vstdate)) as char) AS date_serv,\r\n    @h_sub AS h_sub,\r\ngroup_concat(DISTINCT pp_special_type.pp_special_code) as list_pp,\r\nmax(CASE WHEN pp_special_type.pp_special_code BETWEEN \'1B604\' AND \'1B603\' THEN 1 ELSE 0 END ) AS ch1,\r\nmax(CASE WHEN pp_special_type.pp_special_code BETWEEN \'1B610\' AND \'1B612\' THEN 1 ELSE 0 END ) AS ch2\r\nFROM\r\n    ovst\r\nLEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\nLEFT OUTER JOIN pp_special_type ON pp_special.pp_special_type_id = pp_special_type.pp_special_type_id\r\nLEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE\r\n    ovst.vstdate BETWEEN @start_date\r\nAND @stop_date\r\nAND timestampdiff(\r\n    YEAR,\r\n    person.birthdate,\r\n    ovst.vstdate\r\n) BETWEEN 35\r\nAND 59\r\nAND person.house_regist_type_id IN (1, 3)\r\nAND pp_special_type.pp_special_code LIKE \'1b6%\'\r\nAND person.sex IN (1, 2)\r\nAND person.death <> \'y\'\r\nAND person.death_date IS NULL\r\nAND person.nationality = 99\r\nGROUP BY\r\nperson.cid\r\n) AS drink\r\nWHERE \r\nch1 = 1\r\nAND\r\nch2 = 1 ;', null, 'Fix Stable 2022-04-23 PBS 604', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('83', '813', 'การเจาะเลือด(FBS) กลุ่มสงสัยป่วยโรคเบาหวาน ในกลุ่มอายุ 35 ปีขึ้นไป', '1', '50', '0', '1', 'ประมวลผลจากระบบ HDC\r\n1.5. ร้อยละการตรวจติดตามยืนยันวินิจฉัยกลุ่มสงสัยป่วยโรคเบาหวาน', 'กลุ่มรายงานมาตรฐาน\r\nข้อมูลเพื่อตอบสนอง Service Plan สาขาโรคไม่ติดต่อ (NCD DM,HT,CVD)\r\nร้อยละการตรวจติดตามยืนยันวินิจฉัยกลุ่มสงสัยป่วยโรคเบาหวาน', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nระบบ HDC', null, 'SELECT\r\n    cprename.prename,\r\n    p. NAME,\r\n    p.lname,\r\n    \'813\' AS activity_code,\r\n    \'50\' AS activity_cost,\r\n    cast(t.lab_date AS CHAR) AS date_serv,\r\n    \'10679\' AS hospcode\r\nFROM\r\n    t_dm_follow AS t\r\nINNER JOIN t_person_cid p ON t.hospcode = p.check_hosp\r\nAND t.cid = p.cid\r\nINNER JOIN cprename ON p.PRENAME = cprename.id_prename\r\nWHERE\r\n    t.date_screen BETWEEN \'2021-10-01\'\r\nAND \'2022-09-30\'\r\nAND t.labfu = 1\r\nAND t.hospcode IN (\r\n    \'08322\',\r\n    \'08323\',\r\n    \'08324\',\r\n    \'08325\',\r\n    \'08326\',\r\n    \'08327\',\r\n    \'08328\',\r\n    \'08329\',\r\n    \'08330\',\r\n    \'08331\',\r\n    \'08332\',\r\n    \'08333\',\r\n    \'08334\',\r\n    \'08335\',\r\n    \'08336\',\r\n    \'08337\',\r\n    \'08338\',\r\n    \'08339\',\r\n    \'08340\',\r\n    \'08341\',\r\n    \'08342\',\r\n    \'08343\',\r\n    \'08344\',\r\n    \'08345\',\r\n    \'08346\',\r\n    \'08347\',\r\n    \'08348\',\r\n    \'08349\',\r\n    \'08350\',\r\n    \'08351\',\r\n    \'08357\',\r\n    \'08358\',\r\n    \'08405\',\r\n    \'08440\',\r\n    \'08441\',\r\n    \'10679\',\r\n    \'14870\',\r\n    \'23916\',\r\n    \'77508\',\r\n    \'77645\'\r\n)\r\nORDER BY\r\n    t.hospcode ;', null, 'Fix Stable 2022-04-23 PBS 813', 'InforReportable', '2022-04-24', '0', null, null, null);
INSERT INTO `pbs_items` VALUES ('47', '606', 'LAB ตรวจความเข้มข้นของเม็ดเลือด HCT,HB ผู้ที่ BMI น้อยกว่า 18.5 อายุ 35 - 59 ปี', '1', '30', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- ต้องมี BMI น้อยกว่า 18.5', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'606\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) < 18.5\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hct) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hb) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 606', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('48', '607', 'LAB ตรวจวัดระดับโคเลสเตอรอลในเลือด ผู้ที่ BMI มากกว่า 25 อายุ 35 - 59 ปี', '1', '60', '0', '1', 'ตรวจสอบย้อนหลัง 5 ปี/คน/ครั้ง', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ Cholesterol\r\n- ต้องมีผล ของ Triglyceride\r\n- ต้องมีผล ของ HDL\r\n- ต้องมีผล ของ LDL\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'607\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_cho =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541602\');\r\nSET @lab_name_tri =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0546602\');\r\nSET @lab_name_hdl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541202\');\r\nSET @lab_name_ldl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541402\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_cho) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_tri) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hdl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_ldl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 607', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('49', '608', 'LAB ตรวจ Fasting Plasma Glucose ผู้ที่ BMI มากกว่า 25 อายุ 35 - 59 ปี', '1', '40', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง หรือผู้ที่ประวัติญาติสายตรงเป็น DM หรือ ผู้ที่เคยตรวจพบความทนต่อกลูโคสผิดปกติ หรือ เคยตรวจพบระดับกลูโคสพลาสมาผิดปกติ', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 35 - 59 เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล Glucose\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'608\';\r\nSET @activity_cost = \'40\';\r\nSET @lab_name_fbs =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0531002\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 35\r\n                                                                         AND 59\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref, @lab_name_fbs) >=\r\n                     1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 608', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('50', '609', 'ไม่สามารถเบิกได้ ปี 2565 ฉีดวัคซีน dT ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', '0', '0', '0', '0', 'เงื่อนไขซ้ำซ้อนการเบิกค่ารักษาพยาบาล ที่สามารถเบิกได้คืนทางเครือข่ายได้อยู่แล้ว', '-', '07 ผู้ใหญ่วัยทำงานตอนปลาย(อายุ 35 - 59 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 609', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('51', '610', 'ยาเม็ด คุมกำเนิด', '12', '40', '1', '1', 'รวมตรวจ Alb/Sug', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการยาเม็ดคุมกำเนิด\');', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'610\';\r\nSET @activity_cost = \'40\';\r\nSET @paraname = concat(\'ชื่อยาหรือรายการยาเม็ดคุมกำเนิด\');\r\nSET @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_610;', null, 'Fix Stable 2022-04-23 PBS 610', 'InforReportable', '2022-04-24', '1', '999999', '21', '84');
INSERT INTO `pbs_items` VALUES ('52', '611', 'ยาฉีด คุมกำเนิด', '4', '60', '1', '1', 'รวมตรวจ Alb/Sug', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการยาฉีดคุมกำเนิด\');', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'611\';\r\nset @activity_cost = \'60\';\r\nset @paraname = concat(\'ชื่อยาหรือรายการยาเม็ดคุมกำเนิด\');\r\nset @icd10set = concat(\'z3\',\'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_611;', null, 'Fix Stable 2022-04-23 PBS 611', 'InforReportable', '2022-04-24', '1', '999999', '84', '84');
INSERT INTO `pbs_items` VALUES ('53', '612', 'ถุงยางอนามัย คุมกำเนิด', '12', '50', '1', '1', '-', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิง และ เพศชาย\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการถุงยางอนามัย\');', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'612\';\r\nset @activity_cost = \'50\';\r\nset @paraname = concat(\'ชื่อยาหรือรายการถุงยางอนามัย\');\r\nset @icd10set = concat(\'z3\',\'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex IN (1, 2)\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex IN (1, 2)\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_612;', null, 'Fix Stable 2022-04-23 PBS 612', 'InforReportable', '2022-04-24', '1', '999999', '28', '84');
INSERT INTO `pbs_items` VALUES ('54', '613', 'ใส่ห่วง Multipleload รวมถอดห่วง อายุ 20 ปีขึ้นไป', '1', '800', '0', '1', '-', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- อายุมากกว่า 20 ปี\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\n- รหัสหัตถการ\r\n  5191000 | 697    | Insertion of intrauterine contraceptive device\r\n  5191100 | 9771    | Removal of intrauterine contraceptive device', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'613\';\r\nSET @activity_cost = \'800\';\r\nSET @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\nSET @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_613;', null, 'Fix Stable 2022-04-23 PBS 613', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('55', '614', 'ห่วง Copper T รวมถอดห่วง', '1', '150', '0', '1', '-', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- อายุมากกว่า 20 ปี\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\n- รหัสหัตถการ\r\n  5191000 | 697    | Insertion of intrauterine contraceptive device\r\n  5191100 | 9771    | Removal of intrauterine contraceptive device', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'614\';\r\nSET @activity_cost = \'150\';\r\nSET @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\nSET @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_614;', null, 'Fix Stable 2022-04-23 PBS 614', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('56', '615', 'ยาฝัง คุมกำเนิด อายุ 20 ปี ขึ้นไป', '1', '2800', '0', '1', 'ต่ำกว่า 20 ปี เบิก สปสช.', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- อายุมากกว่า 20 ปี\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z3*\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\nเพิ่มเติม ที่มาจาก Z30-Z39 บุคคลที่มารับบริการสุขภาพเกี่ยวกับการเจริญพันธุ์\r\nhttp://occmednop.com/nrhicd/icd/icd_folder.php?icd_id=463&back=460\r\n- ถ้าแพทย์บันทึกว่าได้ให้บริการฝังยาคุมกำเนิดให้ผิวหนังที่ต้นแขน หรือผ่าเอายาที่ฝังไว้ออก ให้ใช้รหัส Z30.8 Other contraceptive management เป็นรหัสการวินิจฉัย \r\n- รหัสหัตถการสำหรับการฝังยาคุมกำเนิดคือ 99.23 Injection of steroid (602-44-03) (ซึ่งรวม subdermal implantation of progesterone) \r\n- ส่วนรหัสหัตถการผ่าเอายาคุมกำเนิดที่ฝังไว้ออกคือ 86.05 Incision with removal of foreign body from skin and subcutaneous tissue (602-45-03) ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'615\';\r\nSET @activity_cost = \'2800\';\r\nSET @paraname =concat(\'ชื่อยาหรือรายการที่ต้องการ\');\r\nSET @icd10set = concat(\'z3\', \'%\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex = 2\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND ovstdiag.icd10 LIKE @icd10set\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n             AND TIMESTAMPDIFF(YEAR, person.birthdate, ovstdiag.vstdate) >\r\n                    20\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_615;', null, 'Fix Stable 2022-04-23 PBS 615', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('57', '616', 'หมันหญิง', '1', '2000', '0', '1', 'เพิ่มอัตราคุมกำเนิดถาวร', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศหญิงเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z302\r\n    Z302 Sterilization การทำหมัน\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'616\';\r\nSET @activity_cost = \'2000\';\r\nSET @icd10 = \'Z302\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND person.sex = 2\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 616', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('58', '617', 'หมันชาย', '1', '1500', '0', '1', '-', '-', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- เพศชายเท่านั้น\r\n- ต้องมีการระบุรหัสวินิจฉัย กลุ่ม การให้บริการ ตรวจ Z302\r\n    Z302 Sterilization การทำหมัน\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'617\';\r\nSET @activity_cost = \'1500\';\r\nSET @icd10 = \'Z302\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM ovst\r\n     INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n     INNER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @icd10\r\n      AND person.sex = 1\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 617', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('78', '214', 'TEDA4I ประเมินพัฒนาการเด็ก 0 - 5 ปี สงสัยล่าช้า  (9,18,30,42,60 เดือน)', '1', '200', '0', '1', 'คู่มือเฝ้าระวังและส่งเสริมพัฒนาการ DSPM', 'กิจกรรมเดิม (QOF) เพิ่มเพื่อขับเคลื่อนงาน\r\nประเมินพัฒนาการเด็ก 0 - ปี (9,18,30,42,60 เดือน)\r\nประเมินความฉลาดทางอารมณ์\r\nให้ความรู้/ทักษะการประเมิน ตรวจวัดพัฒนาการเด็ก ความฉลาดทางอารมณ์ของพ่อแม่\r\nเด็กที่ได้รับการประเมินในช่วง 9 เดือนเท่านั้น ที่จะสามารถมีการประเมินมากกว่า 1 ครั้งได้ แต่ไม่เกิน 2 ครั้ง (ครั้งที่ 2 คือ 18 เดือน ระยะห่างจากครั้งแรก 9 เดือน ในปีงบประมาณเดียวกัน)', '03 กลุ่มเด็กเล็กและเด็กก่อนวัยเรียน(แรกเกิด - น้อยกว่า 6 ปี)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ในคำสั่ง มีการอำนวนความสะดวก ปรับ วันที่ บันทึก PP Special ให้ตรงกับวันที่รับบริการ ในกรณีที่หน่วยบริการ บันทึกข้อมูลไม่ทัน และย้อนหลังวันที่ เครื่อง ไปบันทึก PP Special สามารถเอาออกได้หากไม่ต้องการปรับปรุง    \r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  timestampdiff(month, person.birthdate, ovst.vstdate)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนเดือน 09,18,30,42,60 เดือนเท่านั้น\r\n- มีการลงบันทึก PP Special ร่วมด้วย ดังนี้  อย่างน้อย 1 รายการ ต่อการให้บริการ\r\n    1B200 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลปกติ\r\n    1B201 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B202 การตรวจคัดกรองพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B203 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPMผลปกติ\r\n    1B204 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B205 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B209 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเคลื่อนไหวโดยเครื่องมือ DSPM และ หรือ DAIM ไม่ระบุรายละเอียด\r\n    1B210 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B211 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B212 การตรวจคัดกรองพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B213 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B214 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B215 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B219 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านกล้ามเนื้อมัดเล็กและสติปัญญาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B220 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B221 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B222 การตรวจคัดกรองพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B223 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B224 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B225 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B229 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการเข้าใจภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B230 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B231 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B232 การตรวจคัดกรองพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B233 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลปกติ\r\n    1B234 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B235 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B239 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาษาโดยเครื่องมือ DSPM และหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B240 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B241 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B242 การตรวจคัดกรองพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลล่าช้าส่งเพื่อประเมิน/รักษาต่อ\r\n    1B243 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM ผลปกติ\r\n    1B244 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B245 การตรวจแบบเฝ้าระวังพัฒนาการสมวัยด้านการใช้ภาด้านการช่วยเหลือตัวเองและสังคม โดยเครื่องมือ DSPM ผลล่าช้า ส่งเพื่อประเมิน/รักษาต่อ\r\n    1B249 การตรวจคัดกรอง/แบบเฝ้าระวังพัฒนาการสมวัยด้านการช่วยเหลือตัวเองและสังคมโดยเครื่องมือ DSPMและหรือ DAIM ไม่ระบุรายละเอียด\r\n    1B260 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM ผลปกติ\r\n    1B261 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งเสริมพัฒนาการใน 1 เดือน\r\n    1B262 ผลการตรวจคัดกรองพัฒนาการสมวัยโดยเครื่องมือ DSPM สงสัยล่าช้า ส่งต่อทันที', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'214\';\r\nSET @activity_cost = \'200\';\r\nSET @ppset =\r\n       \'1b200,1b201,1b202,1b203,1b204,1b205,1b209,1b210,1b211,1b212,1b213,1b214,1b215,1b219,1b220,1b221,1b222,1b223,1b224,1b225,1b229,1b230,1b231,1b232,1b233,1b234,1b235,1b239,1b240,1b241,1b242,1b243,1b244,1b245,1b249,1b260,1b261,1b262\';\r\n\r\nUPDATE pp_special\r\nSET pp_special.entry_datetime =\r\n       concat((concat(\'25\', LEFT(pp_special.vn, 2)) - 543),\r\n              \'-\',\r\n              mid(pp_special.vn, 3, 2),\r\n              \'-\',\r\n              mid(pp_special.vn, 5, 2),\r\n              \' \',\r\n              time(pp_special.entry_datetime))\r\nWHERE concat(\'25\', LEFT(pp_special.vn, 2)) <>\r\n         (LEFT(pp_special.entry_datetime, 4) + 543);\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (-- startrun\r\n      SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             @activity_code                               AS activity_code,\r\n             @activity_cost                               AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_dspm,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_dspm_result,\r\n             timestampdiff(MONTH, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.nationality = 99\r\n            AND person.death <> \'y\'\r\n            AND timestampdiff(MONTH, person.birthdate, ovst.vstdate) IN\r\n                   (9,\r\n                    18,\r\n                    30,\r\n                    42,\r\n                    60)\r\n      GROUP BY person.cid, ovst.vstdate\r\n      HAVING (IF(sum(\r\n                    CASE\r\n                       WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                        @ppset)\r\n                       THEN\r\n                          1\r\n                       ELSE\r\n                          0\r\n                    END) >= 1,\r\n                 1,\r\n                 0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS a;', '', 'Fix Stable 2022-04-23 PBS 214', 'InforReportable', '2022-04-24', '1', '999999', '180', '84');
INSERT INTO `pbs_items` VALUES ('59', '618', 'ไม่สามารถเบิกได้ ปี 2565 คัดกรองโลหิตจาง CBC,HB,HCT วัยรุ่นที่เริ่มมีประจำเดือน 14 - 24 ปี', '0', '0', '0', '0', 'เงื่อนไขซ้ำซ้อนรหัส 302 เจาะ HCT เด็ก ป.1,ม.1', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตวจนับเม็ดเลือด CBC,HB,HCT วัยรุ่นหญิงที่เริ่มมีประจำเดือน อายุ 13 - 24 ปี', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 618', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('60', '619', 'ไม่สามารถเบิกได้ ปี 2565 คัดกรองโลหิตจาง HCT วัยรุ่นที่เริ่มมีประจำเดือน 14 - 24 ปี', '0', '0', '0', '0', 'เงื่อนไขซ้ำซ้อนรหัส 302 เจาะ HCT เด็ก ป.1,ม.1', 'คัดกรองโลหิตจาง จากการขาดธาตุเหล็กตวจนับเม็ดเลือด CBC,HB,HCT วัยรุ่นหญิงที่เริ่มมีประจำเดือน อายุ 13 - 24 ปี', '08 การวางแผนครอบครัว', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 619', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('61', '701', 'คัดกรองผู้สูงอายุ 60 ปี ขึ้นไป', '1', '100', '1', '1', 'ตามแบบประเมินผู้สูงอายุ คู่มือเล่มสีฟ้า มีการใช้สมุดและมีรายละเอียด ครบ 20 รายการ', 'ประกอบด้วย\r\n    สมุดบันทึกประจำตัว\r\n    ประวัติครอบครัวและโรคพันธุกรรม\r\n    ประวัติการเจ็บป่วย\r\n    การเสี่ยงต่อการบาดเจ็บจากการจราจรและอื่นๆ\r\n    การสูบบุหรี่ การดื่มสุรา การใช้สารเสพติด\r\n    การประเมินพฤติกรรมการบริโภคอาหาร\r\n    การมีเพศสัมพันธ์ความเสี่ยงสูงต่อการเกิดโรคติดต่อทางเพศสัมพันธ์ และ การตั้งครรภ์อันไม่พึงประสงค์\r\n    ประเมินความเสี่ยงต่อสุขภาพจากลักษณะงาน\r\n    อาการเตือนของโรคมะเร็ง\r\n    ประเมินความฉลาดทางอารมณ์ของบุคคล\r\n    กระเมินความเครียด ภาวะซึมเศร้า และความเสี่ยงต่อการฆ่าตัวตาย ประเมินโดยเจ้าหน้าที่\r\n    ชั่งน้ำหนัก วัดส่วนสูง ประเมินดัชนีมวลกาย\r\n    ประเมินอ้วนลงพุงโดยวัดเส้นรอบเอว\r\n    วัดความดันโลหิต\r\n    ตรวจสุขภาพช่องปาก\r\n    ตรวจคัดกรองมะเร็งช่องปาก\r\n    วัดสายตาด้วยแผนภูมิสเนลเลน ผู้ที่อายุ 50 ปี ขึ้นไป หรือ ผุ้ที่ขับขี่ยานพาหนะ หรือ ผู้ทีทำงาน ที่ต้องเพ่งสายตา\r\n    ประเมินภาวะสมองเสื่อม\r\n    ตรวจคลำเต้านม\r\n    อาการที่เกี่ยวเนื่องกับภาวะธัยรอยด์', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,3 เท่านั้น\r\n- ต้องมีการระบุ ค่าอย่างน้อย 6 หมวด ขึ้นไป ของการประเมิน    \r\n    - ความเครียด ซึมเศร้า\r\n    - หกล้ม อุบัติเหตุ\r\n    - ภาวะสมองเสื่อม\r\n    - ภาวะสายตา\r\n    - ภาวะช่องปาก\r\n    - ข้อเข่า\r\n- แนะนำให้ทำหมวดอื่นด้วย เพื่อความครบถ้วนของรายงาน HDC \r\n    - LTC\r\n    - ADL\r\n    - CVD\r\n    - BLADDER\r\n    - กลั้่นปัสสาวะ\r\n    - คัดกรองบุหรี่\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'701\';\r\nSET @activity_cost = \'100\';\r\nSET @2q = \'1b0280,1b0281\';\r\nSET @9q = \'1b0282,1b0283,1b0284,1b0285\';\r\nSET @st5 = \'1b0286,1b0287\';\r\nSET @8q = \'1b0270,1b0271,1b0272,1b0273\';\r\nSET @accident = \'1b1200,1b1201,1b1202\';\r\nSET @amt = \'1b1220,1b1221,1b1223\';\r\nSET @mmset2002 = \'1b1224,1b1225,1b1226\';\r\nSET @cvd = \'1b1230,1b1231,1b1232,1b1233,1b1234,1b1235\';\r\nSET @eye_min = \'1b1240,1b1241,1b1242\';\r\nSET @eye_max = \'1b1243,1b1244,1b1245\';\r\nSET @eye_mirror = \'1b1250,1b1251,1b1252\';\r\nSET @eye_stone = \'1b1253,1b1254,1b1255\';\r\nSET @eye_retina = \'1b1256,1b1257,1b1258\';\r\nSET @mouth = \'1b1260,1b1261\';\r\nSET @knee = \'1b1270,1b1271,1b1272\';\r\n-- set @ltc                 = \'1b1273,1b1274,1b1275\' ;\r\nSET @adl = \'1b1280,1b1281,1b1282\';\r\n-- set @blader         = \'1b1284,1b1285\' ;\r\nSET @smoke = \'1b501,1b502,1b503,1b504,1b505,1b506,1b51,1b52\';\r\nSET @breast = \'1b0030,1b0031,1b0032,1b0033,1b0034,1b0035,1b0036,1b0037\';\r\nSET @sumscore = 6;\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS char)      AS activity_code,\r\n             cast(@activity_cost AS char)      AS activity_cost,\r\n             cast(max(ovst.vstdate) AS char)   AS date_serv,\r\n             cast(@h_sub AS char)              AS h_sub,\r\n             ovst.hn,\r\n             cast(max(ovst.vn) AS char)        AS vn,\r\n             person.birthdate,\r\n             -- round(datediff(max(ovst.vstdate), person.birthdate) / 365.25)\r\n             TIMESTAMPDIFF(Year, person.birthdate, max(ovst.vstdate))\r\n                AS current_age,\r\n             -- metal group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @2q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 2q,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @9q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 9q,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @st5)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS st5,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @8q)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS 8q,\r\n             -- acident\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @accident)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS accident,\r\n             -- brain remember\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @amt)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS amt,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @mmset2002)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS mmset2002,\r\n             -- cvd\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @cvd)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS cvd,\r\n             -- eye group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_min)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_min,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_max)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_max,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_mirror)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_mirror,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_stone)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_stone,\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @eye_retina)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS eye_retina,\r\n             -- mouth\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @mouth)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS mouth,\r\n             -- knee\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @knee)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS knee,\r\n             -- ltc\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @ltc)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS ltc,\r\n             -- adl\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code, @adl)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS adl,\r\n             -- blader\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @blader)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS blader,\r\n             -- smoke\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @smoke)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS smoke,\r\n             -- cancer group\r\n             sum(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @breast)\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n                AS breast,\r\n             (                                                -- 1 metal group\r\n              ( CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @2q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @9q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @st5)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @8q)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                   -- 2 acident\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @accident)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                            -- 3 brain remember\r\n               (CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @amt)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @mmset2002)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                 -- 4 eye group\r\n               (CASE\r\n                   WHEN (  sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_min)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_max)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_mirror)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_stone)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                         + sum(\r\n                              CASE\r\n                                 WHEN find_in_set(\r\n                                         pp_special_type.pp_special_code,\r\n                                         @eye_retina)\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                     -- 5 mouth\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @mouth)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                      -- 6 knee\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @knee)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                       -- 7 ltc\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @ltc)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END)\r\n              +                                                    -- 8 blader\r\n               (CASE\r\n                   WHEN (sum(\r\n                            CASE\r\n                               WHEN find_in_set(\r\n                                       pp_special_type.pp_special_code,\r\n                                       @blader)\r\n                               THEN\r\n                                  1\r\n                               ELSE\r\n                                  0\r\n                            END)) >= 1\r\n                   THEN\r\n                      1\r\n                   ELSE\r\n                      0\r\n                END))\r\n                AS sum_score_in_case\r\n      FROM ovst\r\n           LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n           LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.nationality = 99\r\n            AND person.sex IN (1, 2)\r\n            AND (person.death <> \'y\'\r\n            AND person.discharge_date IS NULL) OR (person.death = \'y\' and person.discharge_date > ovst.vstdate )\r\n            AND person.house_regist_type_id IN (1, 3)\r\n      GROUP BY person.cid\r\n      HAVING     timestampdiff(year, person.birthdate, max(ovst.vstdate)) >=\r\n                    60\r\n             AND                                            -- start sum value\r\n                (                                             -- 1 metal group\r\n                 ( CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @2q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @9q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @st5)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @8q)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                -- 2 acident\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @accident)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                         -- 3 brain remember\r\n                  (CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @amt)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @mmset2002)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                              -- 4 eye group\r\n                  (CASE\r\n                      WHEN (  sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_min)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_max)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_mirror)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_stone)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)\r\n                            + sum(\r\n                                 CASE\r\n                                    WHEN find_in_set(\r\n                                            pp_special_type.pp_special_code,\r\n                                            @eye_retina)\r\n                                    THEN\r\n                                       1\r\n                                    ELSE\r\n                                       0\r\n                                 END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                  -- 5 mouth\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @mouth)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)\r\n                 +                                                   -- 6 knee\r\n                  (CASE\r\n                      WHEN (sum(\r\n                               CASE\r\n                                  WHEN find_in_set(\r\n                                          pp_special_type.pp_special_code,\r\n                                          @knee)\r\n                                  THEN\r\n                                     1\r\n                                  ELSE\r\n                                     0\r\n                               END)) >= 1\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END)                             -- เอาออก เพราะ hdc ไม่เอา\r\n                                                                          -- +\r\n                                                                   -- -- 7 ltc\r\n                                                                 -- (case when\r\n                                                                          -- (\r\n -- sum(case when find_in_set(pp_special_type.pp_special_code,@ltc) then 1 else 0 end)\r\n                                                  -- ) >= 1 then 1 else 0 end)\r\n\r\n                                                    -- เอาออก เพราะ hdc ไม่เอา\r\n                                                                          -- +\r\n                                                                -- -- 8 blader\r\n                                                                 -- (case when\r\n                                                                          -- (\r\n -- sum(case when find_in_set(pp_special_type.pp_special_code,@blader) then 1 else 0 end)\r\n                                                  -- ) >= 1 then 1 else 0 end)\r\n                                                                            --\r\n                 ) >= @sumscore\r\n      -- stop sum value\r\n\r\n      ORDER BY ovst.hn, ovst.vn) AS temp_701;', null, 'Fix Stable 2022-04-23 PBS 701', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('62', '702', 'ประเมินกิจวัตรประจำวัน ADL ตามคู่มือ 12 รายการ', '1', '20', '1', '1', '-', '-', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,3 เท่านั้น\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรอง ADL\r\n    1B1280 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวันพบว่าช่วยเหลือตัวเองได้ /ติดสังคม (ADL 12-20 คะแนน)\r\n    1B1281 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวันพบว่าช่วยเหลือตัวเองได้บ้าง / บางส่วน /ติดบ้าน (ADL 5-11 คะแนน)\r\n    1B1282 การตรวจคัดกรองสมรรถนะผู้สูงอายุเกี่ยวกับความสามารถในการทำกิจวัตรประจำวัน พบว่าช่วยเหลือตัวเองได้น้อย / ไม่ได้เลย /ภาวะติดเตียง (ADL 0-4 คะแนน)\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'702\';\r\nSET @activity_cost = \'20\';\r\nSET @ppset = \'1b1280,1b1281,1b1282\';\r\n\r\n-- update vn\r\n\r\nUPDATE pp_special\r\nSET pp_special.entry_datetime =\r\n       concat((concat(\'25\', left(pp_special.vn, 2)) - 543),\r\n              \'-\',\r\n              mid(pp_special.vn, 3, 2),\r\n              \'-\',\r\n              mid(pp_special.vn, 5, 2),\r\n              \' \',\r\n              time(pp_special.entry_datetime));\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n-- startrun\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM person\r\n     LEFT OUTER JOIN ovst ON person.patient_hn = ovst.hn\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n     LEFT OUTER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) >= 60\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND person.nationality = 99\r\n      AND (   (person.death <> \'y\' AND person.discharge_date IS NULL)\r\n      OR (person.death =  \'y\' AND person.death_date > ovst.vstdate) )\r\n      AND person.sex IN (1, 2)\r\n      AND find_in_set(pp_special_type.pp_special_code, @ppset)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 702', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('63', '703', 'คัดกรองปัจจัยเสี่ยงต่อการเกิดโรคหัวใจและหลอดเลือดสมอง Thai ASCVD Score', '1', '10', '1', '1', '-', '-', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- อายุ 60 ปีขึ้นไป\r\n- ประเภทประชากร Type Area 1,3 เท่านั้น\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การคัดกรอง ADL\r\n    1B1230 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่าไม่มีความเสี่ยง\r\n    1B1231 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยง\r\n    1B1232 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยงสูง\r\n    1B1234 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุ พบว่ามีความเสี่ยงสูงมาก ให้คำแนะนำ / รักษา\r\n    1B1235 การตรวจคัดกรองความเสี่ยงโรคหัวใจและหลอดเลือดสมองในผู้สูงอายุพบว่ามีความเสี่ยงสูงมาก รักษาต่อ\r\n- อยู่ระหว่างการศึกษาผลการดำเนินงาน ร่วมกับโปรแกรม Aging Health Data เพื่อนำข้อมูลมาจัดสรร', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'703\';\r\nSET @activity_cost = \'10\';\r\nSET @ppset = \'1b1230,1b1231,1b1232,1b1233,1b1234,1b1235\';\r\n\r\n-- update vn\r\n\r\nUPDATE pp_special\r\nSET pp_special.entry_datetime =\r\n       concat((concat(\'25\', left(pp_special.vn, 2)) - 543),\r\n              \'-\',\r\n              mid(pp_special.vn, 3, 2),\r\n              \'-\',\r\n              mid(pp_special.vn, 5, 2),\r\n              \' \',\r\n              time(pp_special.entry_datetime));\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n-- startrun\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)               AS activity_code,\r\n       cast(@activity_cost AS CHAR)               AS activity_cost,\r\n       max(date_format(ovst.vstdate, \'%Y-%m-%d\')) AS date_serv,\r\n       @h_sub                                     AS h_sub\r\nFROM person\r\n     LEFT OUTER JOIN ovst ON person.patient_hn = ovst.hn\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN pp_special ON ovst.vn = pp_special.vn\r\n     LEFT OUTER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) >= 60\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND person.nationality = 99\r\n      AND (   (person.death <> \'y\' AND person.discharge_date IS NULL)\r\n           OR person.death_date < ovst.vstdate)\r\n      AND person.sex IN (1, 2)\r\n      AND find_in_set(pp_special_type.pp_special_code, @ppset)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 703', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('64', '704', 'ตรวจความเข้มข้นของเม็ดเลือด HCT,HB ผู้ที่ BMI น้อยกว่า 18.5 อายุ 60 ปีขึ้นไป', '1', '30', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง', '-', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปี ขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ HB\r\n- ต้องมีผล ของ HCT\r\n- ต้องมี BMI น้อยกว่า 18.5', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'704\';\r\nSET @activity_cost = \'30\';\r\nSET @lab_name_hct =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621201\');\r\nSET @lab_name_hb =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0621401\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 60\r\n                                                                         AND 99\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) < 18.5\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hct) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hb) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 704', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('65', '705', 'LAB ตรวจวัดระดับโคเลสเตอรอลในเลือด ผู้ที่ BMI มากกว่า 25 อายุ 60 ปีขึ้นไป', '1', '60', '0', '1', 'ตรวจสอบย้อนหลัง 5 ปี/คน/ครั้ง', '-', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปีขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล ของ Cholesterol\r\n- ต้องมีผล ของ Triglyceride\r\n- ต้องมีผล ของ HDL\r\n- ต้องมีผล ของ LDL\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'705\';\r\nSET @activity_cost = \'60\';\r\nSET @lab_name_cho =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541602\');\r\nSET @lab_name_tri =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0546602\');\r\nSET @lab_name_hdl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541202\');\r\nSET @lab_name_ldl =\r\n       (SELECT lab_items_name\r\n        FROM lab_items\r\n        WHERE provis_labcode = \'0541402\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) BETWEEN 60\r\n                                                                         AND 99\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\n      AND round(opdscreen.bw / power((opdscreen.height / 100), 2), 2) > 25\r\nGROUP BY person.cid\r\nHAVING     SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_cho) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_tri) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_hdl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\n       AND SUM(\r\n              CASE\r\n                 WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                                  @lab_name_ldl) >= 1\r\n                 THEN\r\n                    1\r\n                 ELSE\r\n                    0\r\n              END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 705', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('66', '706', 'LAB ตรวจ Fasting Plasma Glucose ผู้ที่ BMI มากกว่า 25 อายุ 60 ปีขึ้นไป', '1', '40', '0', '1', 'ตรวจสอบย้อนหลัง 3 ปี/คน/ครั้ง หรือผู้ที่ประวัติญาติสายตรงเป็น DM หรือ ผู้ที่เคยตรวจพบความทนต่อกลูโคสผิดปกติ หรือ เคยตรวจพบระดับกลูโคสพลาสมาผิดปกติ', '-', '09 ผู้สูงอายุ(อายุ 60 ปีขึ้นไป)', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 60 ปีขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล Glucose\r\n- ต้องมี BMI มากกว่า  25', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nset @h_sub = (select  hospitalcode from opdconfig);\r\nset @activity_code = \'706\';\r\nset @activity_cost = \'40\';\r\nset @lab_name_fbs = (select lab_items_name from lab_items where provis_labcode = \'0531002\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\nSELECT\r\n    person.cid,\r\n    person.pname,\r\n    person.fname,\r\n    person.lname,\r\n    cast(@activity_code AS CHAR) AS activity_code,\r\n    cast(@activity_cost AS CHAR) AS activity_cost,\r\n    cast(lab_head.order_date AS CHAR) AS date_serv,\r\n    cast(@h_sub AS CHAR) AS h_sub\r\nFROM\r\n    lab_order\r\nINNER JOIN lab_head ON lab_order.lab_order_number = lab_head.lab_order_number\r\nINNER JOIN person ON lab_head.hn = person.patient_hn\r\nINNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE\r\n    lab_head.order_date BETWEEN @start_date\r\nAND @stop_date\r\nAND timestampdiff(\r\n    YEAR,\r\n    person.birthdate,\r\n    lab_head.order_date\r\n) BETWEEN 60\r\nAND 99\r\nAND lab_order.lab_order_result IS NOT NULL\r\nAND person.sex IN (1, 2)\r\nAND person.nationality = 99\r\nAND person.discharge_date IS NULL\r\nAND person.death <> \'y\'\r\nAND round(\r\n    opdscreen.bw / power((opdscreen.height / 100), 2),\r\n    2\r\n) > 25\r\nGROUP BY\r\n    person.cid\r\nHAVING\r\n    SUM(\r\n        CASE\r\n        WHEN find_in_set(\r\n            lab_order.lab_items_name_ref ,@lab_name_fbs\r\n        ) >= 1 THEN\r\n            1\r\n        ELSE\r\n            0\r\n        END\r\n    ) >= 1\r\nORDER BY\r\n    lab_head.order_date,\r\n    person.cid;', null, 'Fix Stable 2022-04-23 PBS 706', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('67', '801', 'Confirm screening การคัดกรองความเสี่ยงต่อการเกิดโรค Metabolic,DM ,HTอายุ 35 ปีขึ้นไป', '1', '50', '1', '1', 'เบิกจากกองทุนท้องถิ่น หรือ PPB งบใดงบหนึ่ง', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,3 เท่านั้น เพื่อตรงกลุ่มเป้าหมายที่รับผิดชอบ และ ไม่เกิดความซ้ำซ้อนระหว่างหน่วยบริการอื่นๆ\r\n- ต้องไม่เป็นผู้ป่วยโรคเบาหวาน และ ความดันโลหิตสูงมาแล้ว โดยตรวจสอบจาก บัญชี1,คลินิกพิเศษโรคเรื้อรัง,รหัสการวินิจฉัยของการให้บริการ\r\n- อายุตามเงื่อนไข 35 ปี ขึ้นไป\r\n- ใช้เกณฑ์ความเสี่ยง สำนักโรคไม่ติดต่อ เพื่อทำการ Confirm \r\n    - มีระดับ BMS มากกว่า 25\r\n    - มีระดับ BPS ตั้งแต่ 140 ขึ้นไป หรือ BPD ตั้งแต่ 90 ขึ้นไป\r\n    - เพศชาย ที่มีรอบเอวมากกว่า 90 หรือ เพศหญิงที่มีรอบเอวมากกว่า 80\r\n    - มีประวัติครอบครัวเป็นโรคเบาหวาน\r\n    - มีประวัติการตั้งท้อง น้ำหนักแรกคลอดมากกว่า 4000 กรัม\r\n    - มีประวัติ ไขมันในเส้นเลือด', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'801\';\r\nSET @activity_cost = \'50\';\r\nSET @bdg_year = \'2565\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS char) AS activity_code,\r\n       cast(@activity_cost AS char) AS activity_cost,\r\n       date_format(\r\n          min(date(person_dmht_screen_summary.last_screen_datetime)),\r\n          \'%Y-%m-%d\')\r\n          AS date_serv,\r\n       @h_sub                       AS h_sub\r\nFROM person_dmht_risk_screen_head\r\n     INNER JOIN person_dmht_nhso_screen\r\n        ON person_dmht_risk_screen_head.person_dmht_screen_summary_id =\r\n              person_dmht_nhso_screen.person_dmht_screen_summary_id\r\n     INNER JOIN person_dmht_screen_summary\r\n        ON person_dmht_risk_screen_head.person_dmht_screen_summary_id =\r\n              person_dmht_screen_summary.person_dmht_screen_summary_id\r\n     INNER JOIN person\r\n        ON person_dmht_screen_summary.person_id = person.person_id\r\nWHERE     person_dmht_screen_summary.last_screen_datetime BETWEEN @start_date\r\n                                                              AND @stop_date\r\n      AND person_dmht_nhso_screen.present_drinking_alcohol IS NOT NULL\r\n      AND person_dmht_nhso_screen.present_smoking IS NOT NULL\r\n      AND person_dmht_risk_screen_head.body_height IS NOT NULL\r\n      AND person_dmht_risk_screen_head.body_weight IS NOT NULL\r\n      AND person_dmht_risk_screen_head.waist IS NOT NULL\r\n      AND person_dmht_risk_screen_head.last_bps IS NOT NULL\r\n      AND person_dmht_risk_screen_head.last_bpd IS NOT NULL\r\n      AND timestampdiff(year,\r\n                        person.birthdate,\r\n                        person_dmht_screen_summary.last_screen_datetime) >=\r\n             35\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND person.sex IN (1, 2)\r\n      AND person.death <> \'y\'\r\n      AND person.death_date IS NULL\r\n      AND person.nationality = 99\r\n      AND person_dmht_screen_summary.bdg_year = @bdg_year\r\n      AND (   person_dmht_risk_screen_head.bmi >= 25\r\n           OR person_dmht_risk_screen_head.last_bps >= 140\r\n           OR person_dmht_risk_screen_head.last_bpd >= 90\r\n           OR person_dmht_risk_screen_head.last_fgc >= 140\r\n           OR person_dmht_risk_screen_head.last_fpg >= 140\r\n           OR person_dmht_risk_screen_head.last_fgc_no_food_limit >= 140\r\n           OR (person.sex = 1 AND person_dmht_risk_screen_head.waist >= 90)\r\n           OR (person.sex = 2 AND person_dmht_risk_screen_head.waist >= 80)\r\n           OR person_dmht_nhso_screen.family_parent_dm_disease = \'y\'\r\n           OR person_dmht_nhso_screen.family_relate_dm_disease = \'y\'\r\n           OR person_dmht_nhso_screen.history_deliver_over_4kg = \'y\'\r\n           OR person_dmht_nhso_screen.history_lipid_disease = \'y\')\r\n      AND person.cid NOT IN\r\n             (SELECT cid\r\n              FROM (-- person_chronic\r\n                    SELECT cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN left(person_chronic.icd10, 3) BETWEEN \'e10\'\r\n                                                                        AND \'e14\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN left(person_chronic.icd10, 3) BETWEEN \'i10\'\r\n                                                                        AND \'i15\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN person_chronic\r\n                            ON person.person_id =\r\n                                  person_chronic.person_id\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN left(person_chronic.icd10, 3) BETWEEN \'e10\'\r\n                                                                            AND \'e14\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN left(person_chronic.icd10, 3) BETWEEN \'i10\'\r\n                                                                            AND \'i15\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(person.cid) = 13\r\n                    UNION ALL\r\n                    -- clinicmember\r\n                    SELECT person.cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN clinicmember.clinic = \'001\' THEN 1\r\n                                 ELSE 0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN clinicmember.clinic = \'002\' THEN 1\r\n                                 ELSE 0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN clinicmember\r\n                            ON person.patient_hn = clinicmember.hn\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN clinicmember.clinic = \'001\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN clinicmember.clinic = \'002\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(person.cid) = 13\r\n                    UNION ALL\r\n                    -- ovstdiag\r\n                    SELECT person.cid,\r\n                           max(\r\n                              CASE\r\n                                 WHEN left(ovstdiag.icd10, 3) BETWEEN \'e10\'\r\n                                                                  AND \'e14\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS dm,\r\n                           max(\r\n                              CASE\r\n                                 WHEN left(ovstdiag.icd10, 3) BETWEEN \'i10\'\r\n                                                                  AND \'i15\'\r\n                                 THEN\r\n                                    1\r\n                                 ELSE\r\n                                    0\r\n                              END)\r\n                              AS ht\r\n                    FROM person\r\n                         LEFT OUTER JOIN ovstdiag\r\n                            ON person.patient_hn = ovstdiag.hn\r\n                    GROUP BY person.cid\r\n                    HAVING     max(\r\n                                  CASE\r\n                                     WHEN left(ovstdiag.icd10, 3) BETWEEN \'e10\'\r\n                                                                      AND \'e14\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND max(\r\n                                  CASE\r\n                                     WHEN left(ovstdiag.icd10, 3) BETWEEN \'i10\'\r\n                                                                      AND \'i15\'\r\n                                     THEN\r\n                                        1\r\n                                     ELSE\r\n                                        0\r\n                                  END) = 1\r\n                           AND length(person.cid) = 13) AS all_chronic\r\n              GROUP BY all_chronic.cid)\r\nGROUP BY person.cid;', null, 'Fix Stable 2022-04-23 PBS 801', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('68', '802', 'ประเมินคัดกรองเพื่อค้นหาผู้ป่วยมะเร็งลำไส้ใหญ่ และ ส่งตรวจอุจจาระ อายุ 50 ปีขึ้นไป', '1', '30', '1', '1', '-', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- อายุ ตั้งแต่ 50 ปีขึ้นไป\r\n- ต้องมีการระบุรหัสวินิจฉัย\r\n    Z121 Special screening examination for neoplasm of intestinal tract\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม การตรวจมะเร็งลำไส้\r\n    1B0060 ตรวจคัดกรองความเสี่ยง โรคมะเร็งลำไส้ ได้ผลลบ\r\n    1B0061 ตรวจคัดกรองความเสี่ยง โรคมะเร็งลำไส้ ได้ผลบวก\r\n* ระบบ สปสช มีการตรวจสอบเพิ่มเติม หากมีการบันทึกด้วยรหัส 1B0061 ตรวจคัดกรองความเสี่ยง โรคมะเร็งลำไส้ ได้ผลบวก กับกิจกรรม การส่องกล้องตรวจลำไส้ใหญ่ (colonoscopy)', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'802\';\r\nSET @activity_cost = \'30\';\r\nSET @icd10set = (\'z121\');\r\nSET @ppset = \'1b0060,1b0061\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM (SELECT person.cid,\r\n             person.pname,\r\n             person.fname,\r\n             person.lname,\r\n             cast(@activity_code AS CHAR)                 AS activity_code,\r\n             cast(@activity_cost AS CHAR)                 AS activity_cost,\r\n             max(date_format(ovst.vstdate, \'%Y-%m-%d\'))   AS date_serv,\r\n             @h_sub                                       AS h_sub,\r\n             IF(sum(\r\n                   CASE\r\n                      WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                       @ppset)\r\n                      THEN\r\n                         1\r\n                      ELSE\r\n                         0\r\n                   END) >= 1,\r\n                \'y\',\r\n                \'n\')\r\n                AS screen_brest,\r\n             max(\r\n                CASE\r\n                   WHEN find_in_set(pp_special_type.pp_special_code,\r\n                                    @ppset)\r\n                   THEN\r\n                      pp_special_type_name\r\n                   ELSE\r\n                      NULL\r\n                END)\r\n                AS screen_brest_result,\r\n             timestampdiff(YEAR, person.birthdate, ovst.vstdate)\r\n                AS current_age,\r\n             village.village_moo,\r\n             village.village_name\r\n      FROM ovst\r\n           INNER JOIN pp_special ON ovst.vn = pp_special.vn\r\n           INNER JOIN pp_special_type\r\n              ON pp_special.pp_special_type_id =\r\n                    pp_special_type.pp_special_type_id\r\n           INNER JOIN person ON ovst.hn = person.patient_hn\r\n           INNER JOIN ovstdiag ON ovst.vn = ovstdiag.vn\r\n           INNER JOIN village ON person.village_id = village.village_id\r\n      WHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n            AND person.sex IN (1, 2)\r\n            AND person.nationality = 99\r\n            AND person.house_regist_type_id IN (1,\r\n                                                3,\r\n                                                2,\r\n                                                4)\r\n            AND person.death <> \'y\'\r\n            AND person.death_date IS NULL\r\n            AND timestampdiff(YEAR, person.birthdate, ovst.vstdate) >= 50\r\n      GROUP BY person.cid\r\n      HAVING     (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(\r\n                                   pp_special_type.pp_special_code,\r\n                                   @ppset)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n             AND (IF(sum(\r\n                        CASE\r\n                           WHEN find_in_set(LEFT(ovstdiag.icd10, 4),\r\n                                            @icd10set)\r\n                           THEN\r\n                              1\r\n                           ELSE\r\n                              0\r\n                        END) >= 1,\r\n                     1,\r\n                     0)) >= 1\r\n      ORDER BY ovst.vstdate, person.cid) AS temp_802\r\nGROUP BY temp_802.cid\r\nORDER BY temp_802.date_serv;', null, 'Fix Stable 2022-04-23 PBS 802', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('69', '803', 'ตรวจอุจจาระมะเร็งลำไส้ใหญ่ อายุ 50 ปีขึ้นไป', '1', '35', '0', '1', '-', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- สามารถเปลี่ยนชื่อ LAB อุจจาระได้ที่ set @lab_name_stool := \'lab_stool_name\';\r\n- การคำนวนอายุจะใช้ Function พื้นฐานของ MySQL เพื่อหาจำนวนเดือนของการให้บริการโดยคำนวนจาก วันเกิด และ วันที่บริการ  (timestampdiff(month,person.birthdate,lab_head.order_date)\r\n- คำสั่งจะเลือกเฉพาะบริการที่ ตรงกับ จำนวนปี 50 ปีขึ้นไป เท่านั้น เพื่อไม่ให้ซ้ำกับกับกิจกรรมรหัสอื่น\r\n- ต้องมีผล การตรวจอุจจาระ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'803\';\r\nSET @activity_cost = \'35\';\r\nSET @lab_name_stool = \'lab_stool_name\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND timestampdiff(YEAR, person.birthdate, lab_head.order_date) >= 50\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1,\r\n                         2,\r\n                         3,\r\n                         4)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                              @lab_name_stool) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 803', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('70', '804', 'คัดกรองภาวะซึมเศร้า 2Q', '1', '10', '1', '1', 'รวบรวมมาจาก การคัดกรองซักประวัติ One Stop Service ของระบบ HIS Hosxp\r\nในระบบ HDC รายงานยังไม่ครอบคลุมของทุกกลุ่มอายุ', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,3 เท่านั้น เพื่อตรงกลุ่มเป้าหมายที่รับผิดชอบ และ ไม่เกิดความซ้ำซ้อนระหว่างหน่วยบริการอื่นๆ\r\n- ต้องมีการซักประวัติ 2Q \r\n- ต้องมีการระบุรหัสวินิจฉัย\r\n    Z133 Special screening examination for mental and behavioural disorders\r\n', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'804\';\r\nSET @activity_cost = \'10\';\r\nSET @diag_code = \'z133\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)   AS activity_code,\r\n       cast(@activity_cost AS CHAR)   AS activity_cost,\r\n       cast(ovstdiag.vstdate AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)           AS h_sub\r\nFROM ovstdiag\r\n     INNER JOIN person ON ovstdiag.hn = person.patient_hn\r\n     INNER JOIN depression_screen ON ovstdiag.vn = depression_screen.vn\r\nWHERE     ovstdiag.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @diag_code\r\n      AND person.nationality = 99\r\nAND ((person.death <> \'y\'\r\nAND person.discharge_date IS NULL) OR (person.death = \'y\' AND person.discharge_date > ovstdiag.vstdate))\r\nAND person.house_regist_type_id IN (1, 3)\r\nAND (   depression_screen.feel_boring_2_week IN (\'y\', \'n\')\r\n           OR depression_screen.feel_depression_2_week IN (\'y\', \'n\')\r\n           OR depression_screen.no_depression IN (\'y\', \'n\'))\r\n\r\nGROUP BY person.cid\r\nORDER BY ovstdiag.vstdate, person.cid;', null, 'Fix Stable 2022-04-23 PBS 804', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('71', '805', 'คัดกรองภาวะซึมเศร้า 9Q,8Q', '1', '20', '1', '1', 'จะต้องได้รับการคัดกรอง 2Q และมีปัจจัยเสี่ยงอย่างน้อย 1 ข้อ ขึ้นไปร่วมด้วย\r\nรวบรวมมาจาก การคัดกรองซักประวัติ One Stop Service ของระบบ HIS Hosxp\r\nในระบบ HDC รายงานยังไม่ครอบคลุมของทุกกลุ่มอายุ', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- ต้องเป็น Type Area 1,3 เท่านั้น เพื่อตรงกลุ่มเป้าหมายที่รับผิดชอบ และ ไม่เกิดความซ้ำซ้อนระหว่างหน่วยบริการอื่นๆ\r\n- ต้องมีการซักประวัติ 2Q \r\n- ต้องมีการระบุรหัสวินิจฉัย\r\n    Z133 Special screening examination for mental and behavioural disorders\r\n- ต้องมีการระบรหัส PP SPECIAL อย่างน้อย 1 รหัส ที่เป็นกิจกรรม 9Q8Q\r\n    1B0260 การประเมินภาวะซึมเศร้าด้วยแบบประเมิน 9Q พบว่าผลปกติ \r\n    1B0261 การประเมินภาวะซึมเศร้าด้วยแบบประเมิน 9Q พบว่าซึมเศร้าน้อย (คะแนน 7-12)\r\n    1B0262 การประเมินภาวะซึมเศร้าด้วยแบบประเมิน 9Q พบว่าซึมเศร้าปานกลาง (คะแนน 13-18)\r\n    1B0263 การประเมินภาวะซึมเศร้าด้วยแบบประเมิน 9Q พบว่าซึมเศร้ารุนแรง (คะแนน>=19)\r\n    1B0270 การประเมินการฆ่าตัวตายด้วยแบบประเมิน 8Q พบว่าไม่มีแนวโน้มการฆ่าตัวตาย \r\n    1B0271 การประเมินการฆ่าตัวตายด้วยแบบประเมิน 8Q พบว่ามีแนวโน้มที่จะฆ่าตัวตายระดับน้อย (คะแนน 1-8) \r\n    1B0272 การประเมินการฆ่าตัวตายด้วยแบบประเมิน 8Q พบว่ามีแนวโน้มที่จะฆ่าตัวตายระดับปานกลาง (คะแนน 9-16)\r\n    1B0273 การประเมินการฆ่าตัวตายด้วยแบบประเมิน 8Q พบว่ามีแนวโน้มที่จะฆ่าตัวตายระดับรุนแรง (คะแนน >=17)\r\n    1B0282 การตรวจคัดกรองโรคซึมเศร้าในผู้สูงอายุด้วยแบบคัดกรอง 9Q พบว่าผลปกติ\r\n    1B0283 การตรวจคัดกรองโรคซึมเศร้าในผู้สูงอายุด้วยแบบคัดกรอง 9Q พบว่าซึมเศร้าน้อย (คะแนน 7-12)\r\n    1B0284 การตรวจคัดกรองโรคซึมเศร้าในผู้สูงอายุด้วยแบบคัดกรอง 9Q พบว่าซึมเศร้าปานกลาง (คะแนน 13-18)\r\n    1B0285 การตรวจคัดกรองโรคซึมเศร้าในผู้สูงอายุด้วยแบบคัดกรอง 9Q พบว่าซึมเศร้ารุนแรง (คะแนน >=19)', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'805\';\r\nSET @activity_cost = \'20\';\r\nSET @diag_code = \'z133\';\r\nSET @ppset =\r\n       \'1b0260,1b0261,1b0262,1b0263,1b0282,1b0283,1b0284,1b0285,1b0270,1b0271,1b0272,1b0273\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)   AS activity_code,\r\n       cast(@activity_cost AS CHAR)   AS activity_cost,\r\n       cast(ovstdiag.vstdate AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)           AS h_sub\r\nFROM ovstdiag\r\n     INNER JOIN person ON ovstdiag.hn = person.patient_hn\r\n     INNER JOIN depression_screen ON ovstdiag.vn = depression_screen.vn\r\n     INNER JOIN pp_special ON ovstdiag.vn = pp_special.vn\r\n     INNER JOIN pp_special_type\r\n        ON pp_special.pp_special_type_id =\r\n              pp_special_type.pp_special_type_id\r\nWHERE     ovstdiag.vstdate BETWEEN @start_date AND @stop_date\r\n      AND ovstdiag.icd10 = @diag_code\r\n      AND person.nationality = 99\r\n      AND person.death <> \'y\'\r\n      AND person.discharge_date IS NULL\r\n      AND person.house_regist_type_id IN (1, 3)\r\n      AND (   depression_screen.feel_boring_2_week IN (\'y\', \'n\')\r\n           OR depression_screen.feel_depression_2_week IN (\'y\', \'n\'))\r\n      AND person.death_date IS NULL\r\nGROUP BY person.cid\r\nHAVING sum(\r\n          CASE\r\n             WHEN find_in_set(pp_special_type.pp_special_code, @ppset)\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY ovstdiag.vstdate, person.cid;', null, 'Fix Stable 2022-04-23 PBS 805', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('72', '806', 'การเยี่ยมบ้าน HOME HEALTH CARE ไม่มีหัตถการ หน่วยบริการ กำหนดเอง', '12', '50', '1', '1', '- ไม่ซ้ำซ้อนกับการชดเชย ในกลุ่ม อปท. หรือ ที่มีการจัดให้อยู่แล้ว\r\n- เยี่ยมตามเกณฑ์ FCT มีใบส่งตัวจากโรงพยาบาล', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- บันทึกในระบบ One Stop service\r\n- ใส่ รหัส 806 เมื่อเริ่มข้อความในระบบ CC\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1A11 เยี่ยมผู้ป่วยที่มีใบติดตามจากโรงพยาบาล\r\n    1A12 เยี่ยมผู้ป่วยที่ต้องการดูแลอย่างต่อเนื่องจากโรงพยาบาล\r\n    1A14 เยี่ยมผู้ป่วยหลังจากรับ/ส่งต่อ (refer) จากโรงพยาบาล\r\n    1A18 เยี่ยมผู้ป่วยหลังได้รับการรักษาอื่นๆ\r\n - หน่วยบริการ เป็นผู้กำหนด กิจกรรมเอง ว่าเป็นแบบ มีหัตถการ หรือ ไม่มีหัตถการโดยดูกิจกรรมที่ให้บริการ บริบท ต่างๆ ประกอบ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'806\';\r\nSET @activity_cost = \'50\';\r\nSET @commuset = \'1a11,1a12,1a14,1a18\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS char) AS activity_code,\r\n       cast(@activity_cost AS char) AS activity_cost,\r\n       cast(ovst.vstdate AS char)   AS date_serv,\r\n       cast(@h_sub AS char)         AS h_sub\r\n-- ,\r\n--     opdscreen.cc,\r\n--     group_concat(distinct er_oper_code. name) as proced,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_code\r\n--     ) as commu_code,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_name\r\n--     ) as commu_name\r\nFROM ovst\r\n     LEFT OUTER JOIN ovst_community_service\r\n        ON ovst.vn = ovst_community_service.vn\r\n     LEFT OUTER JOIN ovst_community_service_type\r\n        ON ovst_community_service.ovst_community_service_type_id =\r\n              ovst_community_service_type.ovst_community_service_type_id\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN doctor_operation ON ovst.vn = doctor_operation.vn\r\n     LEFT OUTER JOIN er_oper_code\r\n        ON doctor_operation.er_oper_code = er_oper_code.er_oper_code\r\n     LEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND LEFT(Trim(opdscreen.cc), 3) = @activity_code\r\nGROUP BY ovst.hn, ovst.vstdate\r\nHAVING sum(\r\n          CASE\r\n             WHEN find_in_set(\r\n                     ovst_community_service_type.ovst_community_service_type_code,\r\n                     @commuset) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY ovst.hn, ovst.vstdate;', null, 'Fix Stable 2022-04-23 PBS 806', 'InforReportable', '2022-04-24', '1', '999999', '20', '84');
INSERT INTO `pbs_items` VALUES ('73', '807', 'การเยี่ยมบ้าน HOME HEALTH CARE มีหัตถการ  หน่วยบริการ กำหนดเอง', '240', '100', '1', '1', '- ไม่ซ้ำซ้อนกับการชดเชย ในกลุ่ม อปท. หรือ ที่มีการจัดให้อยู่แล้ว\r\n- เยี่ยมตามเกณฑ์ FCT มีใบส่งตัวจากโรงพยาบาล', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- บันทึกในระบบ One Stop service\r\n- ใส่ รหัส 807 เมื่อเริ่มข้อความในระบบ CC\r\n- แนะนำให้ มีการบันทึก  Community Service ร่วมด้วย \r\n    1A11 เยี่ยมผู้ป่วยที่มีใบติดตามจากโรงพยาบาล\r\n    1A12 เยี่ยมผู้ป่วยที่ต้องการดูแลอย่างต่อเนื่องจากโรงพยาบาล\r\n    1A14 เยี่ยมผู้ป่วยหลังจากรับ/ส่งต่อ (refer) จากโรงพยาบาล\r\n    1A18 เยี่ยมผู้ป่วยหลังได้รับการรักษาอื่นๆ\r\n - หน่วยบริการ เป็นผู้กำหนด กิจกรรมเอง ว่าเป็นแบบ มีหัตถการ หรือ ไม่มีหัตถการโดยดูกิจกรรมที่ให้บริการ บริบท ต่างๆ ประกอบ', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'807\';\r\nSET @activity_cost = \'100\';\r\nSET @commuset = \'1a11,1a12,1a14,1a18\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS char) AS activity_code,\r\n       cast(@activity_cost AS char) AS activity_cost,\r\n       cast(ovst.vstdate AS char)   AS date_serv,\r\n       cast(@h_sub AS char)         AS h_sub\r\n-- ,\r\n--     opdscreen.cc,\r\n--     group_concat(distinct er_oper_code. name) as proced,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_code\r\n--     ) as commu_code,\r\n--     group_concat(\r\n--         distinct ovst_community_service_type.ovst_community_service_type_name\r\n--     ) as commu_name\r\nFROM ovst\r\n     LEFT OUTER JOIN ovst_community_service\r\n        ON ovst.vn = ovst_community_service.vn\r\n     LEFT OUTER JOIN ovst_community_service_type\r\n        ON ovst_community_service.ovst_community_service_type_id =\r\n              ovst_community_service_type.ovst_community_service_type_id\r\n     LEFT OUTER JOIN opdscreen ON ovst.vn = opdscreen.vn\r\n     LEFT OUTER JOIN doctor_operation ON ovst.vn = doctor_operation.vn\r\n     LEFT OUTER JOIN er_oper_code\r\n        ON doctor_operation.er_oper_code = er_oper_code.er_oper_code\r\n     LEFT OUTER JOIN person ON ovst.hn = person.patient_hn\r\nWHERE     ovst.vstdate BETWEEN @start_date AND @stop_date\r\n      AND LEFT(Trim(opdscreen.cc), 3) = @activity_code\r\nGROUP BY ovst.hn, ovst.vstdate\r\nHAVING sum(\r\n          CASE\r\n             WHEN find_in_set(\r\n                     ovst_community_service_type.ovst_community_service_type_code,\r\n                     @commuset) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY ovst.hn, ovst.vstdate;', null, 'Fix Stable 2022-04-23 PBS 807', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('74', '808', 'ไม่สามารถเบิกได้ ปี 2565 กิจกรรมการค้นหาผู้ป่วยวัณโรคโดยใช้ Verbal Screening', '0', '0', '0', '0', 'เงิ่อนไขซ้ำซ้อนกับการบันทึกข้อมูลเบิกเงิน จาก สปสช. และ ยังไม่มีการชีแจงรายละเอียดกิจกรรม ในระบบการบันทึกข้อมูล HIS', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 808', 'InforReportable', '2022-04-24', '0', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('75', '809', 'LAB ตรวจชันสูตรทางห้องปฏิบัติการพื้นฐาน Sputum Exam For AFB', '3', '20', '0', '1', 'เบิกจากแม่ข่าย เฉพาะ ในกรณีที่ไม่ได้เบิกจาก สปสช(ทั้งนี้ ยังต้องบันทึกเข้าโปรแกรม TB DATA HUB ตามปกติ)', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- สามารถเปลี่ยนชื่อ LAB อุจจาระได้ที่ set @lab_name_afb := \'AFB\';\r\n- ต้องมีผล AFB', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'809\';\r\nSET @activity_cost = \'20\';\r\nSET @lab_name_afb = \'AFB\';\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT person.cid,\r\n       person.pname,\r\n       person.fname,\r\n       person.lname,\r\n       cast(@activity_code AS CHAR)      AS activity_code,\r\n       cast(@activity_cost AS CHAR)      AS activity_cost,\r\n       cast(lab_head.order_date AS CHAR) AS date_serv,\r\n       cast(@h_sub AS CHAR)              AS h_sub\r\nFROM lab_order\r\n     INNER JOIN lab_head\r\n        ON lab_order.lab_order_number = lab_head.lab_order_number\r\n     INNER JOIN person ON lab_head.hn = person.patient_hn\r\n     INNER JOIN opdscreen ON lab_head.vn = opdscreen.vn\r\nWHERE     lab_head.order_date BETWEEN @start_date AND @stop_date\r\n      AND lab_order.lab_order_result IS NOT NULL\r\n      AND person.sex IN (1, 2)\r\n      AND person.nationality = 99\r\n      AND person.discharge_date IS NULL\r\n      AND person.death <> \'y\'\r\nGROUP BY person.cid\r\nHAVING SUM(\r\n          CASE\r\n             WHEN find_in_set(lab_order.lab_items_name_ref,\r\n                              @lab_name_stool) >= 1\r\n             THEN\r\n                1\r\n             ELSE\r\n                0\r\n          END) >= 1\r\nORDER BY lab_head.order_date, person.cid;', null, 'Fix Stable 2022-04-23 PBS 809', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('76', '810', 'การ X-Ray ปอด', '1', '100', '0', '1', 'เบิกจากแม่ข่าย เฉพาะ ในกรณีที่ไม่ได้เบิกจาก สปสช(ทั้งนี้ ยังต้องบันทึกเข้าโปรแกรม TB DATA HUB ตามปกติ)', '-', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', '- สามารถเปลี่ยนช่วงวันที่ได้ที่\r\n    SET @start_date = date(\'2021-10-01\');\r\n    SET @stop_date = date(\'2022-03-31\');\r\n- คำสั่งจะทำการค้นหารายการจาก \"ชื่อ\" ยา และ เวชภัณฑ์ ที่ไม่ใช่ยา ทั้งหมด ที่ตรงกับเงื่อนไข\r\n- สามารถเปลี่ยนชื่อรายการ    set @paraname = concat(\'ชื่อยาหรือรายการที่ต้องการ\');', 'SET @start_date = date(\'2021-10-01\');\r\nSET @stop_date = date(\'2022-03-31\');\r\nSET @h_sub = (SELECT hospitalcode FROM opdconfig);\r\nSET @activity_code = \'810\';\r\nSET @activity_cost = \'100\';\r\nSET @paraname = concat(\'ชื่อยาหรือรายการxray\');\r\n\r\n-- <process> INSERT IGNORE INTO pbs_items_list (cid,pname,fname,lname,activity_code,activity_cost,date_serv,h_sub)\r\n\r\nSELECT cid,\r\n       pname,\r\n       fname,\r\n       lname,\r\n       activity_code,\r\n       activity_cost,\r\n       date_serv,\r\n       h_sub\r\nFROM ((SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              nondrugitems.icode,\r\n              nondrugitems.NAME                             AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN nondrugitems\r\n               ON opitemrece.icode = nondrugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex IN (1, 2)\r\n             AND find_in_set(nondrugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vstdate\r\n       ORDER BY opitemrece.vstdate)\r\n      UNION ALL\r\n      (SELECT person.cid,\r\n              person.pname,\r\n              person.fname,\r\n              person.lname,\r\n              cast(@activity_code AS CHAR)                  AS activity_code,\r\n              cast(@activity_cost AS CHAR)                  AS activity_cost,\r\n              date_format(opitemrece.vstdate, \'%Y-%m-%d\')   AS date_serv,\r\n              @h_sub                                        AS h_sub,\r\n              village.village_moo,\r\n              village.village_name,\r\n              house.address,\r\n              house.road,\r\n              drugitems.icode,\r\n              drugitems.NAME                                AS paraname,\r\n              ovstdiag.icd10                                AS diagcode\r\n       FROM opitemrece\r\n            INNER JOIN person ON opitemrece.hn = person.patient_hn\r\n            LEFT OUTER JOIN village\r\n               ON person.village_id = village.village_id\r\n            LEFT OUTER JOIN house ON person.house_id = house.house_id\r\n            INNER JOIN drugitems ON opitemrece.icode = drugitems.icode\r\n            INNER JOIN ovstdiag ON opitemrece.vn = ovstdiag.vn\r\n       WHERE     person.sex IN (1, 2)\r\n             AND find_in_set(drugitems.NAME, @paraname)\r\n             AND opitemrece.vstdate BETWEEN @start_date AND @stop_date\r\n             AND person.death <> \'y\'\r\n             AND person.death_date IS NULL\r\n             AND person.nationality = 99\r\n       GROUP BY person.cid, opitemrece.vn\r\n       ORDER BY opitemrece.vstdate)) AS temp_810;', null, 'Fix Stable 2022-04-23 PBS 810', 'InforReportable', '2022-04-24', '1', '999999', '0', '84');
INSERT INTO `pbs_items` VALUES ('82', '111', 'ไม่สามารถเบิกได้ ปี 2565 PapSmear หญิงหลังคลอด', '1', '150', '0', '0', 'สามารถ 621 Pap Smear นอกกลุ่มเป้าหมาย เพียงอย่างเดียว เพี่อตัดความซ้ำซ้อน', null, '02 หญิงหลังคลอด', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม', null, null, null, 'Fix Stable 2022-04-23 PBS 111', 'InforReportable', '2022-04-24', '0', null, null, null);
INSERT INTO `pbs_items` VALUES ('80', '811', 'การติดตามกลุ่มสงสัยป่วยโรคเบาหวาน ในกลุ่มอายุ 35 ปีขึ้นไป', '1', '50', '1', '1', 'ประมวลผลจากระบบ HDC\r\n1.3. ร้อยละของประชากรกลุ่มเสี่ยงเบาหวานในพื้นที่รับผิดชอบของปีที่ผ่านมาได้รับการตรวจน้ำตาลซ้ำ', 'กลุ่มรายงานมาตรฐาน\r\nข้อมูลเพื่อตอบสนอง Service Plan สาขาโรคไม่ติดต่อ (NCD DM,HT,CVD)\r\nร้อยละของประชากรกลุ่มเสี่ยงเบาหวานในพื้นที่รับผิดชอบของปีที่ผ่านมาได้รับการตรวจน้ำตาลซ้ำ ', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nระบบ HDC', 'ประมวลผลจากระบบ HDC', 'SELECT p.cid,\r\n       cprename.prename,\r\n       p.name,\r\n       p.lname,\r\n       \'811\'                           AS activity_code,\r\n       \'50\'                            AS activity_cost,\r\n       cast(date(n.DATE_SERV) AS char) AS date_serv,\r\n       h.hoscode                       AS h_sub\r\nFROM t_dmscreen_lasty    s\r\n     INNER JOIN t_person_cid p\r\n        ON     s.cid = p.cid\r\n           AND p.check_typearea IN (1, 3)\r\n           AND p.nation IN (99)\r\n           AND p.discharge IN (9)\r\n           AND (   (s.BSTEST IN (1, 3) AND s.BSLEVEL BETWEEN 100 AND 125)\r\n                OR (s.BSTEST IN (2, 4) AND s.BSLEVEL BETWEEN 140 AND 199))\r\n           AND s.age_y >= 35\r\n     INNER JOIN chospital h\r\n        ON     p.check_hosp = h.hoscode\r\n           AND h.hoscode IN (\'08322\',\r\n                             \'08323\',\r\n                             \'08324\',\r\n                             \'08325\',\r\n                             \'08326\',\r\n                             \'08327\',\r\n                             \'08328\',\r\n                             \'08329\',\r\n                             \'08330\',\r\n                             \'08331\',\r\n                             \'08332\',\r\n                             \'08333\',\r\n                             \'08334\',\r\n                             \'08335\',\r\n                             \'08336\',\r\n                             \'08337\',\r\n                             \'08338\',\r\n                             \'08339\',\r\n                             \'08340\',\r\n                             \'08341\',\r\n                             \'08342\',\r\n                             \'08343\',\r\n                             \'08344\',\r\n                             \'08345\',\r\n                             \'08346\',\r\n                             \'08347\',\r\n                             \'08348\',\r\n                             \'08349\',\r\n                             \'08350\',\r\n                             \'08351\',\r\n                             \'08357\',\r\n                             \'08358\',\r\n                             \'08405\',\r\n                             \'08440\',\r\n                             \'08441\',\r\n                             \'10679\',\r\n                             \'14870\',\r\n                             \'23916\',\r\n                             \'77508\',\r\n                             \'77645\')\r\n     LEFT JOIN t_dmscreen_yearnow n\r\n        ON     s.cid = n.cid\r\n           AND n.DATE_SERV BETWEEN \'2021-10-01\' AND \'2022-09-30\'\r\n     INNER JOIN cprename ON p.PRENAME = cprename.id_prename\r\nWHERE n.cid IS NOT NULL AND n.BSLEVEL >= 50', null, 'Fix Stable 2022-04-23 PBS 811', 'InforReportable', '2022-04-24', '0', null, null, null);
INSERT INTO `pbs_items` VALUES ('81', '812', 'การติดตามกลุ่มสงสัยป่วยโรคความดันโลหิตสูง ในกลุ่มอายุ 35 ปีขึ้นไป(HBPM)', '1', '50', '1', '1', 'ประมวลผลจากระบบ HDC\r\n2.4. ร้อยละของผู้ป่วยความดันโลหิตสูงรายใหม่จากกลุ่มสงสัยป่วยที่ได้รับการตรวจติดตาม', 'กลุ่มรายงานมาตรฐาน\r\nข้อมูลเพื่อตอบสนอง Service Plan สาขาโรคไม่ติดต่อ (NCD DM,HT,CVD)\r\nร้อยละของผู้ป่วยความดันโลหิตสูงรายใหม่จากกลุ่มสงสัยป่วยที่ได้รับการตรวจติดตาม ', '10 กิจกรรมอื่นๆ', 'ชุดการให้บริการสำหรับการเบิกจ่ายงบประมาณส่งเสริมสุขภาพและป้องกันโรค ของหน่วยบริการจังหวัดนครปฐม ปีงบประมาณ 2565(Cost P&P) : สำนักงานสาธารณสุขจังหวัดนครปฐม\r\nระบบ HDC', null, 'SELECT p.cid,\r\n       cprename.prename,\r\n       p.name,\r\n       p.lname,\r\n       \'812\'     AS activity_code,\r\n       \'50\'      AS activity_cost,\r\n       IF(date(t.home_date) BETWEEN \'2021-10-01\' AND \'2022-09-30\',\r\n          cast(date(t.home_date) AS char),\r\n          cast(date(t.hosp_date) AS char))\r\n          AS date_serv,\r\n       h.hoscode AS h_sub\r\nFROM t_ht_follow    t\r\n     INNER JOIN chospital h ON t.hospcode = h.hoscode\r\n     INNER JOIN t_person_cid p\r\n        ON t.hospcode = p.check_hosp AND t.cid = p.cid\r\n     INNER JOIN cprename ON p.PRENAME = cprename.id_prename\r\nWHERE     p.check_typearea IN (1, 3)\r\n      AND p.NATION IN (99)\r\n      AND p.DISCHARGE IN (9)\r\n      AND t.date_screen BETWEEN \'2021-10-01\' AND \'2022-09-30\'\r\n      AND (   t.home_date BETWEEN \'2021-10-01\' AND \'2022-09-30\'\r\n           OR t.hosp_date BETWEEN \'2021-10-01\' AND \'2022-09-30\')\r\n      AND (t.home_bp = 1 OR t.hosp_bp = 1)\r\n      -- AND t.home_date IS NOT NULL\r\n      AND h.hoscode IN (\'08322\',\r\n                             \'08323\',\r\n                             \'08324\',\r\n                             \'08325\',\r\n                             \'08326\',\r\n                             \'08327\',\r\n                             \'08328\',\r\n                             \'08329\',\r\n                             \'08330\',\r\n                             \'08331\',\r\n                             \'08332\',\r\n                             \'08333\',\r\n                             \'08334\',\r\n                             \'08335\',\r\n                             \'08336\',\r\n                             \'08337\',\r\n                             \'08338\',\r\n                             \'08339\',\r\n                             \'08340\',\r\n                             \'08341\',\r\n                             \'08342\',\r\n                             \'08343\',\r\n                             \'08344\',\r\n                             \'08345\',\r\n                             \'08346\',\r\n                             \'08347\',\r\n                             \'08348\',\r\n                             \'08349\',\r\n                             \'08350\',\r\n                             \'08351\',\r\n                             \'08357\',\r\n                             \'08358\',\r\n                             \'08405\',\r\n                             \'08440\',\r\n                             \'08441\',\r\n                             \'10679\',\r\n                             \'14870\',\r\n                             \'23916\',\r\n                             \'77508\',\r\n                             \'77645\')\r\nGROUP BY h.hoscode, p.cid\r\nORDER BY h.hoscode', null, 'Fix Stable 2022-04-23 PBS 812', 'InforReportable', '2022-04-24', '0', null, null, null);
